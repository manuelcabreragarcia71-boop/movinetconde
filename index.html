<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="8iamWe4GTvwJpKQOqVhcmM_6SbQ1hB-pWMybzcfF-1I" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOVINETCONDE | Tecnolog√≠a & Web</title>
    <meta name="description" content="Venta de m√≥viles, servicio t√©cnico y dise√±o de p√°ginas web profesionales.">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #000000;
            --accent: #ff8c00;
            --white: #ffffff;
            --text: #333333;
            --bg-overlay: rgba(255, 255, 255, 0.98); 
        }

        body { 
            margin: 0; font-family: 'Montserrat', sans-serif; color: var(--text); background-color: #000; 
            background-image: url('fondo.JPG');
            background-repeat: no-repeat; background-position: center center; background-attachment: fixed; background-size: cover;       
        }

        /* NAVEGACI√ìN */
        .navbar { background: rgba(255, 255, 255, 0.98); padding: 10px 0; position: sticky; top: 0; z-index: 1000; border-bottom: 3px solid var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 15px; display: flex; flex-direction: column; gap: 10px; }
        .nav-top { display: flex; justify-content: space-between; align-items: center; }
        .logo-container { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--primary); }
        .nav-logo-img { height: 40px; border-radius: 5px; } 
        .logo-text { font-size: 1.4rem; font-weight: 800; margin: 0; }
        .logo-text span { color: var(--accent); }
        .nav-icons { display: flex; gap: 15px; }
        .btn-icon { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--primary); }
        
        .nav-menu { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; }
        .menu-btn { background: #eee; border: none; padding: 8px 15px; border-radius: 20px; font-weight: 600; cursor: pointer; white-space: nowrap; font-size: 0.9rem; transition: 0.3s; }
        .menu-btn.active, .menu-btn:hover { background: var(--accent); color: white; }

        /* CONTENEDORES */
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; background: var(--bg-overlay); border-radius: 15px; }
        .hidden { display: none !important; }
        .section-title { text-align: center; color: var(--primary); text-transform: uppercase; margin-bottom: 30px; border-bottom: 2px solid var(--accent); display: inline-block; padding-bottom: 5px; }
        .center-wrapper { text-align: center; }

        /* CAT√ÅLOGO PRODUCTOS */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card { background: white; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #eee; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .product-photo { width: 100%; height: 220px; object-fit: cover; border-radius: 5px; }
        
        /* Selectores de Opciones */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin: 10px 0; }
        .full-width-select { width: 100%; margin-top: 5px; }
        select { padding: 5px; border-radius: 5px; border: 1px solid #ccc; font-size: 0.85rem; width: 100%; background: #f9f9f9; }
        label { font-size: 0.7rem; color: #777; font-weight: bold; display: block; text-align: left; margin-bottom: 2px; }

        .price { font-size: 1.3rem; font-weight: 800; color: var(--accent); margin: 10px 0; }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; transition: 0.2s; }
        .btn-primary:active { transform: scale(0.98); }
        
        /* Botones de Admin */
        .admin-actions { display: flex; gap: 5px; margin-top: 10px; }
        .btn-edit { background: #f1c40f; color: black; border: none; padding: 5px; flex: 1; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .btn-delete { background: #e74c3c; color: white; border: none; padding: 5px; flex: 1; cursor: pointer; border-radius: 5px; font-weight: bold; }
        
        .fav-btn { position: absolute; top: 10px; right: 10px; background: white; border: none; font-size: 1.3rem; color: #ccc; cursor: pointer; padding: 5px; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .fav-btn.active { color: red; }

        /* PORTAFOLIO WEB */
        .web-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .web-card { background: #fff; border: 1px solid #ddd; border-radius: 10px; overflow: hidden; transition: 0.3s; position: relative; }
        .web-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .web-preview { height: 150px; background: #222; display: flex; align-items: center; justify-content: center; color: var(--accent); font-size: 3rem; }
        .web-info { padding: 20px; text-align: center; }
        .web-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 5px; }

        /* FORMULARIOS Y ADMIN */
        .form-box { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-family: inherit; }
        
        .admin-panel { background: #fff8e1; border: 2px dashed var(--accent); margin-bottom: 20px; padding: 20px; }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
        .admin-tab-btn { background: none; border: none; font-weight: bold; cursor: pointer; opacity: 0.5; font-size: 1rem; }
        .admin-tab-btn.active { opacity: 1; color: var(--accent); border-bottom: 2px solid var(--accent); }

        /* MODALES */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; width: 90%; max-width: 450px; border-radius: 10px; position: relative; }
        .close { position: absolute; top: 10px; right: 20px; font-size: 1.8rem; cursor: pointer; }

        footer { text-align: center; padding: 30px; background: #111; color: white; margin-top: 50px; }
        .social-link { color: var(--accent); font-size: 2rem; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-top">
                <a href="#" class="logo-container">
                    <img src="fondo.JPG" alt="Logo" class="nav-logo-img">
                    <h1 class="logo-text">MOVINET<span>CONDE</span></h1>
                </a>
                <div class="nav-icons">
                    <button onclick="abrirModal('cart-modal')" class="btn-icon"><i class="fas fa-shopping-cart"></i> <span id="cart-count">0</span></button>
                    <button onclick="gestionarPerfil()" class="btn-icon"><i class="fas fa-user-circle"></i></button>
                    <button onclick="abrirModal('admin-login-modal')" class="btn-icon"><i class="fas fa-lock"></i></button>
                </div>
            </div>
            <div class="nav-menu">
                <button onclick="verSeccion('catalogo')" class="menu-btn active" id="btn-catalogo">üì± M√≥viles</button>
                <button onclick="verSeccion('encargos')" class="menu-btn" id="btn-encargos">üì¶ Encargos</button>
                <button onclick="verSeccion('reparaciones')" class="menu-btn" id="btn-reparaciones">üîß Taller</button>
                <button onclick="verSeccion('webs')" class="menu-btn" id="btn-webs">üíª Dise√±o Web</button>
            </div>
        </div>
    </nav>

    <div id="admin-panel" class="container admin-panel hidden">
        <div class="admin-tabs">
            <button class="admin-tab-btn active" onclick="verAdminTab('productos')">Gestionar M√≥viles</button>
            <button class="admin-tab-btn" onclick="verAdminTab('webs')">Gestionar Webs</button>
        </div>

        <div id="admin-tab-productos">
            <h3 id="productFormTitle">Nuevo M√≥vil</h3>
            <p style="font-size:0.8rem">‚ö†Ô∏è Separa las opciones con comas (Ej: Negro, Azul, Rojo)</p>
            <form id="addProductForm">
                <input type="hidden" id="editProductId"> <input type="file" id="newImg" accept="image/*">
                <div id="imgPreview" style="font-size:0.8rem; color:green; margin-bottom:5px;"></div>
                
                <input type="text" id="newName" placeholder="Nombre (Ej: iPhone 13)" required>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="text" id="newRam" placeholder="RAMs (Ej: 8GB, 12GB)" required>
                    <input type="text" id="newStorage" placeholder="Memoria (Ej: 128GB, 256GB)" required>
                </div>
                
                <input type="text" id="newColors" placeholder="Colores (Ej: Negro, Blanco)" required>
                <input type="number" id="newPrice" placeholder="Precio (‚Ç¨)" required>
                
                <button type="submit" class="btn-primary" id="btnSaveProduct">GUARDAR PRODUCTO</button>
                <button type="button" onclick="resetFormProduct()" style="margin-top:5px; background:#999; color:white; border:none; padding:5px; width:100%; cursor:pointer;">Cancelar Edici√≥n</button>
            </form>
        </div>

        <div id="admin-tab-webs" class="hidden">
            <h3 id="webFormTitle">Nueva Web en Portafolio</h3>
            <form id="addWebForm">
                <input type="hidden" id="editWebId">
                
                <label>Icono (Clase FontAwesome, ej: fas fa-shopping-bag)</label>
                <input type="text" id="webIcon" placeholder="Ej: fas fa-utensils" value="fas fa-desktop" required>
                
                <input type="text" id="webTitle" placeholder="T√≠tulo (Ej: Web Restaurante)" required>
                <textarea id="webDesc" placeholder="Descripci√≥n del servicio..." rows="2" required></textarea>
                
                <button type="submit" class="btn-primary" id="btnSaveWeb">GUARDAR WEB</button>
                <button type="button" onclick="resetFormWeb()" style="margin-top:5px; background:#999; color:white; border:none; padding:5px; width:100%; cursor:pointer;">Cancelar Edici√≥n</button>
            </form>
        </div>

        <button onclick="cerrarSesionAdmin()" style="margin-top:20px; background:#333; color:white; border:none; padding:10px; width:100%;">Cerrar Sesi√≥n Admin</button>
    </div>

    <div id="sec-catalogo" class="container">
        <div class="center-wrapper"><h2 class="section-title">Cat√°logo M√≥viles</h2></div>
        <div id="productos-container" class="grid-container">
            <p style="text-align:center;">Cargando...</p>
        </div>
    </div>

    <div id="sec-encargos" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Encargos</h2></div>
        <div class="form-box">
            <p style="text-align: center;">¬øBuscas un modelo espec√≠fico? P√≠delo aqu√≠.</p>
            <form id="encargoForm">
                <input type="text" id="encargoNombre" placeholder="Tu Nombre" required>
                <input type="text" id="encargoModelo" placeholder="Modelo deseado" required>
                <input type="text" id="encargoDetalles" placeholder="Detalles (Color, GB...)">
                <button type="submit" class="btn-primary">CONSULTAR <i class="fab fa-whatsapp"></i></button>
            </form>
        </div>
    </div>

    <div id="sec-reparaciones" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Taller</h2></div>
        <div class="form-box">
            <form id="tallerForm">
                <input type="text" id="tallerNombre" placeholder="Nombre" required>
                <input type="text" id="tallerDispositivo" placeholder="Dispositivo" required>
                <textarea id="tallerProblema" placeholder="Problema..." rows="3" required></textarea>
                <button type="submit" class="btn-primary">PEDIR CITA <i class="fab fa-whatsapp"></i></button>
            </form>
        </div>
    </div>

    <div id="sec-webs" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Portafolio Web</h2></div>
        <p style="text-align:center;">Proyectos realizados y tipos de web que ofrecemos.</p>
        
        <div id="webs-container" class="web-grid">
            <p>Cargando portafolio...</p>
        </div>

        <div class="form-box" style="margin-top: 40px; background: #f4f4f4;">
            <h3 style="text-align:center;">Solicitar Web</h3>
            <form id="webRequestForm">
                <input type="text" id="reqWebNombre" placeholder="Tu Nombre" required>
                <input type="text" id="reqWebTipo" placeholder="Tipo de negocio" required>
                <button type="submit" class="btn-primary" style="background:#333">CONTACTAR <i class="fab fa-whatsapp"></i></button>
            </form>
        </div>
    </div>

    <div id="cart-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('cart-modal')">&times;</span>
            <h2>Carrito</h2>
            <ul id="cart-items" style="list-style:none; padding:0; margin:20px 0;"></ul>
            <h3>Total: <span id="total-price">0</span>‚Ç¨</h3>
            <button onclick="realizarPedido()" class="btn-primary">COMPRAR POR WHATSAPP</button>
        </div>
    </div>

    <div id="admin-login-modal" class="modal hidden">
        <div class="modal-content" style="max-width:300px; text-align:center;">
            <span class="close" onclick="cerrarModal('admin-login-modal')">&times;</span>
            <h3>Zona Admin</h3>
            <input type="password" id="adminPassInput" placeholder="Contrase√±a">
            <button onclick="verificarAdmin()" class="btn-primary">Entrar</button>
        </div>
    </div>

    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('auth-modal')">&times;</span>
            <h2 style="text-align:center">Clientes</h2>
            <form id="authForm">
                <input type="email" id="authEmail" placeholder="Email">
                <input type="password" id="authPass" placeholder="Contrase√±a">
                <button type="submit" class="btn-primary">Entrar / Registro</button>
            </form>
        </div>
    </div>

    <div id="profile-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('profile-modal')">&times;</span>
            <h2>Favoritos</h2>
            <ul id="fav-list" style="list-style:none; padding:0"></ul>
            <button onclick="auth.signOut(); cerrarModal('profile-modal');" class="btn-delete" style="background:#333; margin-top:10px;">Salir</button>
        </div>
    </div>

    <footer>
        <a href="https://www.instagram.com/movinetconde/" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
        <p>&copy; 2025 MOVINETCONDE</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        // --- CLAVES FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyAO9sshvU5zUf_S9d12toWwrioeXBonlRc",
            authDomain: "movinet-conde-web.firebaseapp.com",
            projectId: "movinet-conde-web",
            appId: "1:867268264562:web:f28e33585cdcde3d8e78eb"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let carrito = [];
        let usuarioActual = null;
        let favoritos = [];
        let esAdmin = false;
        let productoEditandoImg = ""; // Para guardar la imagen antigua al editar
        
        const MI_TELEFONO = "34613509309"; 

        // --- NAVEGACI√ìN ---
        function verSeccion(id) {
            document.querySelectorAll('[id^="sec-"]').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`sec-${id}`).classList.remove('hidden');
            document.getElementById(`btn-${id}`).classList.add('active');
        }

        function verAdminTab(tab) {
            document.getElementById('admin-tab-productos').classList.add('hidden');
            document.getElementById('admin-tab-webs').classList.add('hidden');
            document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(`admin-tab-${tab}`).classList.remove('hidden');
            event.target.classList.add('active');
        }

        // --- LOGICA PRODUCTOS (MOVILES) ---
        function mostrarProductos() {
            const container = document.getElementById('productos-container');
            db.collection("productos").orderBy("fecha", "desc").onSnapshot((snap) => {
                container.innerHTML = "";
                if(snap.empty) { container.innerHTML = "<p>Cat√°logo vac√≠o.</p>"; return; }

                snap.forEach(doc => {
                    const p = doc.data();
                    const isFav = favoritos.includes(doc.id) ? 'active' : '';
                    
                    // Convertir strings "8GB, 12GB" en arrays para los Selects
                    const rams = p.ram ? p.ram.split(',').map(s=>s.trim()) : ['-'];
                    const storages = p.storage ? p.storage.split(',').map(s=>s.trim()) : ['-'];
                    const colors = p.colores ? p.colores.split(',').map(s=>s.trim()) : ['Standard'];

                    // Generar HTML de opciones
                    const ramOptions = rams.map(r => `<option>${r}</option>`).join('');
                    const storeOptions = storages.map(s => `<option>${s}</option>`).join('');
                    const colorOptions = colors.map(c => `<option>${c}</option>`).join('');

                    // Botones admin
                    let adminBtns = '';
                    if(esAdmin) {
                        // Pasamos los datos como string JSON para poder editar luego
                        const dataStr = JSON.stringify(p).replace(/"/g, '&quot;'); 
                        adminBtns = `
                            <div class="admin-actions">
                                <button class="btn-edit" onclick="editarProducto('${doc.id}', '${dataStr}')"><i class="fas fa-edit"></i> Editar</button>
                                <button class="btn-delete" onclick="borrarProducto('${doc.id}')"><i class="fas fa-trash"></i></button>
                            </div>
                        `;
                    }

                    const div = document.createElement('div');
                    div.className = "product-card";
                    div.innerHTML = `
                        <button class="fav-btn ${isFav}" onclick="toggleFavorito('${doc.id}', '${p.nombre}')">‚ô•</button>
                        <img src="${p.img}" class="product-photo">
                        <h3 style="margin-bottom:5px;">${p.nombre}</h3>
                        
                        <div class="options-grid">
                            <div><label>RAM</label><select id="ram-${doc.id}">${ramOptions}</select></div>
                            <div><label>GB</label><select id="gb-${doc.id}">${storeOptions}</select></div>
                        </div>
                        <div class="full-width-select">
                            <label>Color</label><select id="col-${doc.id}">${colorOptions}</select>
                        </div>
                        
                        <p class="price">${p.precio}‚Ç¨</p>
                        <button class="btn-primary" onclick="addCart('${doc.id}', '${p.nombre}', ${p.precio})">A√ëADIR</button>
                        ${adminBtns}
                    `;
                    container.appendChild(div);
                });
            });
        }

        // --- L√ìGICA WEBS (PORTAFOLIO) ---
        function mostrarWebs() {
            const container = document.getElementById('webs-container');
            db.collection("webs").orderBy("fecha", "desc").onSnapshot((snap) => {
                container.innerHTML = "";
                if(snap.empty) { container.innerHTML = "<p>No hay proyectos a√∫n.</p>"; return; }

                snap.forEach(doc => {
                    const w = doc.data();
                    let adminBtns = '';
                    if(esAdmin) {
                        const dataStr = JSON.stringify(w).replace(/"/g, '&quot;');
                        adminBtns = `
                            <div class="admin-actions" style="padding:10px;">
                                <button class="btn-edit" onclick="editarWeb('${doc.id}', '${dataStr}')"><i class="fas fa-edit"></i></button>
                                <button class="btn-delete" onclick="borrarWeb('${doc.id}')"><i class="fas fa-trash"></i></button>
                            </div>
                        `;
                    }

                    container.innerHTML += `
                        <div class="web-card">
                            <div class="web-preview"><i class="${w.icono}"></i></div>
                            <div class="web-info">
                                <div class="web-title">${w.titulo}</div>
                                <p>${w.descripcion}</p>
                            </div>
                            ${adminBtns}
                        </div>
                    `;
                });
            });
        }

        // --- GESTI√ìN FORMULARIOS (CREAR / EDITAR) ---

        // 1. PRODUCTOS
        function editarProducto(id, dataStr) {
            const p = JSON.parse(dataStr);
            document.getElementById('editProductId').value = id;
            document.getElementById('newName').value = p.nombre;
            document.getElementById('newRam').value = p.ram;
            document.getElementById('newStorage').value = p.storage;
            document.getElementById('newColors').value = p.colores;
            document.getElementById('newPrice').value = p.precio;
            
            productoEditandoImg = p.img; // Guardar img por si no sube nueva
            document.getElementById('imgPreview').innerText = "Imagen actual cargada. Sube otra solo si quieres cambiarla.";
            
            document.getElementById('productFormTitle').innerText = "Editando: " + p.nombre;
            document.getElementById('btnSaveProduct').innerText = "ACTUALIZAR PRODUCTO";
            
            document.getElementById('admin-panel').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function resetFormProduct() {
            document.getElementById('addProductForm').reset();
            document.getElementById('editProductId').value = "";
            productoEditandoImg = "";
            document.getElementById('imgPreview').innerText = "";
            document.getElementById('productFormTitle').innerText = "Nuevo M√≥vil";
            document.getElementById('btnSaveProduct').innerText = "GUARDAR PRODUCTO";
        }

        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('editProductId').value;
            const file = document.getElementById('newImg').files[0];
            
            const data = {
                nombre: document.getElementById('newName').value,
                ram: document.getElementById('newRam').value,
                storage: document.getElementById('newStorage').value,
                colores: document.getElementById('newColors').value,
                precio: Number(document.getElementById('newPrice').value),
                fecha: new Date().toISOString()
            };

            const guardar = (imgFinal) => {
                data.img = imgFinal;
                if(id) {
                    // Actualizar
                    db.collection("productos").doc(id).update(data).then(() => {
                        alert("Producto actualizado");
                        resetFormProduct();
                    });
                } else {
                    // Crear nuevo
                    db.collection("productos").add(data).then(() => {
                        alert("Producto creado");
                        resetFormProduct();
                    });
                }
            };

            if(file) {
                if(file.size > 1000000) return alert("Imagen muy grande");
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function() { guardar(reader.result); };
            } else if (id && productoEditandoImg) {
                // Si editamos y no hay foto nueva, usamos la vieja
                guardar(productoEditandoImg);
            } else {
                alert("Debes subir una imagen");
            }
        });

        function borrarProducto(id) {
            if(confirm("¬øEliminar producto?")) db.collection("productos").doc(id).delete();
        }

        // 2. WEBS
        function editarWeb(id, dataStr) {
            const w = JSON.parse(dataStr);
            document.getElementById('editWebId').value = id;
            document.getElementById('webIcon').value = w.icono;
            document.getElementById('webTitle').value = w.titulo;
            document.getElementById('webDesc').value = w.descripcion;
            
            document.getElementById('webFormTitle').innerText = "Editando Web";
            document.getElementById('btnSaveWeb').innerText = "ACTUALIZAR WEB";
            window.scrollTo(0,0);
        }

        function resetFormWeb() {
            document.getElementById('addWebForm').reset();
            document.getElementById('editWebId').value = "";
            document.getElementById('webFormTitle').innerText = "Nueva Web en Portafolio";
            document.getElementById('btnSaveWeb').innerText = "GUARDAR WEB";
        }

        document.getElementById('addWebForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('editWebId').value;
            const data = {
                icono: document.getElementById('webIcon').value,
                titulo: document.getElementById('webTitle').value,
                descripcion: document.getElementById('webDesc').value,
                fecha: new Date().toISOString()
            };

            if(id) {
                db.collection("webs").doc(id).update(data).then(() => { alert("Web actualizada"); resetFormWeb(); });
            } else {
                db.collection("webs").add(data).then(() => { alert("Web a√±adida"); resetFormWeb(); });
            }
        });

        function borrarWeb(id) {
            if(confirm("¬øEliminar del portafolio?")) db.collection("webs").doc(id).delete();
        }


        // --- CARRITO CON OPCIONES ---
        function addCart(id, nombre, precio) {
            // Obtener lo que ha seleccionado el cliente
            const ram = document.getElementById(`ram-${id}`).value;
            const gb = document.getElementById(`gb-${id}`).value;
            const col = document.getElementById(`col-${id}`).value;

            const item = {
                n: nombre,
                p: precio,
                detalles: `${col}, ${ram}, ${gb}`
            };
            
            carrito.push(item);
            document.getElementById('cart-count').innerText = carrito.length;
            alert(`A√±adido: ${nombre} (${col})`);
        }

        function realizarPedido() {
            if(carrito.length===0) return alert("Vac√≠o");
            let msj = "üëã Hola, quiero comprar:\n\n";
            carrito.forEach(i => msj += `üì± *${i.n}* (${i.p}‚Ç¨)\n   ‚û§ ${i.detalles}\n\n`);
            
            // Sumar total
            let total = carrito.reduce((sum, i) => sum + i.p, 0);
            msj += `üí∞ TOTAL: ${total}‚Ç¨`;

            window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(msj)}`, '_blank');
        }

        // --- FORMULARIOS CLIENTE ---
        document.getElementById('encargoForm').addEventListener('submit', e => {
            e.preventDefault();
            const n = document.getElementById('encargoNombre').value;
            const m = document.getElementById('encargoModelo').value;
            const d = document.getElementById('encargoDetalles').value;
            window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(`üì¶ ENCARGO\nNombre: ${n}\nBusco: ${m}\nDetalles: ${d}`)}`, '_blank');
        });

        document.getElementById('tallerForm').addEventListener('submit', e => {
            e.preventDefault();
            const n = document.getElementById('tallerNombre').value;
            const d = document.getElementById('tallerDispositivo').value;
            const p = document.getElementById('tallerProblema').value;
            window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(`üîß TALLER\nNombre: ${n}\nDispositivo: ${d}\nProblema: ${p}`)}`, '_blank');
        });

        document.getElementById('webRequestForm').addEventListener('submit', e => {
            e.preventDefault();
            const n = document.getElementById('reqWebNombre').value;
            const t = document.getElementById('reqWebTipo').value;
            window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(`üíª INTER√âS WEB\nNombre: ${n}\nNegocio: ${t}\nQuiero info para una web.`)}`, '_blank');
        });

        // --- ADMIN LOGIN ---
        function verificarAdmin() {
            if(document.getElementById('adminPassInput').value === "4354") {
                esAdmin = true;
                document.getElementById('admin-panel').classList.remove('hidden');
                cerrarModal('admin-login-modal');
                mostrarProductos(); // Refrescar botones
                mostrarWebs();
                alert("Modo Admin: ON");
            } else { alert("Clave incorrecta"); }
        }
        function cerrarSesionAdmin() {
            esAdmin = false;
            document.getElementById('admin-panel').classList.add('hidden');
            mostrarProductos(); 
            mostrarWebs();
        }

        // --- AUTH & HELPERS ---
        auth.onAuthStateChanged(user => {
            if(user) { usuarioActual = user; cerrarModal('auth-modal'); cargarFavoritos(); }
            else { usuarioActual = null; favoritos = []; }
        });

        function gestionarPerfil() {
            if(usuarioActual) { 
                abrirModal('profile-modal'); 
                const ul = document.getElementById('fav-list');
                ul.innerHTML = "";
                favoritos.forEach(id => ul.innerHTML += `<li>‚ù§Ô∏è Producto ID: ${id}</li>`); // Simplificado
            } else { abrirModal('auth-modal'); }
        }

        document.getElementById('authForm').addEventListener('submit', e => {
            e.preventDefault();
            const em = document.getElementById('authEmail').value;
            const pw = document.getElementById('authPass').value;
            auth.signInWithEmailAndPassword(em, pw).catch(() => {
                auth.createUserWithEmailAndPassword(em, pw);
            });
        });

        function cargarFavoritos() {
            if(!usuarioActual) return;
            db.collection('usuarios').doc(usuarioActual.uid).collection('favoritos').get().then(s => {
                favoritos = []; s.forEach(d => favoritos.push(d.id)); mostrarProductos();
            });
        }

        function toggleFavorito(id, nombre) {
            if(!usuarioActual) return abrirModal('auth-modal');
            const idx = favoritos.indexOf(id);
            if(idx === -1) {
                db.collection('usuarios').doc(usuarioActual.uid).collection('favoritos').doc(id).set({nombre});
                favoritos.push(id);
            } else {
                db.collection('usuarios').doc(usuarioActual.uid).collection('favoritos').doc(id).delete();
                favoritos.splice(idx, 1);
            }
            mostrarProductos();
        }

        window.abrirModal = (id) => {
            document.getElementById(id).classList.remove('hidden');
            if(id === 'cart-modal') {
                const ul = document.getElementById('cart-items'); ul.innerHTML=""; let t=0;
                carrito.forEach(i=>{ ul.innerHTML+=`<li><b>${i.n}</b> (${i.detalles}) - ${i.p}‚Ç¨</li>`; t+=i.p; });
                document.getElementById('total-price').innerText = t;
            }
        }
        window.cerrarModal = (id) => document.getElementById(id).classList.add('hidden');

        // INICIALIZAR
        mostrarProductos();
        mostrarWebs();

    </script>
</body>
</html>