<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="8iamWe4GTvwJpKQOqVhcmM_6SbQ1hB-pWMybzcfF-1I" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MOVINETCONDE | Expertos en Tecnolog√≠a</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #000000;
            --accent: #ff8c00; /* Naranja corporativo */
            --white: #ffffff;
            --text: #333333;
            --bg-overlay: rgba(255, 255, 255, 0.98); 
        }

        body { 
            margin: 0; font-family: 'Montserrat', sans-serif; color: var(--text); background-color: #000; 
            background-image: url('fondo.JPG');
            background-repeat: no-repeat; background-position: center center; background-attachment: fixed; background-size: cover;       
            touch-action: manipulation; /* Mejora respuesta t√°ctil */
        }

        /* NAVEGACI√ìN */
        .navbar { background: rgba(255, 255, 255, 0.98); padding: 10px 0; position: sticky; top: 0; z-index: 1000; border-bottom: 3px solid var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 15px; display: flex; flex-direction: column; gap: 10px; }
        .nav-top { display: flex; justify-content: space-between; align-items: center; }
        .logo-container { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--primary); }
        .nav-logo-img { height: 40px; border-radius: 5px; } 
        .logo-text { font-size: 1.4rem; font-weight: 800; margin: 0; }
        .logo-text span { color: var(--accent); }
        .nav-icons { display: flex; gap: 15px; }
        .btn-icon { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--primary); }
        
        .nav-menu { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .menu-btn { background: #eee; border: none; padding: 8px 15px; border-radius: 20px; font-weight: 600; cursor: pointer; white-space: nowrap; font-size: 0.9rem; transition: 0.3s; }
        .menu-btn.active, .menu-btn:hover { background: var(--accent); color: white; }

        /* FILTROS (CARPETAS) */
        .filter-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; margin-bottom: 20px; -webkit-overflow-scrolling: touch; scrollbar-width: none; border-bottom: 1px solid #eee; }
        .filter-badge { background: white; border: 2px solid #eee; padding: 8px 15px; border-radius: 15px; cursor: pointer; font-weight: bold; white-space: nowrap; font-size: 0.85rem; transition: 0.3s; color: #555; display: flex; align-items: center; gap: 5px; }
        .filter-badge:hover, .filter-badge.active { border-color: var(--accent); color: var(--accent); background: #fff8e1; transform: translateY(-2px); }
        .filter-badge i { font-size: 1rem; }

        /* CONTENEDORES */
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; background: var(--bg-overlay); border-radius: 15px; }
        .hidden { display: none !important; }
        .section-title { text-align: center; color: var(--primary); text-transform: uppercase; margin-bottom: 20px; border-bottom: 2px solid var(--accent); display: inline-block; padding-bottom: 5px; font-weight: 800; }
        .center-wrapper { text-align: center; }

        /* CARDS */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        
        .product-card { background: white; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #eee; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .product-photo { width: 100%; height: 220px; object-fit: cover; border-radius: 5px; }
        .brand-tag { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.7); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }

        .repair-card { background: white; border-radius: 10px; overflow: hidden; border-left: 5px solid var(--accent); box-shadow: 0 5px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; position: relative; }
        .repair-header { background: #333; color: white; padding: 10px; text-align: center; font-weight: bold; font-size: 0.9rem; }
        .repair-body { padding: 15px; text-align: center; flex: 1; }
        .repair-type-icon { font-size: 2rem; color: var(--accent); margin-bottom: 10px; }
        .repair-img { width: 80px; height: 80px; object-fit: cover; border-radius: 50%; margin: 0 auto 10px; border: 2px solid var(--accent); display: block; }
        .repair-price { font-size: 1.5rem; color: var(--accent); font-weight: 800; margin: 10px 0; }
        .cat-badge { background: #eee; color: #555; padding: 3px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; display: inline-block; }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin: 10px 0; }
        .full-width-select { width: 100%; margin-top: 5px; }
        select { padding: 5px; border-radius: 5px; border: 1px solid #ccc; font-size: 0.85rem; width: 100%; background: #f9f9f9; }
        label { font-size: 0.7rem; color: #777; font-weight: bold; display: block; text-align: left; margin-bottom: 2px; }

        .price { font-size: 1.3rem; font-weight: 800; color: var(--accent); margin: 10px 0; }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; transition: 0.2s; }
        .btn-primary:active { transform: scale(0.98); }
        
        .admin-actions { display: flex; gap: 5px; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; }
        .btn-edit { background: #f1c40f; color: black; border: none; padding: 5px; flex: 1; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .btn-delete { background: #e74c3c; color: white; border: none; padding: 5px; flex: 1; cursor: pointer; border-radius: 5px; font-weight: bold; }
        
        .fav-btn { position: absolute; top: 10px; right: 10px; background: white; border: none; font-size: 1.3rem; color: #ccc; cursor: pointer; padding: 5px; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .fav-btn.active { color: red; }

        /* PORTAFOLIO WEB */
        .web-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .web-card { background: #fff; border: 1px solid #ddd; border-radius: 10px; overflow: hidden; transition: 0.3s; position: relative; }
        .web-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .web-preview { height: 150px; background: #222; display: flex; align-items: center; justify-content: center; color: var(--accent); font-size: 3rem; }
        .web-info { padding: 20px; text-align: center; }

        /* FORMULARIOS Y ADMIN */
        .form-box { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-family: inherit; }
        
        .admin-panel { background: #fff8e1; border: 2px dashed var(--accent); margin-bottom: 20px; padding: 20px; }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; overflow-x: auto; }
        .admin-tab-btn { background: none; border: none; font-weight: bold; cursor: pointer; opacity: 0.5; font-size: 0.9rem; white-space: nowrap; }
        .admin-tab-btn.active { opacity: 1; color: var(--accent); border-bottom: 2px solid var(--accent); }

        /* ESTILOS DEL JUEGO (NUEVO) */
        #game-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #111;
            padding: 10px;
            border-radius: 10px;
            color: white;
            position: relative;
        }
        canvas {
            background: linear-gradient(to bottom, #222, #000);
            border: 4px solid var(--accent);
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.3);
            max-width: 100%;
            cursor: pointer;
        }
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-bottom: 10px;
            font-size: 1.2rem;
            font-weight: bold;
        }
        .game-controls {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            width: 100%;
            max-width: 400px;
        }
        .btn-control {
            flex: 1;
            background: #333;
            border: 2px solid #555;
            color: white;
            padding: 20px;
            font-size: 1.5rem;
            border-radius: 10px;
            touch-action: none; /* Evita zoom */
        }
        .btn-control:active { background: var(--accent); border-color: white; }
        
        /* MODALES */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; width: 90%; max-width: 450px; border-radius: 10px; position: relative; }
        .close { position: absolute; top: 10px; right: 20px; font-size: 1.8rem; cursor: pointer; }

        footer { text-align: center; padding: 30px; background: #111; color: white; margin-top: 50px; }
        .social-link { color: var(--accent); font-size: 2rem; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-top">
                <a href="#" class="logo-container">
                    <h1 class="logo-text">MOVINET<span>CONDE</span></h1>
                </a>
                <div class="nav-icons">
                    <button onclick="abrirModal('cart-modal')" class="btn-icon"><i class="fas fa-shopping-cart"></i> <span id="cart-count">0</span></button>
                    <button onclick="gestionarPerfil()" class="btn-icon"><i class="fas fa-user-circle"></i></button>
                    <button onclick="abrirModal('admin-login-modal')" class="btn-icon"><i class="fas fa-lock"></i></button>
                </div>
            </div>
            <div class="nav-menu">
                <button onclick="verSeccion('catalogo')" class="menu-btn active" id="btn-catalogo">üì± Cat√°logo</button>
                <button onclick="verSeccion('encargos')" class="menu-btn" id="btn-encargos">üì¶ Encargos</button>
                <button onclick="verSeccion('reparaciones')" class="menu-btn" id="btn-reparaciones">üîß Taller</button>
                <button onclick="verSeccion('webs')" class="menu-btn" id="btn-webs">üíª Web</button>
                <button onclick="verSeccion('juego')" class="menu-btn" id="btn-juego">üéÆ Minijuego</button>
            </div>
        </div>
    </nav>

    <div id="admin-panel" class="container admin-panel hidden">
        <div class="admin-tabs">
            <button class="admin-tab-btn active" onclick="verAdminTab('productos')">Productos</button>
            <button class="admin-tab-btn" onclick="verAdminTab('reparaciones')">Taller / Piezas</button>
            <button class="admin-tab-btn" onclick="verAdminTab('webs')">Webs</button>
        </div>
        <div id="admin-tab-productos">
            <h3 id="productFormTitle">Nuevo M√≥vil</h3>
            <form id="addProductForm">
                <input type="hidden" id="editProductId">
                <input type="file" id="newImg" accept="image/*">
                <input type="text" id="newBrand" placeholder="MARCA (Importante: Apple, Samsung...)" required>
                <input type="text" id="newName" placeholder="Modelo (Ej: iPhone 13 Pro)" required>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="text" id="newRam" placeholder="RAM" required>
                    <input type="text" id="newStorage" placeholder="Memoria" required>
                </div>
                <input type="text" id="newColors" placeholder="Colores" required>
                <input type="number" id="newPrice" placeholder="Precio (‚Ç¨)" required>
                <button type="submit" class="btn-primary" id="btnSaveProduct">GUARDAR PRODUCTO</button>
                <button type="button" onclick="resetFormProduct()" style="margin-top:5px; width:100%;">Cancelar</button>
            </form>
        </div>
        <div id="admin-tab-reparaciones" class="hidden">
            <h3 id="repairFormTitle">Nueva Reparaci√≥n</h3>
            <form id="addRepairForm">
                <input type="hidden" id="editRepairId">
                <input type="file" id="repairImg" accept="image/*">
                <label>Categor√≠a</label>
                <select id="repairCategory" required>
                    <option value="Pantalla">Pantalla</option>
                    <option value="Conector de Carga">Conector de Carga</option>
                    <option value="Bater√≠a">Bater√≠a</option>
                    <option value="Altavoz / Audio">Altavoz / Audio</option>
                    <option value="C√°mara">C√°mara</option>
                    <option value="Tapa Trasera">Tapa Trasera</option>
                    <option value="Placa Base">Placa Base</option>
                    <option value="Software">Software</option>
                    <option value="Otros">Otros</option>
                </select>
                <input type="text" id="repairBrand" placeholder="Marca" required>
                <input type="text" id="repairModel" placeholder="Modelo Exacto" required>
                <input type="number" id="repairPrice" placeholder="Precio (‚Ç¨)" required>
                <button type="submit" class="btn-primary" id="btnSaveRepair">GUARDAR</button>
                <button type="button" onclick="resetFormRepair()" style="margin-top:5px; width:100%;">Cancelar</button>
            </form>
        </div>
        <div id="admin-tab-webs" class="hidden">
            <h3 id="webFormTitle">Nueva Web</h3>
            <form id="addWebForm">
                <input type="hidden" id="editWebId">
                <input type="text" id="webIcon" placeholder="Icono (fas fa-desktop)" value="fas fa-desktop" required>
                <input type="text" id="webTitle" placeholder="T√≠tulo" required>
                <textarea id="webDesc" placeholder="Descripci√≥n..." rows="2" required></textarea>
                <button type="submit" class="btn-primary" id="btnSaveWeb">GUARDAR</button>
                <button type="button" onclick="resetFormWeb()" style="margin-top:5px; width:100%;">Cancelar</button>
            </form>
        </div>
        <button onclick="cerrarSesionAdmin()" style="margin-top:20px; width:100%;">Cerrar Sesi√≥n Admin</button>
    </div>

    <div id="sec-catalogo" class="container">
        <div class="center-wrapper"><h2 class="section-title">Cat√°logo M√≥viles</h2></div>
        <div id="brand-filters" class="filter-scroll">
            <button class="filter-badge active" onclick="filtrarMarca('all')">Todo</button>
        </div>
        <div id="productos-container" class="grid-container">
            <p style="text-align:center;">Cargando cat√°logo...</p>
        </div>
    </div>

    <div id="sec-encargos" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Encargos</h2></div>
        <div class="form-box">
            <p style="text-align: center;">¬øBuscas un modelo espec√≠fico? P√≠delo aqu√≠.</p>
            <form id="encargoForm">
                <input type="text" id="encargoNombre" placeholder="Tu Nombre" required>
                <input type="text" id="encargoModelo" placeholder="Modelo deseado" required>
                <input type="text" id="encargoDetalles" placeholder="Detalles">
                <button type="submit" class="btn-primary">CONSULTAR <i class="fab fa-whatsapp"></i></button>
            </form>
        </div>
    </div>

    <div id="sec-reparaciones" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Taller</h2></div>
        <div id="repair-filters" class="filter-scroll">
            <button class="filter-badge active" onclick="filtrarTaller('all')">Todo</button>
            <button class="filter-badge" onclick="filtrarTaller('Pantalla')">Pantalla</button>
            <button class="filter-badge" onclick="filtrarTaller('Conector de Carga')">Carga</button>
            <button class="filter-badge" onclick="filtrarTaller('Bater√≠a')">Bater√≠a</button>
            <button class="filter-badge" onclick="filtrarTaller('Altavoz / Audio')">Audio</button>
            <button class="filter-badge" onclick="filtrarTaller('Otros')">Otros</button>
        </div>
        <div id="reparaciones-container" class="grid-container" style="margin-bottom: 40px;"></div>
        <div class="form-box" style="background:#f4f4f4;">
            <h3 style="text-align:center;">¬øOtra Aver√≠a?</h3>
            <form id="tallerForm">
                <input type="text" id="tallerNombre" placeholder="Nombre" required>
                <input type="text" id="tallerDispositivo" placeholder="Dispositivo" required>
                <textarea id="tallerProblema" placeholder="Problema..." rows="3" required></textarea>
                <button type="submit" class="btn-primary" style="background:#333;">CONSULTAR <i class="fab fa-whatsapp"></i></button>
            </form>
        </div>
    </div>

    <div id="sec-webs" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Portafolio Web</h2></div>
        <div id="webs-container" class="web-grid"></div>
        <div class="form-box" style="margin-top: 40px;">
            <h3 style="text-align:center;">Solicitar Web</h3>
            <form id="webRequestForm">
                <input type="text" id="reqWebNombre" placeholder="Tu Nombre" required>
                <input type="text" id="reqWebTipo" placeholder="Tipo de negocio" required>
                <button type="submit" class="btn-primary">CONTACTAR <i class="fab fa-whatsapp"></i></button>
            </form>
        </div>
    </div>

    <div id="sec-juego" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">T√©cnico Express</h2></div>
        
        <div id="game-wrapper">
            <div class="game-info">
                <span style="color:#aaa;">Caja: <span id="gameScore" style="color:var(--accent); font-size:1.4rem;">0</span>‚Ç¨</span>
            </div>
            
            <canvas id="repairCanvas" width="350" height="450"></canvas>
            
            <button class="btn-primary" id="btnStartGame" onclick="startGame()" style="margin-top:10px;">¬°EMPEZAR TURNO!</button>

            <div class="game-controls">
                <button class="btn-control" onmousedown="moveLeft()" onmouseup="stopMove()" ontouchstart="moveLeft()" ontouchend="stopMove()"><i class="fas fa-arrow-left"></i></button>
                <button class="btn-control" onmousedown="moveRight()" onmouseup="stopMove()" ontouchstart="moveRight()" ontouchend="stopMove()"><i class="fas fa-arrow-right"></i></button>
            </div>
            <p style="text-align:center; color:#ccc; font-size:0.8rem; margin-top:15px;">
                ¬°Atrapa los üì± M√≥viles y üí∂ Dinero!<br>
                Evita el üíß Agua, ¬°da√±a los equipos!
            </p>
        </div>
    </div>

    <div id="cart-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('cart-modal')">&times;</span>
            <h2>Carrito</h2>
            <ul id="cart-items" style="list-style:none; padding:0; margin:20px 0;"></ul>
            <h3>Total: <span id="total-price">0</span>‚Ç¨</h3>
            <button onclick="realizarPedido()" class="btn-primary">COMPRAR POR WHATSAPP</button>
        </div>
    </div>
    <div id="admin-login-modal" class="modal hidden">
        <div class="modal-content" style="max-width:300px; text-align:center;">
            <span class="close" onclick="cerrarModal('admin-login-modal')">&times;</span>
            <h3>Zona Admin</h3>
            <input type="password" id="adminPassInput" placeholder="Contrase√±a">
            <button onclick="verificarAdmin()" class="btn-primary">Entrar</button>
        </div>
    </div>
    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('auth-modal')">&times;</span>
            <h2 style="text-align:center">Clientes</h2>
            <form id="authForm">
                <input type="email" id="authEmail" placeholder="Email">
                <input type="password" id="authPass" placeholder="Contrase√±a">
                <button type="submit" class="btn-primary">Entrar / Registro</button>
            </form>
        </div>
    </div>
    <div id="profile-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('profile-modal')">&times;</span>
            <h2>Favoritos</h2>
            <ul id="fav-list" style="list-style:none; padding:0"></ul>
            <button onclick="auth.signOut(); cerrarModal('profile-modal');" class="btn-delete" style="background:#333; margin-top:10px;">Salir</button>
        </div>
    </div>

    <footer>
        <a href="https://www.instagram.com/movinetconde/" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
        <p>&copy; 2025 MOVINETCONDE</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        // CONFIGURACI√ìN FIREBASE Y TIENDA
        const firebaseConfig = {
            apiKey: "AIzaSyAO9sshvU5zUf_S9d12toWwrioeXBonlRc",
            authDomain: "movinet-conde-web.firebaseapp.com",
            projectId: "movinet-conde-web",
            appId: "1:867268264562:web:f28e33585cdcde3d8e78eb"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let carrito = []; let usuarioActual = null; let favoritos = []; let esAdmin = false;
        let allProducts = []; let allRepairs = [];
        let filtroMarcaActual = 'all'; let filtroTallerActual = 'all';
        const MI_TELEFONO = "34613509309"; 

        // NAVEGACI√ìN
        function verSeccion(id) {
            document.querySelectorAll('[id^="sec-"]').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`sec-${id}`).classList.remove('hidden');
            document.getElementById(`btn-${id}`).classList.add('active');
            if(id !== 'juego') stopGameLoop(); // Parar juego si salimos
        }
        function verAdminTab(tab) {
            document.querySelectorAll('[id^="admin-tab-"]').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`admin-tab-${tab}`).classList.remove('hidden');
            event.target.classList.add('active');
        }

        // --- L√ìGICA DEL JUEGO: T√âCNICO EXPRESS ---
        const canvas = document.getElementById('repairCanvas');
        const ctx = canvas.getContext('2d');
        let gameInterval;
        let score = 0;
        let isPlaying = false;
        let dropSpeed = 3;
        
        // Jugador (T√©cnico)
        const player = { x: 150, y: 380, w: 60, h: 40, color: '#ff8c00', dx: 0 };
        // Objetos cayendo
        let items = [];
        
        function startGame() {
            if(isPlaying) return;
            isPlaying = true;
            score = 0;
            items = [];
            dropSpeed = 3;
            document.getElementById('gameScore').innerText = score;
            document.getElementById('btnStartGame').style.display = 'none';
            gameInterval = requestAnimationFrame(updateGame);
            spawnItem();
        }

        function stopGameLoop() {
            isPlaying = false;
            cancelAnimationFrame(gameInterval);
            document.getElementById('btnStartGame').style.display = 'block';
        }

        function spawnItem() {
            if(!isPlaying) return;
            const typeRand = Math.random();
            let type = 'phone'; // üì±
            if(typeRand > 0.8) type = 'money'; // üí∂
            if(typeRand > 0.9) type = 'water'; // üíß (Peligro)

            items.push({
                x: Math.random() * (canvas.width - 30),
                y: -30,
                type: type,
                w: 30, h: 30
            });
            
            // Generar otro objeto aleatoriamente
            setTimeout(spawnItem, 800 + Math.random() * 1000);
        }

        function updateGame() {
            if(!isPlaying) return;

            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Mover jugador
            player.x += player.dx;
            // L√≠mites pantalla
            if(player.x < 0) player.x = 0;
            if(player.x + player.w > canvas.width) player.x = canvas.width - player.w;

            // Dibujar jugador (Caja T√©cnico)
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.w, player.h);
            ctx.fillStyle = "#000";
            ctx.font = "20px Arial";
            ctx.fillText("üîß", player.x + 20, player.y + 28);

            // Mover y dibujar items
            for(let i=0; i<items.length; i++) {
                let item = items[i];
                item.y += dropSpeed;

                // Dibujar Emojis
                ctx.font = "24px Arial";
                if(item.type === 'phone') ctx.fillText("üì±", item.x, item.y + 24);
                else if(item.type === 'money') ctx.fillText("üí∂", item.x, item.y + 24);
                else if(item.type === 'water') ctx.fillText("üíß", item.x, item.y + 24);

                // Colisi√≥n (Caja simple)
                if(item.y + item.h > player.y && item.x < player.x + player.w && item.x + item.w > player.x) {
                    // Tocado
                    if(item.type === 'water') {
                        gameOver();
                        return;
                    } else {
                        // Puntos
                        if(item.type === 'phone') score += 10;
                        if(item.type === 'money') score += 50;
                        // Aumentar velocidad un poco
                        if(score % 100 === 0) dropSpeed += 0.5;
                        
                        document.getElementById('gameScore').innerText = score;
                        items.splice(i, 1);
                        i--;
                        continue;
                    }
                }

                // Fuera de pantalla
                if(item.y > canvas.height) {
                    items.splice(i, 1);
                    i--;
                }
            }

            gameInterval = requestAnimationFrame(updateGame);
        }

        function gameOver() {
            isPlaying = false;
            ctx.fillStyle = "rgba(0,0,0,0.8)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "white";
            ctx.font = "30px Arial";
            ctx.fillText("¬°M√ìVIL MOJADO!", 50, 200);
            ctx.font = "20px Arial";
            ctx.fillStyle = "var(--accent)";
            ctx.fillText("Caja final: " + score + "‚Ç¨", 100, 240);
            document.getElementById('btnStartGame').innerText = "REINTENTAR";
            document.getElementById('btnStartGame').style.display = 'block';
        }

        // Controles T√°ctiles y Rat√≥n
        function moveLeft() { player.dx = -5; }
        function moveRight() { player.dx = 5; }
        function stopMove() { player.dx = 0; }

        // --- FIN L√ìGICA JUEGO ---

        // FUNCIONES TIENDA (PRODUCTOS, REPARACIONES, AUTH...)
        function cargarProductos() {
            db.collection("productos").orderBy("fecha", "desc").onSnapshot((snap) => {
                allProducts = []; snap.forEach(doc => { allProducts.push({...doc.data(), id: doc.id}); });
                renderizarProductos();
            });
        }
        function renderizarProductos() {
            const container = document.getElementById('productos-container'); container.innerHTML = "";
            const filtrados = filtroMarcaActual === 'all' ? allProducts : allProducts.filter(p => (p.marca || 'Otros') === filtroMarcaActual);
            if(filtrados.length === 0) { container.innerHTML = "<p>Vac√≠o...</p>"; return; }
            filtrados.forEach(p => {
                const isFav = favoritos.includes(p.id) ? 'active' : '';
                let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-delete" onclick="borrar('productos','${p.id}')">üóëÔ∏è</button></div>` : '';
                container.innerHTML += `
                    <div class="product-card">
                        <span class="brand-tag">${p.marca || ''}</span>
                        <button class="fav-btn ${isFav}" onclick="toggleFavorito('${p.id}', '${p.nombre}')">‚ô•</button>
                        <img src="${p.img}" class="product-photo">
                        <h3>${p.nombre}</h3>
                        <p class="price">${p.precio}‚Ç¨</p>
                        <button class="btn-primary" onclick="addCart('${p.id}', '${p.nombre}', ${p.precio})">A√ëADIR</button>
                        ${adminBtns}
                    </div>`;
            });
        }
        function filtrarMarca(m) { filtroMarcaActual = m; renderizarProductos(); }
        
        function cargarReparaciones() {
            db.collection("reparaciones").orderBy("fecha", "desc").onSnapshot((snap) => {
                allRepairs = []; snap.forEach(doc => { allRepairs.push({...doc.data(), id: doc.id}); });
                renderizarTaller();
            });
        }
        function renderizarTaller() {
            const div = document.getElementById('reparaciones-container'); div.innerHTML = "";
            const filtrados = filtroTallerActual === 'all' ? allRepairs : allRepairs.filter(r => r.categoria === filtroTallerActual);
            filtrados.forEach(r => {
                let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-delete" onclick="borrar('reparaciones','${r.id}')">üóëÔ∏è</button></div>` : '';
                const img = r.img ? `<img src="${r.img}" class="repair-img">` : '';
                div.innerHTML += `<div class="repair-card"><div class="repair-header">${r.dispositivo}</div><div class="repair-body">${img}<b>${r.categoria}</b><br>${r.precio}‚Ç¨<br><button class="btn-primary" onclick="pedirCita('${r.categoria}','${r.dispositivo}',${r.precio})">CITA</button>${adminBtns}</div></div>`;
            });
        }
        function filtrarTaller(c) { filtroTallerActual = c; renderizarTaller(); }

        function mostrarWebs() {
            db.collection("webs").orderBy("fecha", "desc").onSnapshot(s => {
                const d = document.getElementById('webs-container'); d.innerHTML="";
                s.forEach(doc => {
                    const w=doc.data();
                    let adm = esAdmin ? `<button class="btn-delete" onclick="borrar('webs','${doc.id}')">üóëÔ∏è</button>` : '';
                    d.innerHTML += `<div class="web-card"><div class="web-preview"><i class="${w.icono}"></i></div><div class="web-info"><b>${w.titulo}</b><p>${w.descripcion}</p>${adm}</div></div>`;
                });
            });
        }

        // GESTI√ìN DATOS
        async function guardarItem(col, id, data, fileIn) {
            const f = document.getElementById(fileIn).files[0];
            if(f) { const r = new FileReader(); r.readAsDataURL(f); await new Promise(res => r.onload = ()=> { data.img = r.result; res(); }); }
            if(id) await db.collection(col).doc(id).update(data);
            else await db.collection(col).add({...data, fecha: new Date().toISOString()});
            alert("Guardado");
        }
        document.getElementById('addProductForm').addEventListener('submit', e=>{ e.preventDefault(); guardarItem('productos', document.getElementById('editProductId').value, {
            nombre: document.getElementById('newName').value, marca: document.getElementById('newBrand').value, precio: Number(document.getElementById('newPrice').value)
        }, 'newImg').then(resetFormProduct); });

        document.getElementById('addRepairForm').addEventListener('submit', e=>{ e.preventDefault(); guardarItem('reparaciones', document.getElementById('editRepairId').value, {
            categoria: document.getElementById('repairCategory').value, dispositivo: document.getElementById('repairModel').value, precio: Number(document.getElementById('repairPrice').value)
        }, 'repairImg').then(resetFormRepair); });
        
        document.getElementById('addWebForm').addEventListener('submit', e=>{ e.preventDefault(); guardarItem('webs', document.getElementById('editWebId').value, {
            icono: document.getElementById('webIcon').value, titulo: document.getElementById('webTitle').value, descripcion: document.getElementById('webDesc').value
        }, null).then(resetFormWeb); });

        function resetFormProduct(){ document.getElementById('addProductForm').reset(); }
        function resetFormRepair(){ document.getElementById('addRepairForm').reset(); }
        function resetFormWeb(){ document.getElementById('addWebForm').reset(); }
        function borrar(c,i){ if(confirm("Borrar?")) db.collection(c).doc(i).delete(); }

        // AUTH & USER
        function verificarAdmin() { if(document.getElementById('adminPassInput').value==="4354"){ esAdmin=true; document.getElementById('admin-panel').classList.remove('hidden'); cerrarModal('admin-login-modal'); cargarProductos(); cargarReparaciones(); mostrarWebs(); } else alert("Error"); }
        function cerrarSesionAdmin(){ esAdmin=false; document.getElementById('admin-panel').classList.add('hidden'); cargarProductos(); cargarReparaciones(); mostrarWebs(); }
        
        auth.onAuthStateChanged(u => { usuarioActual=u; if(u){ cerrarModal('auth-modal'); cargarFavoritos(); } else { favoritos=[]; } });
        document.getElementById('authForm').addEventListener('submit', e => { e.preventDefault(); const em=document.getElementById('authEmail').value, pw=document.getElementById('authPass').value; auth.signInWithEmailAndPassword(em,pw).catch(()=>auth.createUserWithEmailAndPassword(em,pw)); });

        function addCart(id,n,p){ carrito.push({n,p}); document.getElementById('cart-count').innerText=carrito.length; alert("A√±adido"); }
        function realizarPedido(){ if(!carrito.length)return; let m="Hola, pedido:\n"; carrito.forEach(i=>m+=`- ${i.n} (${i.p}‚Ç¨)\n`); window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(m)}`,'_blank'); }
        function pedirCita(c,d,p){ window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(`Cita Taller: ${c} para ${d} (${p}‚Ç¨)`)}`,'_blank'); }
        function gestionarPerfil(){ usuarioActual ? abrirModal('profile-modal') : abrirModal('auth-modal'); }
        function cargarFavoritos(){ if(!usuarioActual)return; db.collection('usuarios').doc(usuarioActual.uid).collection('favoritos').get().then(s=>{ favoritos=[]; s.forEach(d=>favoritos.push(d.id)); cargarProductos(); }); }
        function toggleFavorito(id,n){ if(!usuarioActual) return abrirModal('auth-modal'); const i=favoritos.indexOf(id); if(i===-1){ db.collection('usuarios').doc(usuarioActual.uid).collection('favoritos').doc(id).set({n}); favoritos.push(id); } else { db.collection('usuarios').doc(usuarioActual.uid).collection('favoritos').doc(id).delete(); favoritos.splice(i,1); } cargarProductos(); }

        window.abrirModal=(id)=>{ document.getElementById(id).classList.remove('hidden'); if(id==='cart-modal'){ const ul=document.getElementById('cart-items'); ul.innerHTML=""; let t=0; carrito.forEach(i=>{ ul.innerHTML+=`<li>${i.n} - ${i.p}‚Ç¨</li>`; t+=i.p; }); document.getElementById('total-price').innerText=t; }};
        window.cerrarModal=(id)=>document.getElementById(id).classList.add('hidden');

        // INIT
        cargarProductos(); cargarReparaciones(); mostrarWebs();
    </script>
</body>
</html>