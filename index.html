<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MOVINETCONDE | Tecnolog√≠a & Servicios</title>
    
    <link rel="canonical" href="https://www.tudominio.com/" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #000000;
            --accent: #ff8c00;
            --white: #ffffff;
            --text: #333333;
            --bg-glass: rgba(255, 255, 255, 0.92); 
            --success: #2ecc71;
            --pending: #f39c12;
            --error: #e74c3c;
            --stripe: #635bff;
        }

        /* --- CONFIGURACI√ìN BASE --- */
        * { box-sizing: border-box; }
        html { width: 100%; overflow-x: hidden; }
        body { 
            margin: 0; padding: 0; width: 100%; overflow-x: hidden;
            font-family: 'Montserrat', sans-serif; 
            color: var(--text); 
            background-color: #000; 
            background-image: url('fondo.JPG');
            background-repeat: no-repeat; 
            background-position: center center; 
            background-attachment: fixed; 
            background-size: cover;       
            touch-action: manipulation;
            padding-bottom: 80px; 
            -webkit-text-size-adjust: 100%;
        }

        /* --- INTRO BIENVENIDA --- */
        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center;
            animation: fadeOutUp 1s ease-in-out 2.5s forwards;
        }
        .tech-logo {
            font-family: 'Orbitron', sans-serif; font-size: 3rem; font-weight: 800;
            letter-spacing: 2px; text-transform: uppercase;
            animation: pulseGlow 1.5s infinite alternate;
        }
        .tech-logo span { color: var(--accent); }
        .loader-line {
            width: 0; height: 3px; background: var(--accent); margin-top: 20px;
            animation: loadWidth 2s ease-in-out forwards;
        }
        @keyframes pulseGlow { 0% { text-shadow: 0 0 10px rgba(255,140,0,0.2); } 100% { text-shadow: 0 0 30px rgba(255,140,0,0.8); } }
        @keyframes loadWidth { 0% { width: 0; } 100% { width: 200px; } }
        @keyframes fadeOutUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100%); pointer-events: none; } }

        /* --- NAVEGACI√ìN --- */
        .navbar { background: rgba(255, 255, 255, 0.98); padding: 10px 0; position: sticky; top: 0; z-index: 1000; border-bottom: 3px solid var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.3); width: 100%; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 15px; display: flex; flex-direction: column; gap: 10px; }
        .nav-top { display: flex; justify-content: space-between; align-items: center; }
        .logo-container { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--primary); }
        .logo-text { font-size: 1.4rem; font-weight: 800; margin: 0; }
        .logo-text span { color: var(--accent); }
        .nav-icons { display: flex; gap: 15px; }
        .btn-icon { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--primary); }
        
        .nav-menu { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .menu-btn { background: rgba(255,255,255,0.8); border: none; padding: 8px 15px; border-radius: 20px; font-weight: 600; cursor: pointer; white-space: nowrap; font-size: 0.9rem; transition: 0.3s; }
        .menu-btn.active, .menu-btn:hover { background: var(--accent); color: white; }

        /* --- CONTENEDORES --- */
        .container { 
            width: 95%; max-width: 1200px; margin: 20px auto; padding: 20px; 
            border-radius: 15px; background: var(--bg-glass);
            backdrop-filter: blur(8px); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        .hidden { display: none !important; }
        .section-title { text-align: center; color: var(--primary); text-transform: uppercase; margin-bottom: 20px; border-bottom: 2px solid var(--accent); display: inline-block; padding-bottom: 5px; font-weight: 800; max-width: 100%; word-wrap: break-word; }
        .center-wrapper { text-align: center; }

        /* --- HOME GRID --- */
        .home-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 15px; }
        @media (min-width: 768px) { .home-grid { grid-template-columns: repeat(4, 1fr); } }
        .home-card {
            background: rgba(255,255,255,0.9); padding: 20px 5px; border-radius: 15px;
            text-align: center; border: 2px solid rgba(0,0,0,0.05); cursor: pointer;
            transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; overflow: hidden;
        }
        .home-card:hover { transform: translateY(-5px) scale(1.02); border-color: var(--accent); box-shadow: 0 10px 20px rgba(255,140,0,0.2); }
        .home-icon { font-size: 2.5rem; color: var(--accent); margin-bottom: 10px; }
        .home-title { font-weight: 800; text-transform: uppercase; font-size: 0.8rem; color: var(--primary); width: 100%; overflow-wrap: break-word; word-wrap: break-word; hyphens: auto; }

        @media (max-width: 480px) {
            .container { width: 96% !important; padding: 15px 10px !important; margin: 15px auto !important; }
            .home-grid { gap: 10px !important; }
            .home-icon { font-size: 2rem !important; }
            .home-card { padding: 15px 2px !important; }
        }

        /* --- ELEMENTOS PRODUCTOS --- */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .product-card, .review-card { 
            background: rgba(255, 255, 255, 0.85); padding: 15px; border-radius: 10px; text-align: center; border: 1px solid rgba(0,0,0,0.1); position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .product-photo { width: 100%; height: 180px; object-fit: contain; border-radius: 5px; background: white; margin-bottom: 10px;}
        .brand-tag { position: absolute; top: 15px; left: 15px; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; color: white; background: rgba(0,0,0,0.8); }
        
        .specs-badge {
            background: #eee; color: #333; font-size: 0.75rem; font-weight: bold;
            padding: 5px; border-radius: 5px; margin: 5px 0; display: inline-block; width: 100%;
        }

        /* --- CARPETAS (Para Teleco y M√≥viles) --- */
        .folder-card {
            background: white; border-radius: 15px; padding: 20px; text-align: center;
            border: 2px solid #eee; transition: 0.3s; cursor: pointer; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .folder-card:hover { border-color: var(--accent); transform: translateY(-3px); box-shadow: 0 10px 25px rgba(255,140,0,0.15); }
        .folder-icon { width: 60px; height: 60px; object-fit: cover; border-radius: 50%; margin-bottom: 10px; border: 2px solid var(--accent); background: #fff; }
        .folder-title { font-weight: 800; font-size: 1rem; text-transform: uppercase; }

        /* --- BOTONES Y PRECIOS --- */
        .price { font-size: 1.2rem; font-weight: 800; color: var(--accent); margin: 10px 0; }
        
        /* Botones Est√°ndar */
        .btn-primary { background: var(--primary); color: white; border: none; padding: 12px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; font-size: 0.9rem; transition: 0.3s; }
        .btn-primary:hover { background: var(--accent); }
        
        /* Bot√≥n Espec√≠fico para Stripe */
        .btn-stripe { background: var(--stripe); color: white; border: none; padding: 12px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; font-size: 0.9rem; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none;}
        .btn-stripe:hover { background: #4b44d4; box-shadow: 0 4px 12px rgba(99, 91, 255, 0.4); }

        .btn-secondary { background: white; color: var(--primary); border: 2px solid var(--primary); padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; }
        .btn-delete { background: #e74c3c; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 5px; font-weight: bold; margin-left: 5px; }
        .btn-back { background: #eee; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; margin-bottom: 15px; cursor: pointer; display: inline-flex; align-items: center; gap: 5px; }

        /* --- MODALES Y ADMIN --- */
        .admin-panel { background: rgba(255, 248, 225, 0.98); border: 2px dashed var(--accent); margin-bottom: 20px; padding: 15px; }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; overflow-x: auto; }
        .admin-tab-btn { background: none; border: none; font-weight: bold; cursor: pointer; opacity: 0.5; font-size: 0.9rem; white-space: nowrap; }
        .admin-tab-btn.active { opacity: 1; color: var(--accent); border-bottom: 2px solid var(--accent); }
        .admin-actions { display: flex; gap: 5px; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.1); justify-content: center;}

        .form-box { max-width: 100%; margin: 0 auto; background: rgba(255,255,255,0.95); padding: 20px; border-radius: 10px; }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; background: rgba(255,255,255,0.9); font-size: 16px; }
        
        /* Campo especial para el link de Stripe en admin */
        .input-stripe { border: 2px solid var(--stripe); background-color: #f0f0ff; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: rgba(255,255,255,0.98); padding: 25px; width: 90%; max-width: 500px; border-radius: 10px; position: relative; max-height: 90vh; overflow-y: auto; }
        .close { position: absolute; top: 10px; right: 20px; font-size: 1.8rem; cursor: pointer; color: #333; }
        
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 20px; z-index: 3000; display: none; width: max-content; max-width: 90%; text-align: center; }
        footer { text-align: center; padding: 30px; background: rgba(17,17,17,0.95); color: white; margin-top: 50px; width: 100%; }
        
        /* ZONA PC */
        .pc-option-card { background: white; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #eee; transition: 0.3s; cursor: pointer; }
        .pc-icon { font-size: 3rem; color: var(--accent); margin-bottom: 15px; }
        
        /* QUIZ */
        #quiz-wrapper { max-width: 600px; margin: 0 auto; text-align: center; }
        .quiz-btn { background: white; border: 2px solid #ddd; padding: 15px; border-radius: 10px; font-size: 1rem; cursor: pointer; transition: 0.2s; text-align: left; font-weight: 600; color: #555; width: 100%; margin-bottom: 10px; }
        .quiz-btn:hover { border-color: var(--accent); color: var(--accent); background: #fff8e1; }
        .quiz-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .quiz-btn.wrong { background: var(--error); color: white; border-color: var(--error); }
        .score-display { font-size: 3rem; color: var(--accent); font-weight: 800; display: block; margin: 20px 0; }
    </style>
</head>
<body>

    <div id="welcome-screen">
        <div class="tech-logo">MOVINET<span>CONDE</span></div>
        <p style="text-transform:uppercase; letter-spacing:1px; margin-top:10px;">Bienvenido al Futuro</p>
        <div class="loader-line"></div>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-top">
                <a href="#" class="logo-container">
                    <h1 class="logo-text">MOVINET<span>CONDE</span></h1>
                </a>
                <div class="nav-icons">
                    <button onclick="gestionarPerfil()" class="btn-icon"><i class="fas fa-user-circle"></i></button>
                    <button onclick="abrirModal('admin-login-modal')" class="btn-icon"><i class="fas fa-lock"></i></button>
                </div>
            </div>
            <div class="nav-menu">
                <button onclick="verSeccion('inicio')" class="menu-btn active" id="btn-inicio">üè† Inicio</button>
                <button onclick="verSeccion('contacto')" class="menu-btn" id="btn-contacto">üìû Contacto</button>
                <button onclick="verSeccion('catalogo')" class="menu-btn" id="btn-catalogo">üì± M√≥viles</button>
                <button onclick="verSeccion('reparaciones')" class="menu-btn" id="btn-reparaciones">üîß Taller</button>
                <button onclick="verSeccion('teleco')" class="menu-btn" id="btn-teleco">üì° Telecom</button>
                <button onclick="verSeccion('pcs')" class="menu-btn" id="btn-pcs">üñ•Ô∏è PC</button>
                <button onclick="verSeccion('patines')" class="menu-btn" id="btn-patines">üõ¥ Patines</button>
                <button onclick="verSeccion('webs')" class="menu-btn" id="btn-webs">üé® Webs</button>
                <button onclick="verSeccion('reacondicionados')" class="menu-btn" id="btn-reacondicionados">‚ôªÔ∏è Reaco</button>
                <button onclick="verSeccion('quiz')" class="menu-btn" id="btn-quiz">‚ùì Quiz</button>
                <button onclick="verSeccion('resenas')" class="menu-btn" id="btn-resenas">‚≠ê Opiniones</button>
            </div>
        </div>
    </nav>

    <div id="admin-panel" class="container admin-panel hidden">
        <h3 style="margin-top:0;">Panel de Administraci√≥n</h3>
        <div class="admin-tabs">
            <button class="admin-tab-btn active" onclick="verAdminTab('pedidos')">üö® PEDIDOS</button>
            <button class="admin-tab-btn" onclick="verAdminTab('leads')">üìû LEADS</button>
            <button class="admin-tab-btn" onclick="verAdminTab('productos')">M√≥viles</button>
            <button class="admin-tab-btn" onclick="verAdminTab('teleco')">Telecom</button>
            <button class="admin-tab-btn" onclick="verAdminTab('webs')">Webs</button>
            <button class="admin-tab-btn" onclick="verAdminTab('quiz')">TRIVIA</button>
            <button class="admin-tab-btn" onclick="verAdminTab('resenas')">Opiniones</button>
        </div>

        <div id="admin-tab-pedidos">
            <h4 style="color:var(--accent);">√öltimos Pedidos</h4>
            <div id="admin-orders-list" class="grid-container" style="grid-template-columns: 1fr;">Cargando...</div>
        </div>

        <div id="admin-tab-leads" class="hidden">
            <h4 style="color:var(--accent);">Contactos Capturados</h4>
            <div id="admin-leads-list" class="grid-container" style="grid-template-columns: 1fr;">Cargando...</div>
        </div>

        <div id="admin-tab-productos" class="hidden">
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:20px;">
                
                <div style="background:white; padding:15px; border-radius:10px; border: 1px solid #ccc;">
                    <h4 style="color:var(--accent); margin-top:0;">1. Crear Carpeta/Marca</h4>
                    <form id="addMovilBrandForm" style="margin-bottom:15px;">
                        <input type="file" id="brandImg" accept="image/*" required>
                        <input type="text" id="brandName" placeholder="Nombre Marca (Ej: Samsung)" required>
                        <button type="submit" class="btn-secondary" id="btn-save-brand">CREAR MARCA</button>
                    </form>
                    
                    <div style="border-top: 2px dashed #eee; padding-top: 10px;">
                        <h5 style="margin:0 0 10px 0;">üóëÔ∏è Borrar Marcas:</h5>
                        <div id="admin-brands-list" style="max-height: 200px; overflow-y: auto;">Cargando...</div>
                    </div>
                </div>

                <div style="background:white; padding:15px; border-radius:10px; border: 1px solid #ccc;">
                    <h4 style="color:var(--accent); margin-top:0;">2. Subir M√≥vil</h4>
                    <p style="font-size:0.8rem; color:#666; margin-bottom:10px;">
                        Para pagos con tarjeta: Crea el producto en Stripe, copia el "Enlace de Pago" y p√©galo abajo.
                    </p>
                    <form id="addProductForm">
                        <label style="font-size:0.8rem; font-weight:bold;">¬øEn qu√© carpeta va?</label>
                        <select id="newBrandSelect" required>
                            <option value="">Cargando marcas...</option>
                        </select>
                        
                        <input type="file" id="newImg" accept="image/*">
                        <input type="text" id="newName" placeholder="Modelo (Ej: Galaxy S22)" required>
                        
                        <input type="url" id="newStripeLink" class="input-stripe" placeholder="Enlace Stripe (https://buy.stripe.com/...)">

                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                            <input type="number" id="newGB" placeholder="GB Almac.">
                            <input type="number" id="newRAM" placeholder="GB RAM">
                        </div>

                        <input type="number" id="newPrice" placeholder="Precio (‚Ç¨)" required>
                        <button type="submit" class="btn-primary" id="btn-save-product">GUARDAR M√ìVIL</button>
                    </form>
                </div>

            </div>
        </div>

        <div id="admin-tab-teleco" class="hidden">
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:20px;">
                <div style="background:white; padding:15px; border-radius:10px; border: 1px solid #ccc;">
                    <h4 style="color:var(--accent);">1. Carpetas</h4>
                    <form id="addFolderForm" style="margin-bottom:15px;">
                        <input type="file" id="folderImg" accept="image/*" required>
                        <input type="text" id="folderName" placeholder="Nombre Carpeta" required>
                        <button type="submit" class="btn-primary" id="btn-save-folder">CREAR CARPETA</button>
                    </form>
                    <div id="admin-folders-list"></div>
                </div>

                <div style="background:white; padding:15px; border-radius:10px; border: 1px solid #ccc;">
                    <h4 style="color:var(--accent);">2. Ofertas</h4>
                    <form id="addOfferForm" style="margin-bottom:15px;">
                        <select id="offerFolderSelect" required><option value="">Selecciona Carpeta...</option></select>
                        <input type="file" id="offerImg" accept="image/*">
                        <input type="text" id="offerTitle" placeholder="T√≠tulo" required>
                        <input type="text" id="offerDesc" placeholder="Descripci√≥n" required>
                        <input type="number" id="offerPrice" placeholder="Precio">
                        <button type="submit" class="btn-primary" id="btn-save-offer">CREAR OFERTA</button>
                    </form>
                    <div id="admin-offers-admin-list"></div>
                </div>
            </div>
        </div>

        <div id="admin-tab-webs" class="hidden">
            <h3>Subir Plantilla Web</h3>
            <form id="addWebForm">
                <input type="file" id="webImg" accept="image/*">
                <input type="text" id="webTitle" placeholder="Nombre Plantilla" required>
                <button type="submit" class="btn-primary" id="btn-save-web">GUARDAR DISE√ëO</button>
            </form>
        </div>

        <div id="admin-tab-quiz" class="hidden">
            <h3>A√±adir Pregunta</h3>
            <form id="addQuizForm">
                <input type="text" id="quizQuestion" placeholder="¬øPregunta?" required>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="text" id="quizOp0" placeholder="Opci√≥n A" required>
                    <input type="text" id="quizOp1" placeholder="Opci√≥n B" required>
                    <input type="text" id="quizOp2" placeholder="Opci√≥n C" required>
                    <input type="text" id="quizOp3" placeholder="Opci√≥n D" required>
                </div>
                <label>Respuesta Correcta:</label>
                <select id="quizCorrect" required>
                    <option value="0">Opci√≥n A</option>
                    <option value="1">Opci√≥n B</option>
                    <option value="2">Opci√≥n C</option>
                    <option value="3">Opci√≥n D</option>
                </select>
                <button type="submit" class="btn-primary">A√ëADIR</button>
            </form>
            <div id="admin-quiz-list"></div>
        </div>
        
        <div id="admin-tab-resenas" class="hidden">
             <h4>Gestionar Opiniones</h4>
             <div id="admin-reviews-list" class="grid-container" style="grid-template-columns: 1fr;"></div>
        </div>

        <button onclick="cerrarSesionAdmin()" style="margin-top:20px; background:#333; color:white; border:none; padding:10px; width:100%;">Cerrar Sesi√≥n Admin</button>
    </div>

    <div id="sec-inicio" class="container">
        <div class="center-wrapper"><h2 class="section-title">¬øQu√© est√°s buscando?</h2></div>
        <div class="home-grid">
            <div class="home-card" onclick="verSeccion('catalogo')"><i class="fas fa-mobile-alt home-icon"></i><div class="home-title">M√≥viles</div></div>
            <div class="home-card" onclick="verSeccion('reparaciones')"><i class="fas fa-tools home-icon"></i><div class="home-title">Reparaciones</div></div>
            <div class="home-card" onclick="verSeccion('teleco')"><i class="fas fa-satellite-dish home-icon"></i><div class="home-title">Telecom</div></div>
            <div class="home-card" onclick="verSeccion('pcs')"><i class="fas fa-desktop home-icon"></i><div class="home-title">Zona PC</div></div>
            <div class="home-card" onclick="verSeccion('patines')"><i class="fas fa-bolt home-icon"></i><div class="home-title">Patines</div></div>
            <div class="home-card" onclick="verSeccion('webs')"><i class="fas fa-paint-brush home-icon"></i><div class="home-title">Dise√±o Web</div></div>
            <div class="home-card" onclick="verSeccion('reacondicionados')"><i class="fas fa-recycle home-icon"></i><div class="home-title">Reacondicionados</div></div>
            <div class="home-card" onclick="verSeccion('quiz')"><i class="fas fa-gamepad home-icon"></i><div class="home-title">Quiz Tech</div></div>
            <div class="home-card" onclick="verSeccion('resenas')"><i class="fas fa-star home-icon"></i><div class="home-title">Opiniones</div></div>
            <div class="home-card" onclick="verSeccion('contacto')"><i class="fas fa-headset home-icon"></i><div class="home-title">Contacto</div></div>
        </div>
    </div>

    <div id="sec-contacto" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">¬øTe Llamamos?</h2></div>
        <div class="form-box glass-effect" style="margin-top:20px; border:2px solid var(--accent);">
            <p style="text-align:center; font-weight:600; margin-bottom:20px;">D√©janos tu n√∫mero y te contactaremos.</p>
            <form id="silentLeadForm">
                <label for="leadNombre">Nombre:</label>
                <input type="text" id="leadNombre" placeholder="Tu nombre" required>
                <label for="leadTelefono">Tel√©fono (WhatsApp):</label>
                <input type="tel" id="leadTelefono" placeholder="Escribe tu n√∫mero..." style="font-size:1.2rem; font-weight:bold; color:var(--accent);" required>
                <label for="leadInteres">Interesado en:</label>
                <select id="leadInteres">
                    <option value="General">Informaci√≥n General</option>
                    <option value="Reparacion Movil">Reparaci√≥n M√≥vil</option>
                    <option value="Patines">Patines</option>
                </select>
                <button type="submit" class="btn-primary">ENVIAR Y ABRIR WHATSAPP</button>
            </form>
        </div>
    </div>

    <div id="sec-catalogo" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">M√≥viles</h2></div>
        
        <div id="catalogo-folders-view">
            <p style="text-align:center; margin-bottom:15px;">Selecciona una marca:</p>
            <div id="brands-container" class="grid-container" style="grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));">
                Cargando marcas...
            </div>
        </div>

        <div id="catalogo-list-view" class="hidden">
            <button class="btn-back" onclick="volverAMarcas()"><i class="fas fa-arrow-left"></i> Volver a Marcas</button>
            <h3 id="current-brand-title" style="margin-left:10px; display:inline-block; text-transform: uppercase;"></h3>
            <div id="productos-container" class="grid-container"></div>
        </div>
    </div>

    <div id="sec-reparaciones" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Reparaci√≥n M√≥viles</h2></div>
        <div class="form-box glass-effect">
            <h3>Solicitar Presupuesto</h3>
            <form id="tallerForm">
                <input type="text" id="tallerNombre" placeholder="Tu Nombre" required>
                <input type="tel" id="tallerTel" placeholder="Tu Tel√©fono" required>
                <input type="text" id="tallerDispositivo" placeholder="Marca y Modelo" required>
                <textarea id="tallerAveria" placeholder="Describe qu√© le pasa..." rows="3"></textarea>
                <button type="submit" class="btn-primary">SOLICITAR PRESUPUESTO</button>
            </form>
        </div>
    </div>

    <div id="sec-teleco" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Telecomunicaci√≥n</h2></div>
        <div id="teleco-folders-view">
            <p style="text-align:center;">Selecciona una categor√≠a:</p>
            <div id="folders-container" class="grid-container" style="grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));">Cargando...</div>
        </div>
        <div id="teleco-offers-view" class="hidden">
            <button class="btn-back" onclick="volverACarpetas()"><i class="fas fa-arrow-left"></i> Volver</button>
            <h3 id="current-folder-title" style="margin-left:10px; display:inline-block;"></h3>
            <div id="offers-container" class="grid-container"></div>
        </div>
    </div>

    <div id="sec-pcs" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Zona PC</h2></div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px;">
            <div class="pc-option-card" onclick="abrirModalPC('reparacion')">
                <i class="fas fa-tools pc-icon"></i><h3>Reparaci√≥n de PC</h3><p>Diagn√≥stico y presupuesto.</p><button class="btn-primary">SOLICITAR</button>
            </div>
            <div class="pc-option-card" onclick="abrirModalPC('fabricacion')">
                <i class="fas fa-microchip pc-icon"></i><h3>PC a Medida</h3><p>Gaming, edici√≥n o trabajo.</p><button class="btn-primary">SOLICITAR</button>
            </div>
        </div>
    </div>

    <div id="sec-patines" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Patines</h2></div>
        <div class="form-box glass-effect">
            <div style="text-align:center; margin-bottom:20px;"><i class="fas fa-scooter" style="font-size:3rem; color:var(--accent);"></i><h3>Presupuesto Express</h3></div>
            <form id="patinForm">
                <input type="text" id="patinNombre" placeholder="Nombre" required>
                <input type="tel" id="patinTel" placeholder="Tel√©fono" required>
                <input type="text" id="patinModelo" placeholder="Modelo Pat√≠n" required>
                <textarea id="patinAveria" placeholder="Aver√≠a..." rows="4" required></textarea>
                <button type="submit" class="btn-primary">ENVIAR</button>
            </form>
        </div>
    </div>

    <div id="sec-webs" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Plantillas Web</h2></div>
        <div id="webs-container" class="grid-container"></div>
        <div style="text-align:center; margin-top:30px;"><button class="btn-primary" style="max-width:300px;" onclick="abrirModalWebPersonalizada()">¬øWeb a medida?</button></div>
    </div>

    <div id="sec-reacondicionados" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Reacondicionados</h2></div>
        <div id="reaco-container" class="grid-container">Cargando...</div>
    </div>
    
    <div id="sec-resenas" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Opiniones</h2></div>
        <div style="text-align:center; margin-bottom:20px;"><button onclick="abrirModal('review-modal')" class="btn-primary" style="width:auto;">Escribir Rese√±a</button></div>
        <div id="reviews-container" class="grid-container">Cargando...</div>
    </div>

    <div id="sec-quiz" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Trivia Tech</h2></div>
        <div id="quiz-wrapper">
            <div id="quiz-start">
                <i class="fas fa-brain" style="font-size: 4rem; color: var(--accent); margin-bottom: 10px;"></i>
                <h3>¬øCu√°nto sabes de tecnolog√≠a?</h3>
                <button class="btn-primary" onclick="startQuiz()">¬°JUGAR!</button>
            </div>
            <div id="quiz-game" class="hidden">
                <div class="question-text" id="questionText">Cargando...</div>
                <div class="options-list" id="optionsList" style="display:grid; gap:10px;"></div>
                <button id="nextBtn" class="btn-primary hidden" onclick="nextQuestion()" style="margin-top: 20px;">Siguiente</button>
            </div>
            <div id="quiz-result" class="hidden">
                <h3>¬°Juego Terminado!</h3>
                <span class="score-display" id="finalScore">0</span>
                <button class="btn-primary" onclick="startQuiz()">Repetir</button>
            </div>
        </div>
    </div>

    <div id="modal-pc-form" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('modal-pc-form')">&times;</span>
            <h3 id="pc-modal-title">Solicitud PC</h3>
            <form id="pcRequestForm">
                <input type="hidden" id="pcTipoServicio">
                <input type="text" id="pcNombre" placeholder="Nombre" required>
                <input type="tel" id="pcTel" placeholder="Tel√©fono" required>
                <textarea id="pcDetalles" placeholder="Detalles..." rows="4" required></textarea>
                <button type="submit" class="btn-primary">ENVIAR</button>
            </form>
        </div>
    </div>
    
    <div id="review-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('review-modal')">&times;</span>
            <h3>Tu Opini√≥n</h3>
            <form id="addReviewForm">
                <input type="text" id="reviewName" placeholder="Nombre" required>
                <select id="reviewStars" required>
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê</option>
                </select>
                <textarea id="reviewText" placeholder="Comentario..." required></textarea>
                <button type="submit" class="btn-primary">Publicar</button>
            </form>
        </div>
    </div>

    <div id="profile-modal" class="modal hidden">
        <div class="modal-content" style="max-width:600px;">
            <span class="close" onclick="cerrarModal('profile-modal')">&times;</span>
            <h2 id="profile-name">Mi Perfil</h2>
            <div class="profile-tabs"><button class="profile-tab active" onclick="verTabPerfil('pedidos')">Mis Pedidos</button></div>
            <div id="tab-pedidos"><div id="user-orders-list">Cargando...</div></div>
            <button onclick="auth.signOut(); cerrarModal('profile-modal');" class="btn-delete" style="background:#333; margin-top:20px;">Cerrar Sesi√≥n</button>
        </div>
    </div>

    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('auth-modal')">&times;</span>
            <h2 style="text-align:center">Acceso Clientes</h2>
            <form id="authForm">
                <input type="email" id="authEmail" placeholder="Email" required>
                <input type="password" id="authPass" placeholder="Contrase√±a" required>
                <div style="display:flex; gap:10px;">
                    <button type="button" class="btn-primary" onclick="handleAuth('login')">Entrar</button>
                    <button type="button" class="btn-secondary" onclick="handleAuth('register')">Registrarse</button>
                </div>
                <p id="authError" style="color:red; text-align:center; margin-top:10px;"></p>
            </form>
        </div>
    </div>

    <div id="admin-login-modal" class="modal hidden">
        <div class="modal-content" style="max-width:300px; text-align:center;">
            <span class="close" onclick="cerrarModal('admin-login-modal')">&times;</span>
            <h3>Zona Admin</h3>
            <input type="password" id="adminPassInput" placeholder="Clave">
            <button onclick="verificarAdmin()" class="btn-primary">Entrar</button>
        </div>
    </div>

    <div id="welcome-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 350px; text-align: center; border: 2px solid var(--accent);">
            <span class="close" onclick="cerrarModal('welcome-modal')">&times;</span>
            <div style="margin-bottom: 15px;"><i class="fas fa-hand-sparkles" style="font-size: 3rem; color: var(--accent);"></i></div>
            <h3 style="margin: 0; color: var(--primary);">¬øTe ayudamos?</h3>
            <p style="font-size: 0.9rem; margin-bottom: 20px;">D√©janos tu n√∫mero y te llamamos.</p>
            <form id="welcomeForm">
                <input type="text" id="welcomeNombre" placeholder="Tu Nombre" required style="text-align:center;">
                <input type="tel" id="welcomeTel" placeholder="Tu WhatsApp/Tel√©fono" required style="text-align:center; font-weight:bold; color: var(--accent);">
                <button type="submit" class="btn-primary">üìû QUIERO QUE ME LLAMEN</button>
                <p style="font-size: 0.7rem; margin-top: 10px; opacity: 0.7; cursor:pointer;" onclick="cerrarModal('welcome-modal')">No, gracias.</p>
            </form>
        </div>
    </div>
    
    <div id="toast" class="toast">Guardado</div>

    <footer>
        <a href="https://www.instagram.com/movinetconde/" target="_blank" style="color:var(--accent); font-size:2rem;"><i class="fab fa-instagram"></i></a>
        <p>&copy; 2025 MOVINETCONDE</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAO9sshvU5zUf_S9d12toWwrioeXBonlRc",
            authDomain: "movinet-conde-web.firebaseapp.com",
            projectId: "movinet-conde-web",
            appId: "1:867268264562:web:f28e33585cdcde3d8e78eb"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let usuarioActual = null; let esAdmin = false;
        let allProducts = []; 
        let allQuestions = []; 
        let telecomFolders = [];
        let mobileBrands = []; 
        const MI_TELEFONO = "34613509309"; 
        const FORMSPREE_URL = "https://formspree.io/f/xwvqgdob";
        const EMAIL_SECUNDARIO = "movinetconde@gmail.com";

        function enviarDatosUnificados(datos, mensajeWhatsapp) {
            datos["_cc"] = EMAIL_SECUNDARIO; 
            datos["copia_para"] = EMAIL_SECUNDARIO;
            fetch(FORMSPREE_URL, {
                method: "POST", headers: { "Content-Type": "application/json", "Accept": "application/json" },
                body: JSON.stringify(datos)
            }).then(r => console.log("Email enviado")).catch(e => console.error(e));
            
            db.collection('leads_capturados').add({ ...datos, fecha: new Date().toISOString(), leido: false });
            
            const url = `https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(mensajeWhatsapp)}`;
            window.open(url, '_blank');
            mostrarToast("Solicitud enviada");
        }

        // --- L√ìGICA M√ìVILES NUEVA ---
        
        // 1. Cargar las Carpetas (Marcas) disponibles
        function cargarMarcasMoviles() {
            db.collection("moviles_marcas").orderBy("nombre").onSnapshot(snap => {
                mobileBrands = [];
                const container = document.getElementById('brands-container'); // Vista Cliente
                const selectAdmin = document.getElementById('newBrandSelect'); // Select Admin (Upload)
                const listAdmin = document.getElementById('admin-brands-list'); // Lista Admin (Borrar)
                
                if(container) container.innerHTML = "";
                if(selectAdmin) selectAdmin.innerHTML = '<option value="">Selecciona Carpeta...</option>';
                if(listAdmin) listAdmin.innerHTML = "";

                if(snap.empty) {
                     if(container) container.innerHTML = "<p>No hay marcas disponibles.</p>";
                     return;
                }

                snap.forEach(doc => {
                    const b = doc.data(); 
                    const id = doc.id;
                    mobileBrands.push({...b, id});

                    // Vista Cliente (Grid de carpetas)
                    if(container) {
                        container.innerHTML += `
                            <div class="folder-card" onclick="verMovilesDeMarca('${b.nombre}')">
                                <img src="${b.img}" class="folder-icon" style="background:white; padding:5px;">
                                <div class="folder-title">${b.nombre}</div>
                            </div>`;
                    }
                    
                    // Select Admin (Para subir m√≥vil)
                    if(selectAdmin) {
                        selectAdmin.innerHTML += `<option value="${b.nombre}">${b.nombre}</option>`;
                    }

                    // Lista Admin (Para borrar)
                    if(listAdmin) {
                        listAdmin.innerHTML += `
                            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; background:#f9f9f9; padding:5px; border-radius:5px;">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <img src="${b.img}" style="width:30px; height:30px; border-radius:50%; object-fit:cover;">
                                    <span style="font-weight:bold; font-size:0.9rem;">${b.nombre}</span>
                                </div>
                                <button class="btn-delete" onclick="borrar('moviles_marcas','${id}')"><i class="fas fa-trash"></i></button>
                            </div>`;
                    }
                });
            });
        }

        // 2. Cargar los Productos (M√≥viles)
        function cargarProductos() {
            db.collection("productos").orderBy("fecha", "desc").onSnapshot(snap => {
                allProducts = []; 
                snap.forEach(doc => allProducts.push({...doc.data(), id: doc.id}));
            });
        }

        // 3. Ver M√≥viles dentro de la carpeta seleccionada (CON BOTONES INTELIGENTES)
        function verMovilesDeMarca(marcaNombre) {
            document.getElementById('catalogo-folders-view').classList.add('hidden');
            document.getElementById('catalogo-list-view').classList.remove('hidden');
            document.getElementById('current-brand-title').innerText = marcaNombre;
            
            const container = document.getElementById('productos-container');
            container.innerHTML = "Cargando...";
            
            // Filtramos por el nombre de la marca guardado en el producto
            const filtrados = allProducts.filter(p => p.marca === marcaNombre);
            container.innerHTML = "";

            if(filtrados.length === 0) {
                container.innerHTML = "<p>A√∫n no hay m√≥viles en esta carpeta.</p>";
                return;
            }

            filtrados.forEach(p => {
                let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-delete" onclick="borrar('productos','${p.id}')">üóëÔ∏è</button></div>` : '';
                
                // BADGE DE GB Y RAM
                let infoExtra = "";
                if(p.ram || p.gb) {
                    infoExtra = `<div class="specs-badge">
                                    üíæ ${p.gb || '?'}GB | üöÄ ${p.ram || '?'}GB RAM
                                 </div>`;
                }

                // üü¢ L√ìGICA DE BOT√ìN INTELIGENTE (STRIPE vs WHATSAPP)
                let botonCompraHTML = "";
                if (p.stripeLink && p.stripeLink.includes('http')) {
                    // Si hay enlace de Stripe, mostramos bot√≥n de Tarjeta
                    botonCompraHTML = `
                        <a href="${p.stripeLink}" target="_blank" class="btn-stripe">
                            <i class="fab fa-stripe-s"></i> PAGAR CON TARJETA
                        </a>
                        <p style="font-size:0.7rem; color:var(--text); opacity:0.8; margin-top:5px;">Env√≠o üöö a Domicilio incluido</p>
                    `;
                } else {
                    // Si NO hay enlace, mostramos bot√≥n de WhatsApp
                    const msg = `Hola, me interesa el ${p.nombre} (${p.gb}GB) por ${p.precio}‚Ç¨.`;
                    botonCompraHTML = `
                        <a href="https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(msg)}" target="_blank" style="text-decoration:none;">
                            <button class="btn-primary" style="background:#25D366; display:flex; align-items:center; justify-content:center; gap:8px;">
                                <i class="fab fa-whatsapp"></i> PEDIR POR WHATSAPP
                            </button>
                        </a>`;
                }

                container.innerHTML += `
                    <div class="product-card">
                        <span class="brand-tag">${p.marca}</span>
                        <img src="${p.img}" class="product-photo">
                        <h3 style="margin-bottom:5px;">${p.nombre}</h3>
                        ${infoExtra}
                        <p class="price">${p.precio}‚Ç¨</p>
                        ${botonCompraHTML}
                        ${adminBtns}
                    </div>`;
            });
        }

        function volverAMarcas() {
            document.getElementById('catalogo-list-view').classList.add('hidden');
            document.getElementById('catalogo-folders-view').classList.remove('hidden');
        }


        // --- L√ìGICA TELECO ---
        function cargarCarpetasTeleco() {
            db.collection("telecom_carpetas").orderBy("nombre").onSnapshot(snap => {
                telecomFolders = [];
                const container = document.getElementById('folders-container'); 
                const selectAdmin = document.getElementById('offerFolderSelect'); 
                const listAdmin = document.getElementById('admin-folders-list');
                
                if(container) container.innerHTML = "";
                if(selectAdmin) selectAdmin.innerHTML = '<option value="">Selecciona Carpeta...</option>';
                if(listAdmin) listAdmin.innerHTML = "";

                snap.forEach(doc => {
                    const f = doc.data(); const id = doc.id;
                    telecomFolders.push({...f, id});
                    if(container) {
                        container.innerHTML += `<div class="folder-card" onclick="verOfertasDeCarpeta('${id}', '${f.nombre}')"><img src="${f.img}" class="folder-icon"><div class="folder-title">${f.nombre}</div></div>`;
                    }
                    if(selectAdmin) selectAdmin.innerHTML += `<option value="${id}">${f.nombre}</option>`;
                    if(listAdmin) listAdmin.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>${f.nombre}</span><button class="btn-delete" onclick="borrar('telecom_carpetas','${id}')">üóëÔ∏è</button></div>`;
                });
                cargarOfertasTelecoAdmin(); 
            });
        }
        function cargarOfertasTelecoAdmin() {
            db.collection("telecom_ofertas").orderBy("fecha", "desc").onSnapshot(snap => {
                const listDiv = document.getElementById('admin-offers-admin-list');
                if(!listDiv) return; listDiv.innerHTML = "";
                snap.forEach(doc => {
                    const o = doc.data();
                    const carp = telecomFolders.find(f => f.id === o.folderId)?.nombre || '??';
                    listDiv.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px; border-bottom:1px solid #eee;"><span>${o.titulo} (${carp})</span><button class="btn-delete" onclick="borrar('telecom_ofertas','${doc.id}')">üóëÔ∏è</button></div>`;
                });
            });
        }
        function verOfertasDeCarpeta(folderId, folderName) {
            document.getElementById('teleco-folders-view').classList.add('hidden');
            document.getElementById('teleco-offers-view').classList.remove('hidden');
            document.getElementById('current-folder-title').innerText = folderName;
            const container = document.getElementById('offers-container');
            container.innerHTML = "Cargando...";
            db.collection("telecom_ofertas").where("folderId", "==", folderId).onSnapshot(snap => {
                container.innerHTML = "";
                if(snap.empty) { container.innerHTML = "<p>No hay ofertas.</p>"; return; }
                snap.forEach(doc => {
                    const o = doc.data();
                    container.innerHTML += `<div class="product-card"><img src="${o.img}" class="product-photo"><h3>${o.titulo}</h3><p>${o.descripcion}</p>${o.precio ? `<p class="price">${o.precio}‚Ç¨</p>` : ''}<button class="btn-primary" onclick="pedirInfoOferta('${o.titulo}')">ME INTERESA</button></div>`;
                });
            });
        }
        function volverACarpetas() {
            document.getElementById('teleco-offers-view').classList.add('hidden');
            document.getElementById('teleco-folders-view').classList.remove('hidden');
        }
        function pedirInfoOferta(titulo) {
            const nom = prompt("Tu nombre:");
            if(nom) enviarDatosUnificados({servicio: "Interes Oferta Teleco", oferta: titulo, nombre: nom}, `Hola, me interesa: ${titulo}. Soy ${nom}.`);
        }

        // --- COMPRESI√ìN IM√ÅGENES ---
        async function guardarItem(col, id, data, fileIn, btnId) {
            const btn = document.getElementById(btnId);
            const originalBtnText = btn ? btn.innerText : 'GUARDAR';
            if(btn) { btn.disabled = true; btn.innerText = "‚è≥ SUBIENDO..."; }
            const f = document.getElementById(fileIn) ? document.getElementById(fileIn).files[0] : null;
            if(f) { 
                try {
                    const imagenComprimida = await comprimirImagen(f);
                    if (imagenComprimida.length > 950000) { alert("Imagen muy pesada. Usa captura."); if(btn){btn.disabled=false; btn.innerText=originalBtnText;} return; }
                    data.img = imagenComprimida;
                } catch (error) { console.error(error); if(btn){btn.disabled=false; btn.innerText=originalBtnText;} return; }
            }
            try { await db.collection(col).add({...data, fecha: new Date().toISOString()}); mostrarToast("Guardado"); } 
            catch (error) { alert("Error: " + error.message); } 
            finally { if(btn) { btn.disabled = false; btn.innerText = originalBtnText; } }
        }
        function comprimirImagen(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader(); reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image(); img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                        const maxWidth = 500; const scaleSize = maxWidth / img.width;
                        const newWidth = (img.width > maxWidth) ? maxWidth : img.width;
                        const newHeight = (img.width > maxWidth) ? (img.height * scaleSize) : img.height;
                        canvas.width = newWidth; canvas.height = newHeight;
                        ctx.fillStyle = "#FFFFFF"; ctx.fillRect(0, 0, newWidth, newHeight); ctx.drawImage(img, 0, 0, newWidth, newHeight);
                        resolve(canvas.toDataURL('image/jpeg', 0.6)); 
                    }; img.onerror = reject;
                }; reader.onerror = reject;
            });
        }

        // --- HANDLERS ADMIN (EVENT LISTENERS) ---
        
        // 1. Crear Carpeta de M√≥vil
        if(document.getElementById('addMovilBrandForm')) {
            document.getElementById('addMovilBrandForm').addEventListener('submit', e => {
                e.preventDefault();
                const data = { nombre: document.getElementById('brandName').value };
                guardarItem('moviles_marcas', null, data, 'brandImg', 'btn-save-brand')
                .then(() => document.getElementById('addMovilBrandForm').reset());
            });
        }

        // 2. Subir M√≥vil (AHORA CON LINK DE STRIPE)
        if(document.getElementById('addProductForm')) {
            document.getElementById('addProductForm').addEventListener('submit', e=>{ 
                e.preventDefault(); 
                const selectedBrand = document.getElementById('newBrandSelect').value;
                if(!selectedBrand) return alert("¬°Debes seleccionar una carpeta!");

                const data = {
                    nombre: document.getElementById('newName').value, 
                    marca: selectedBrand, 
                    gb: document.getElementById('newGB').value,
                    ram: document.getElementById('newRAM').value,
                    precio: Number(document.getElementById('newPrice').value),
                    // üü¢ GUARDAMOS EL ENLACE DE STRIPE
                    stripeLink: document.getElementById('newStripeLink').value 
                };
                guardarItem('productos', null, data, 'newImg', 'btn-save-product')
                .then(()=>{ document.getElementById('addProductForm').reset(); }); 
            });
        }

        // Otros handlers
        if(document.getElementById('addFolderForm')) { document.getElementById('addFolderForm').addEventListener('submit', e => { e.preventDefault(); guardarItem('telecom_carpetas', null, { nombre: document.getElementById('folderName').value }, 'folderImg', 'btn-save-folder').then(() => document.getElementById('addFolderForm').reset()); }); }
        if(document.getElementById('addOfferForm')) { document.getElementById('addOfferForm').addEventListener('submit', e => { e.preventDefault(); const data = { folderId: document.getElementById('offerFolderSelect').value, titulo: document.getElementById('offerTitle').value, descripcion: document.getElementById('offerDesc').value, precio: document.getElementById('offerPrice').value }; guardarItem('telecom_ofertas', null, data, 'offerImg', 'btn-save-offer').then(() => document.getElementById('addOfferForm').reset()); }); }
        if(document.getElementById('addWebForm')) { document.getElementById('addWebForm').addEventListener('submit', e=>{ e.preventDefault(); guardarItem('webs', null, { titulo: document.getElementById('webTitle').value }, 'webImg', 'btn-save-web').then(()=>{document.getElementById('addWebForm').reset()}); }); }

        // --- FORMULARIOS USUARIO ---
        function abrirModalPC(tipo) { document.getElementById('pcTipoServicio').value = tipo; document.getElementById('pc-modal-title').innerText = tipo === 'reparacion' ? "Presupuesto Reparaci√≥n PC" : "Fabricaci√≥n PC a Medida"; abrirModal('modal-pc-form'); }
        document.getElementById('pcRequestForm').addEventListener('submit', (e) => { e.preventDefault(); enviarDatosUnificados({ servicio: "PC " + document.getElementById('pcTipoServicio').value, nombre: document.getElementById('pcNombre').value, telefono: document.getElementById('pcTel').value, detalles: document.getElementById('pcDetalles').value }, `Hola, interesado en PC (${document.getElementById('pcTipoServicio').value}).`); cerrarModal('modal-pc-form'); document.getElementById('pcRequestForm').reset(); });
        document.getElementById('patinForm').addEventListener('submit', (e) => { e.preventDefault(); enviarDatosUnificados({ servicio: "Reparacion Patin", nombre: document.getElementById('patinNombre').value, telefono: document.getElementById('patinTel').value, modelo: document.getElementById('patinModelo').value, averia: document.getElementById('patinAveria').value }, `Hola. Aver√≠a pat√≠n: ${document.getElementById('patinAveria').value}.`); document.getElementById('patinForm').reset(); });
        document.getElementById('tallerForm').addEventListener('submit', (e) => { e.preventDefault(); enviarDatosUnificados({ servicio: "Reparacion Movil", nombre: document.getElementById('tallerNombre').value, telefono: document.getElementById('tallerTel').value, dispositivo: document.getElementById('tallerDispositivo').value, averia: document.getElementById('tallerAveria').value }, `Hola, reparar ${document.getElementById('tallerDispositivo').value}.`); document.getElementById('tallerForm').reset(); });

        let temporizadorLead; let leadYaEnviado = false;
        const inputTelLead = document.getElementById('leadTelefono');
        inputTelLead.addEventListener('input', function() { if(inputTelLead.value.length < 9) leadYaEnviado = false; clearTimeout(temporizadorLead); temporizadorLead = setTimeout(() => { if (inputTelLead.value.length >= 9 && !leadYaEnviado) { enviarDatosUnificados({origen: "Captura Web", nombre: document.getElementById('leadNombre').value, telefono: inputTelLead.value}, `Hola, estaba viendo vuestra web.`); leadYaEnviado = true; } }, 2000); });
        document.getElementById('silentLeadForm').addEventListener('submit', (e) => { e.preventDefault(); enviarDatosUnificados({servicio: "Contacto General", nombre: document.getElementById('leadNombre').value, telefono: document.getElementById('leadTelefono').value, interes: document.getElementById('leadInteres').value}, `Hola, me interesa: ${document.getElementById('leadInteres').value}.`); });

        // --- NAVEGACI√ìN ---
        function verSeccion(id) {
            document.querySelectorAll('[id^="sec-"]').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`sec-${id}`).classList.remove('hidden');
            document.getElementById(`btn-${id}`).classList.add('active');
        }

        // --- OTROS DATOS ---
        function cargarWebs() {
            db.collection("webs").onSnapshot(snap => {
                const c = document.getElementById('webs-container'); c.innerHTML="";
                snap.forEach(doc => { const w = doc.data(); let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-delete" onclick="borrar('webs','${doc.id}')">üóëÔ∏è</button></div>` : ''; c.innerHTML += `<div class="product-card"><img src="${w.img}" class="product-photo" style="object-fit:contain; height:180px;"><h3>${w.titulo}</h3><button class="btn-primary" onclick="abrirModalWebPersonalizada('${w.titulo}')">ELEGIR</button>${adminBtns}</div>`; });
            });
        }
        function abrirModalWebPersonalizada(diseno="General") { const nom = prompt("Dinos tu nombre:"); if(nom) enviarDatosUnificados({servicio: "Interes Web", dise√±o: diseno, nombre: nom}, `Hola, me interesa web: ${diseno}.`); }

        document.getElementById('addReviewForm').addEventListener('submit', async (e) => { e.preventDefault(); await db.collection('resenas').add({ nombre: document.getElementById('reviewName').value, estrellas: document.getElementById('reviewStars').value, texto: document.getElementById('reviewText').value, fecha: new Date().toISOString() }); alert("Enviada"); cerrarModal('review-modal'); });
        function cargarResenas() { db.collection('resenas').orderBy('fecha', 'desc').onSnapshot(snap => { const d = document.getElementById('reviews-container'); d.innerHTML=""; const adminList = document.getElementById('admin-reviews-list'); if(esAdmin && adminList) adminList.innerHTML = ""; snap.forEach(doc => { const r = doc.data(); d.innerHTML += `<div class="review-card"><div style="color:gold;">${"‚≠ê".repeat(r.estrellas)}</div><b>${r.nombre}</b><p>${r.texto}</p></div>`; if(esAdmin && adminList) adminList.innerHTML += `<div class="review-card" style="text-align:left;"><b>${r.nombre}</b><button class="btn-delete" onclick="borrar('resenas','${doc.id}')">X</button></div>`; }); }); }

        // --- QUIZ ---
        function cargarQuiz() { db.collection("quiz").orderBy("fecha", "desc").onSnapshot(snap => { allQuestions = []; const listDiv = document.getElementById('admin-quiz-list'); if(listDiv) listDiv.innerHTML = ""; snap.forEach(doc => { const q = doc.data(); allQuestions.push({...q, id: doc.id}); if(esAdmin && listDiv) listDiv.innerHTML += `<div style="padding:10px; border-bottom:1px solid #ccc;"><b>${q.pregunta}</b> <button onclick="borrar('quiz','${doc.id}')">X</button></div>`; }); }); }
        let currentQuestion = 0; let score = 0;
        function startQuiz() { if(allQuestions.length === 0) return alert("Cargando..."); currentQuestion = 0; score = 0; document.getElementById('quiz-start').classList.add('hidden'); document.getElementById('quiz-result').classList.add('hidden'); document.getElementById('quiz-game').classList.remove('hidden'); showQuestion(); }
        function showQuestion() { document.getElementById('nextBtn').classList.add('hidden'); const q = allQuestions[currentQuestion]; document.getElementById('questionText').innerText = q.pregunta; const optsDiv = document.getElementById('optionsList'); optsDiv.innerHTML = ""; q.opciones.forEach((opt, index) => { const btn = document.createElement('button'); btn.className = "quiz-btn"; btn.innerText = opt; btn.onclick = () => checkAnswer(index, btn, q.correcta); optsDiv.appendChild(btn); }); }
        function checkAnswer(selected, btnElement, correct) { document.querySelectorAll('.quiz-btn').forEach(b => b.disabled = true); if(selected === correct) { btnElement.classList.add('correct'); score++; } else { btnElement.classList.add('wrong'); } document.getElementById('nextBtn').classList.remove('hidden'); }
        function nextQuestion() { currentQuestion++; if(currentQuestion < allQuestions.length) showQuestion(); else showResult(); }
        function showResult() { document.getElementById('quiz-game').classList.add('hidden'); document.getElementById('quiz-result').classList.remove('hidden'); document.getElementById('finalScore').innerText = `${score} / ${allQuestions.length}`; }
        document.getElementById('addQuizForm').addEventListener('submit', async (e) => { e.preventDefault(); const data = { pregunta: document.getElementById('quizQuestion').value, opciones: [document.getElementById('quizOp0').value, document.getElementById('quizOp1').value, document.getElementById('quizOp2').value, document.getElementById('quizOp3').value], correcta: parseInt(document.getElementById('quizCorrect').value), fecha: new Date().toISOString() }; await db.collection('quiz').add(data); alert("A√±adida"); document.getElementById('addQuizForm').reset(); });

        // --- AUTH & ADMIN ---
        function verificarAdmin() { if(document.getElementById('adminPassInput').value==="4354"){ esAdmin=true; document.getElementById('admin-panel').classList.remove('hidden'); cerrarModal('admin-login-modal'); cargarTodo(); cargarAdminData(); } else alert("Error"); }
        function cerrarSesionAdmin(){ esAdmin=false; document.getElementById('admin-panel').classList.add('hidden'); cargarTodo(); }
        function verAdminTab(t) { document.querySelectorAll('[id^="admin-tab-"]').forEach(x => x.classList.add('hidden')); document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active')); document.getElementById(`admin-tab-${t}`).classList.remove('hidden'); event.target.classList.add('active'); }
        function cargarAdminData() { db.collection('leads_capturados').orderBy('fecha', 'desc').onSnapshot(snap => { const div = document.getElementById('admin-leads-list'); div.innerHTML = ""; snap.forEach(doc => { const d = doc.data(); div.innerHTML += `<div class="review-card" style="text-align:left; border-left:4px solid orange;"><b>${d.servicio}</b><br>üë§ ${d.nombre} - ${d.telefono}</div>`; }); }); }
        function borrar(c,i){ if(confirm("¬øSeguro que quieres borrarlo?")) db.collection(c).doc(i).delete(); }

        auth.onAuthStateChanged(u => { usuarioActual = u; if(u) { cerrarModal('auth-modal'); document.getElementById('profile-name').innerText = "Perfil: " + u.email.split('@')[0]; cargarDatosPerfil(); } });
        function handleAuth(type) { const em = document.getElementById('authEmail').value, pw = document.getElementById('authPass').value; type === 'login' ? auth.signInWithEmailAndPassword(em,pw).catch(e=>document.getElementById('authError').innerText=e.message) : auth.createUserWithEmailAndPassword(em,pw).catch(e=>document.getElementById('authError').innerText=e.message); }
        function gestionarPerfil() { usuarioActual ? abrirModal('profile-modal') : abrirModal('auth-modal'); }
        function verTabPerfil(tab) { document.querySelectorAll('[id^="tab-"]').forEach(t => t.classList.add('hidden')); document.getElementById(`tab-${tab}`).classList.remove('hidden'); }
        function cargarDatosPerfil() { if(!usuarioActual) return; db.collection('pedidos').where('uid', '==', usuarioActual.uid).orderBy('fecha', 'desc').onSnapshot(snap => { const div = document.getElementById('user-orders-list'); div.innerHTML = ""; snap.forEach(doc => { div.innerHTML += `<div class="order-card confirmado"><p>Total: ${doc.data().total}‚Ç¨</p></div>`; }); }); }

        window.abrirModal = (id) => { document.getElementById(id).classList.remove('hidden'); };
        window.cerrarModal = (id) => document.getElementById(id).classList.add('hidden');
        function mostrarToast(msg) { const t=document.getElementById('toast'); t.innerText=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2000); }

        window.addEventListener('load', function() { if (!sessionStorage.getItem('popupMostrado')) { setTimeout(function() { abrirModal('welcome-modal'); sessionStorage.setItem('popupMostrado', 'true'); }, 4000); } });
        document.getElementById('welcomeForm').addEventListener('submit', (e) => { e.preventDefault(); enviarDatosUnificados({ servicio: "Lead Bienvenida", nombre: document.getElementById('welcomeNombre').value, telefono: document.getElementById('welcomeTel').value }, `Hola, acabo de entrar en la web.`); cerrarModal('welcome-modal'); });

        function cargarTodo() { 
            cargarProductos(); 
            cargarMarcasMoviles(); 
            cargarWebs(); 
            cargarQuiz(); 
            cargarResenas(); 
            cargarCarpetasTeleco(); 
        }
        cargarTodo();
    </script>
</body>
</html>
