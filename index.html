<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOVINETCONDE | Tecnolog√≠a y Servicios</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --primary: #0a2463;
            --accent: #3e92cc;
            --white: #ffffff;
            --light-gray: #f4f6f8;
            --text: #333333;
            --danger: #d32f2f;
        }

        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: var(--text); background: var(--light-gray); }

        /* Navegaci√≥n */
        .navbar { background: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; padding: 15px 0; }
        .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .logo { font-size: 1.5rem; color: var(--primary); margin: 0; }
        .highlight { color: var(--accent); }
        .nav-links { list-style: none; display: flex; gap: 20px; padding: 0; margin: 0; }
        .cart-btn, .admin-btn { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--primary); }

        /* Hero */
        .hero { background: linear-gradient(135deg, var(--primary), var(--accent)); color: var(--white); text-align: center; padding: 80px 20px; }
        .btn-primary { background: var(--accent); color: var(--white); border: none; padding: 10px 25px; border-radius: 25px; cursor: pointer; font-size: 1rem; transition: 0.3s; text-decoration: none; display: inline-block; }
        .btn-primary:hover { background: #2a6f9e; transform: translateY(-2px); }
        .full-width { width: 100%; margin-top: 10px; }

        /* Layout */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .section { padding: 60px 0; }
        .section-title { text-align: center; font-size: 2rem; margin-bottom: 40px; color: var(--primary); }

        /* Productos */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 30px; }
        .product-card { background: var(--white); border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative; }
        .product-photo { width: 100%; height: 200px; object-fit: cover; border-radius: 5px; margin-bottom: 10px; }
        .product-img-placeholder { font-size: 4rem; display: block; margin-bottom: 10px; }
        .price { font-size: 1.25rem; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .btn-delete { background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 5px; position: absolute; top: 10px; right: 10px; cursor: pointer; }

        /* Reparaciones */
        .repair-grid { display: flex; flex-wrap: wrap; gap: 40px; }
        .repair-text, .repair-form-wrapper { flex: 1; min-width: 300px; }
        .repair-form-wrapper form { background: var(--white); padding: 30px; border-radius: 10px; }
        input, textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }

        /* Modales */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: var(--white); padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; position: relative; max-height: 80vh; overflow-y: auto; }
        .hidden { display: none !important; }
        .close { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; cursor: pointer; }

        /* Admin Panel */
        .admin-panel { background: #e3f2fd; padding: 20px; border-radius: 10px; margin-top: 20px; border: 2px dashed var(--accent); }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="container nav-container">
            <h1 class="logo">MOVINET<span class="highlight">CONDE</span></h1>
            <ul class="nav-links">
                <li><button onclick="abrirCarrito()" class="cart-btn"><i class="fas fa-shopping-cart"></i> <span id="cart-count">0</span></button></li>
                <li><button onclick="abrirLogin()" class="admin-btn"><i class="fas fa-user-lock"></i></button></li>
            </ul>
        </div>
    </nav>

    <header class="hero">
        <div class="hero-content">
            <h2>Tecnolog√≠a que conecta</h2>
            <p>Venta y reparaci√≥n de m√≥viles.</p>
            <a href="#catalogo" class="btn-primary" style="background: white; color: var(--primary);">Ver Cat√°logo</a>
        </div>
    </header>

    <div id="admin-panel" class="container admin-panel hidden">
        <h3>üîß Panel Admin</h3>
        <p>A√±adir nuevo producto (Sube fotos peque√±as, menos de 1MB)</p>
        <form id="addProductForm">
            <input type="file" id="newImg" accept="image/*" required style="background: white;">
            <input type="text" id="newName" placeholder="Nombre" required>
            <input type="number" id="newPrice" placeholder="Precio" required>
            <button type="submit" class="btn-primary">Subir Producto</button>
        </form>
        <br>
        <button onclick="cerrarSesion()" style="background: #666; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 5px;">Cerrar Sesi√≥n</button>
    </div>

    <section id="catalogo" class="container section">
        <h2 class="section-title">Cat√°logo</h2>
        <div class="grid-container" id="productos-container">
            <p style="text-align: center; width: 100%;">Cargando productos...</p>
        </div>
    </section>

    <section id="reparaciones" class="section" style="background: #e9ecef;">
        <div class="container repair-grid">
            <div class="repair-text">
                <h2>Servicio T√©cnico</h2>
                <p>Reparamos pantallas, bater√≠as y ordenadores.</p>
                <p>Solicita presupuesto gratis v√≠a WhatsApp.</p>
            </div>
            <div class="repair-form-wrapper">
                <form id="contactForm">
                    <h3>Solicitar Reparaci√≥n</h3>
                    <input type="text" id="clienteNombre" placeholder="Tu Nombre" required>
                    <input type="text" id="clienteModelo" placeholder="Modelo M√≥vil/PC" required>
                    <textarea id="clienteProblema" placeholder="Describe el problema" rows="3" required></textarea>
                    <button type="submit" class="btn-primary full-width">Pedir Presupuesto (WhatsApp)</button>
                </form>
            </div>
        </div>
    </section>

    <div id="cart-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarCarrito()">&times;</span>
            <h2>Tu Carrito</h2>
            <ul id="cart-items" style="list-style: none; padding: 0;"></ul>
            <h3>Total: <span id="total-price">0</span>‚Ç¨</h3>
            <button onclick="realizarPedido()" class="btn-primary full-width">Pedir por WhatsApp</button>
        </div>
    </div>

    <div id="login-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 300px; text-align: center;">
            <span class="close" onclick="cerrarLogin()">&times;</span>
            <h2>Acceso Admin</h2>
            <input type="password" id="adminPass" placeholder="Contrase√±a">
            <button onclick="verificarAdmin()" class="btn-primary full-width">Entrar</button>
        </div>
    </div>

    <footer>
        <p style="text-align: center; padding: 20px;">&copy; 2025 MOVINETCONDE</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // 1. CONFIGURACI√ìN (Sin Storage para evitar errores)
        const firebaseConfig = {
            apiKey: "AIzaSyAO9sshvU5zUf_S9d12toWwrioeXBonlRc",
            authDomain: "movinet-conde-web.firebaseapp.com",
            projectId: "movinet-conde-web",
            appId: "1:867268264562:web:f28e33585cdcde3d8e78eb",
            measurementId: "G-71BM6J8SFL"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 2. VARIABLES
        let carrito = [];
        let esAdmin = false;
        const PASS_ADMIN = "4354"; 
        
        // ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è PON TU N√öMERO AQU√ç (34 delante) ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
        const MI_TELEFONO = "34613509309"; 

        // 3. FUNCIONES GLOBALES 
        
        // --- MOSTRAR PRODUCTOS ---
        function mostrarProductos() {
            const contenedor = document.getElementById('productos-container');
            
            db.collection("productos").orderBy("fecha", "desc").get().then((querySnapshot) => {
                contenedor.innerHTML = "";
                
                if (querySnapshot.empty) {
                    contenedor.innerHTML = '<p style="text-align:center; width:100%">No hay productos. Entra como Admin.</p>';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const prod = doc.data();
                    const prodId = doc.id;
                    
                    // Si la imagen es Base64 o URL
                    let imgHtml = "";
                    if (prod.img && (prod.img.startsWith('http') || prod.img.startsWith('data:image'))) {
                        imgHtml = `<img src="${prod.img}" class="product-photo">`;
                    } else {
                        imgHtml = `<span class="product-img-placeholder">üì±</span>`;
                    }

                    const div = document.createElement('div');
                    div.className = "product-card";
                    div.innerHTML = `
                        ${imgHtml}
                        <h3>${prod.nombre}</h3>
                        <p class="price">${prod.precio}‚Ç¨</p>
                        <button class="btn-primary full-width" onclick="agregarCarrito('${prodId}', '${prod.nombre}', ${prod.precio})">Comprar</button>
                        ${esAdmin ? `<button class="btn-delete" onclick="eliminarProducto('${prodId}')"><i class="fas fa-trash"></i></button>` : ''}
                    `;
                    contenedor.appendChild(div);
                });
            }).catch((error) => {
                console.error("Error: ", error);
                contenedor.innerHTML = "<p>Error cargando productos.</p>";
            });
        }

        // --- CARRITO ---
        function agregarCarrito(id, nombre, precio) {
            carrito.push({ id, nombre, precio });
            actualizarCarritoUI();
            alert("‚úÖ A√±adido: " + nombre);
        }

        function actualizarCarritoUI() {
            document.getElementById('cart-count').innerText = carrito.length;
            const total = carrito.reduce((sum, item) => sum + item.precio, 0);
            document.getElementById('total-price').innerText = total;

            const lista = document.getElementById('cart-items');
            lista.innerHTML = "";
            carrito.forEach((item, index) => {
                lista.innerHTML += `
                    <li style="margin-bottom: 5px; border-bottom: 1px solid #eee; padding: 5px;">
                        ${item.nombre} - <b>${item.precio}‚Ç¨</b> 
                        <span onclick="eliminarDelCarrito(${index})" style="color:red; cursor:pointer; float:right;">‚úñ</span>
                    </li>`;
            });
        }

        function eliminarDelCarrito(index) {
            carrito.splice(index, 1);
            actualizarCarritoUI();
        }

        function realizarPedido() {
            if(carrito.length === 0) return alert("Carrito vac√≠o");
            let msj = "üëã Hola MOVINETCONDE, quiero comprar: \n\n";
            carrito.forEach(p => msj += `‚ñ™Ô∏è ${p.nombre} (${p.precio}‚Ç¨)\n`);
            msj += `\nüí∞ Total: ${document.getElementById('total-price').innerText}‚Ç¨`;
            window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(msj)}`, '_blank');
            carrito = [];
            actualizarCarritoUI();
            cerrarCarrito();
        }

        // --- ADMIN ---
        function verificarAdmin() {
            if(document.getElementById('adminPass').value === PASS_ADMIN) {
                esAdmin = true;
                document.getElementById('admin-panel').classList.remove('hidden');
                cerrarLogin();
                mostrarProductos();
                alert("üîì Modo Admin Activado");
            } else {
                alert("‚ùå Contrase√±a incorrecta");
            }
        }

        function cerrarSesion() {
            esAdmin = false;
            document.getElementById('admin-panel').classList.add('hidden');
            mostrarProductos();
        }

        // --- SUBIR PRODUCTO (M√âTODO SIN STORAGE - BASE64) ---
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const file = document.getElementById('newImg').files[0];
            const name = document.getElementById('newName').value;
            const price = Number(document.getElementById('newPrice').value);

            if(!file) return alert("Elige una foto");
            // L√≠mite de seguridad: 1MB (para no saturar la base de datos)
            if(file.size > 1000000) return alert("‚ö†Ô∏è La imagen es demasiado grande. Usa una de menos de 1MB.");

            alert("‚è≥ Procesando imagen... espera un momento.");

            // Convertir imagen a texto
            const reader = new FileReader();
            reader.readAsDataURL(file);
            
            reader.onload = function() {
                const fotoTexto = reader.result;

                // Guardar en Firestore directamente
                db.collection("productos").add({
                    nombre: name,
                    precio: price,
                    img: fotoTexto,
                    fecha: new Date().toISOString()
                }).then(() => {
                    alert("‚úÖ ¬°Producto subido correctamente!");
                    document.getElementById('addProductForm').reset();
                    mostrarProductos();
                }).catch((error) => {
                    alert("Error: " + error.message);
                });
            };
        });

        function eliminarProducto(id) {
            if(confirm("¬øEst√°s seguro de borrar este producto?")) {
                db.collection("productos").doc(id).delete().then(() => mostrarProductos());
            }
        }

        // --- FORMULARIO REPARACIONES (WHATSAPP) ---
        document.getElementById('contactForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const n = document.getElementById('clienteNombre').value;
            const m = document.getElementById('clienteModelo').value;
            const p = document.getElementById('clienteProblema').value;
            
            const msj = `üîß *SOLICITUD DE REPARACI√ìN*\n\nüë§ Cliente: ${n}\nüì± Dispositivo: ${m}\n‚ö†Ô∏è Problema: ${p}`;
            
            window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(msj)}`, '_blank');
        });

        // --- MODALES ---
        function abrirLogin() { document.getElementById('login-modal').classList.remove('hidden'); }
        function cerrarLogin() { document.getElementById('login-modal').classList.add('hidden'); }
        function abrirCarrito() { document.getElementById('cart-modal').classList.remove('hidden'); }
        function cerrarCarrito() { document.getElementById('cart-modal').classList.add('hidden'); }

        // INICIAR
        mostrarProductos();

    </script>
</body>
</html>