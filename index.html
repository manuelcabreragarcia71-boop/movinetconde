<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MOVINETCONDE | Tecnolog√≠a & Servicios</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #000000;
            --accent: #ff8c00;
            --white: #ffffff;
            --text: #333333;
            --bg-glass: rgba(255, 255, 255, 0.92); 
            --success: #2ecc71;
            --pending: #f39c12;
            --error: #e74c3c;
        }

        body { 
            margin: 0; font-family: 'Montserrat', sans-serif; color: var(--text); background-color: #000; 
            background-image: url('fondo.JPG');
            background-repeat: no-repeat; background-position: center center; background-attachment: fixed; background-size: cover;       
            touch-action: manipulation;
        }

        /* NAVEGACI√ìN */
        .navbar { background: rgba(255, 255, 255, 0.98); padding: 10px 0; position: sticky; top: 0; z-index: 1000; border-bottom: 3px solid var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 15px; display: flex; flex-direction: column; gap: 10px; }
        .nav-top { display: flex; justify-content: space-between; align-items: center; }
        .logo-container { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--primary); }
        .logo-text { font-size: 1.4rem; font-weight: 800; margin: 0; }
        .logo-text span { color: var(--accent); }
        .nav-icons { display: flex; gap: 15px; }
        .btn-icon { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--primary); }
        
        .nav-menu { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .menu-btn { background: rgba(255,255,255,0.8); border: none; padding: 8px 15px; border-radius: 20px; font-weight: 600; cursor: pointer; white-space: nowrap; font-size: 0.9rem; transition: 0.3s; }
        .menu-btn.active, .menu-btn:hover { background: var(--accent); color: white; }

        /* CONTENEDORES */
        .container { 
            max-width: 1200px; margin: 20px auto; padding: 20px; 
            border-radius: 15px; background: var(--bg-glass);
            backdrop-filter: blur(8px); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        .hidden { display: none !important; }
        .section-title { text-align: center; color: var(--primary); text-transform: uppercase; margin-bottom: 20px; border-bottom: 2px solid var(--accent); display: inline-block; padding-bottom: 5px; font-weight: 800; }
        .center-wrapper { text-align: center; }

        /* ELEMENTOS VISUALES */
        .filter-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; margin-bottom: 20px; }
        .filter-badge { background: rgba(255,255,255,0.8); border: 2px solid rgba(0,0,0,0.1); padding: 8px 15px; border-radius: 15px; cursor: pointer; font-weight: bold; white-space: nowrap; transition: 0.3s; }
        .filter-badge.active { border-color: var(--accent); color: var(--accent); background: #fff; }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card, .repair-card, .review-card { 
            background: rgba(255, 255, 255, 0.85); padding: 15px; border-radius: 10px; text-align: center; border: 1px solid rgba(0,0,0,0.1); position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
        }
        .product-photo { width: 100%; height: 220px; object-fit: cover; border-radius: 5px; }
        .brand-tag, .condition-tag { position: absolute; top: 15px; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; color: white; }
        .brand-tag { left: 15px; background: rgba(0,0,0,0.8); }
        .condition-tag { right: 15px; background: var(--success); }
        
        /* ESTILOS ESPECIFICOS PC OPCIONES */
        .pc-option-card {
            background: white; padding: 30px; border-radius: 15px; text-align: center; 
            border: 2px solid #eee; transition: 0.3s; cursor: pointer;
        }
        .pc-option-card:hover { border-color: var(--accent); transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .pc-icon { font-size: 4rem; color: var(--accent); margin-bottom: 15px; }

        .repair-img { width: 100px; height: 100px; object-fit: cover; border-radius: 50%; margin: 0 auto 10px; border: 3px solid var(--accent); }
        .price { font-size: 1.3rem; font-weight: 800; color: var(--accent); margin: 10px 0; }
        
        .btn-primary { background: var(--primary); color: white; border: none; padding: 12px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; font-size: 1rem; }
        .btn-secondary { background: white; color: var(--primary); border: 2px solid var(--primary); padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; }

        /* PEDIDOS Y ESTADOS */
        .order-card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid #ccc; text-align: left; }
        .order-card.pendiente { border-left-color: var(--pending); }
        .order-card.confirmado { border-left-color: var(--success); background: #f0fff4; }
        .status-badge { display: inline-block; padding: 3px 8px; border-radius: 10px; font-size: 0.75rem; color: white; font-weight: bold; margin-bottom: 5px; }
        .bg-pending { background: var(--pending); }
        .bg-success { background: var(--success); }

        /* ADMIN */
        .admin-panel { background: rgba(255, 248, 225, 0.98); border: 2px dashed var(--accent); margin-bottom: 20px; padding: 20px; }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; overflow-x: auto; }
        .admin-tab-btn { background: none; border: none; font-weight: bold; cursor: pointer; opacity: 0.5; font-size: 0.9rem; white-space: nowrap; }
        .admin-tab-btn.active { opacity: 1; color: var(--accent); border-bottom: 2px solid var(--accent); }
        .admin-actions { display: flex; gap: 5px; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.1); }
        .btn-edit { background: #f1c40f; color: black; border: none; padding: 5px; flex: 1; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .btn-delete { background: #e74c3c; color: white; border: none; padding: 5px; flex: 1; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .btn-confirm { background: var(--success); color: white; padding: 8px; border:none; border-radius:5px; cursor:pointer; width:100%; margin-top:5px; font-weight:bold;}

        /* MODALES Y FORMULARIOS */
        .form-box { max-width: 600px; margin: 0 auto; background: rgba(255,255,255,0.95); padding: 30px; border-radius: 10px; }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; background: rgba(255,255,255,0.9); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: rgba(255,255,255,0.98); padding: 30px; width: 90%; max-width: 500px; border-radius: 10px; position: relative; max-height: 90vh; overflow-y: auto; }
        .close { position: absolute; top: 10px; right: 20px; font-size: 1.8rem; cursor: pointer; }
        
        /* QUIZ */
        #quiz-wrapper { max-width: 600px; margin: 0 auto; text-align: center; }
        .quiz-btn { background: white; border: 2px solid #ddd; padding: 15px; border-radius: 10px; font-size: 1rem; cursor: pointer; transition: 0.2s; text-align: left; font-weight: 600; color: #555; width: 100%; margin-bottom: 10px; }
        .quiz-btn:hover { border-color: var(--accent); color: var(--accent); background: #fff8e1; }
        .quiz-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .quiz-btn.wrong { background: var(--error); color: white; border-color: var(--error); }
        .score-display { font-size: 3rem; color: var(--accent); font-weight: 800; display: block; margin: 20px 0; }

        /* TOAST */
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 20px; z-index: 3000; display: none; }

        footer { text-align: center; padding: 30px; background: rgba(17,17,17,0.95); color: white; margin-top: 50px; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-top">
                <a href="#" class="logo-container">
                    <h1 class="logo-text">MOVINET<span>CONDE</span></h1>
                </a>
                <div class="nav-icons">
                    <button onclick="abrirModal('cart-modal')" class="btn-icon"><i class="fas fa-shopping-cart"></i> <span id="cart-count">0</span></button>
                    <button onclick="gestionarPerfil()" class="btn-icon"><i class="fas fa-user-circle"></i></button>
                    <button onclick="abrirModal('admin-login-modal')" class="btn-icon"><i class="fas fa-lock"></i></button>
                </div>
            </div>
            <div class="nav-menu">
                <button onclick="verSeccion('contacto')" class="menu-btn" id="btn-contacto">üìû Te Llamamos</button>
                <button onclick="verSeccion('catalogo')" class="menu-btn active" id="btn-catalogo">üì± M√≥viles</button>
                <button onclick="verSeccion('reparaciones')" class="menu-btn" id="btn-reparaciones">üîß Rep. M√≥viles</button>
                <button onclick="verSeccion('pcs')" class="menu-btn" id="btn-pcs">üñ•Ô∏è PC</button>
                <button onclick="verSeccion('patines')" class="menu-btn" id="btn-patines">üõ¥ Patines</button>
                <button onclick="verSeccion('webs')" class="menu-btn" id="btn-webs">üé® Webs</button>
                <button onclick="verSeccion('reacondicionados')" class="menu-btn" id="btn-reacondicionados">‚ôªÔ∏è Reaco</button>
                <button onclick="verSeccion('quiz')" class="menu-btn" id="btn-quiz">‚ùì Quiz</button>
            </div>
        </div>
    </nav>

    <div id="admin-panel" class="container admin-panel hidden">
        <h3 style="margin-top:0;">Panel de Administraci√≥n</h3>
        <div class="admin-tabs">
            <button class="admin-tab-btn active" onclick="verAdminTab('pedidos')">üö® PEDIDOS</button>
            <button class="admin-tab-btn" onclick="verAdminTab('leads')">üìû LEADS</button>
            <button class="admin-tab-btn" onclick="verAdminTab('citas')">üîß Taller</button>
            <button class="admin-tab-btn" onclick="verAdminTab('productos')">M√≥viles</button>
            <button class="admin-tab-btn" onclick="verAdminTab('webs')">Webs (Plantillas)</button>
        </div>

        <div id="admin-tab-pedidos">
            <h4 style="color:var(--accent);">√öltimos Pedidos</h4>
            <div id="admin-orders-list" class="grid-container" style="grid-template-columns: 1fr;">Cargando...</div>
        </div>

        <div id="admin-tab-leads" class="hidden">
            <h4 style="color:var(--accent);">Contactos Capturados (Web y Forms)</h4>
            <div id="admin-leads-list" class="grid-container" style="grid-template-columns: 1fr;">Cargando...</div>
        </div>
        
        <div id="admin-tab-citas" class="hidden">
            <h4 style="color:var(--accent);">Citas de Taller</h4>
            <div id="admin-citas-list" class="grid-container" style="grid-template-columns: 1fr;">Cargando citas...</div>
        </div>

        <div id="admin-tab-productos" class="hidden">
            <h3>Nuevo M√≥vil</h3>
            <form id="addProductForm">
                <input type="hidden" id="editProductId">
                <input type="file" id="newImg" accept="image/*">
                <input type="text" id="newBrand" placeholder="Marca (Samsung)" required>
                <input type="text" id="newName" placeholder="Modelo" required>
                <input type="number" id="newPrice" placeholder="Precio (‚Ç¨)" required>
                <button type="submit" class="btn-primary" id="btnSaveProduct">GUARDAR M√ìVIL</button>
            </form>
        </div>

        <div id="admin-tab-webs" class="hidden">
            <h3>Subir Plantilla Web</h3>
            <form id="addWebForm">
                <input type="hidden" id="editWebId">
                <input type="file" id="webImg" accept="image/*">
                <input type="text" id="webTitle" placeholder="Nombre Plantilla (Ej: Restaurante)" required>
                <button type="submit" class="btn-primary" id="btnSaveWeb">GUARDAR DISE√ëO</button>
            </form>
        </div>

        <button onclick="cerrarSesionAdmin()" style="margin-top:20px; background:#333; color:white; border:none; padding:10px; width:100%;">Cerrar Sesi√≥n Admin</button>
    </div>

    <div id="sec-contacto" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">¬øTe Llamamos?</h2></div>
        <div class="form-box glass-effect" style="margin-top:20px; border:2px solid var(--accent);">
            <p style="text-align:center; font-weight:600; margin-bottom:20px;">
                D√©janos tu n√∫mero y te contactaremos para asesorarte sin compromiso.
            </p>
            <form id="silentLeadForm">
                <label for="leadNombre">Nombre:</label>
                <input type="text" id="leadNombre" placeholder="Tu nombre" required>
                <label for="leadTelefono">Tel√©fono (WhatsApp):</label>
                <input type="tel" id="leadTelefono" placeholder="Escribe tu n√∫mero..." style="font-size:1.2rem; font-weight:bold; color:var(--accent);" required>
                <label for="leadInteres">Interesado en:</label>
                <select id="leadInteres">
                    <option value="General">Informaci√≥n General</option>
                    <option value="Reparacion Movil">Reparaci√≥n M√≥vil</option>
                    <option value="Patines">Patines</option>
                </select>
                <button type="submit" class="btn-primary">ENVIAR Y ABRIR WHATSAPP</button>
            </form>
        </div>
    </div>

    <div id="sec-catalogo" class="container">
        <div class="center-wrapper"><h2 class="section-title">M√≥viles</h2></div>
        <div id="brand-filters" class="filter-scroll">
            <button class="filter-badge active" onclick="filtrarMarca('all')">Todo</button>
        </div>
        <div id="productos-container" class="grid-container">Cargando...</div>
    </div>

    <div id="sec-reparaciones" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Reparaci√≥n M√≥viles</h2></div>
        
        <div class="form-box glass-effect">
            <h3>Solicitar Presupuesto M√≥vil/Tablet</h3>
            <p style="font-size:0.9rem; text-align:center;">Se enviar√° notificaci√≥n y abrir√° WhatsApp.</p>
            <form id="tallerForm">
                <input type="text" id="tallerNombre" placeholder="Tu Nombre" required>
                <input type="tel" id="tallerTel" placeholder="Tu Tel√©fono" required>
                <input type="text" id="tallerDispositivo" placeholder="Marca y Modelo" required>
                <textarea id="tallerAveria" placeholder="Describe qu√© le pasa..." rows="3"></textarea>
                <button type="submit" class="btn-primary">SOLICITAR PRESUPUESTO</button>
            </form>
        </div>
        <div style="margin-top:30px;">
            <h4 style="text-align:center;">Servicios Comunes</h4>
            <div id="reparaciones-container" class="grid-container">Cargando...</div>
        </div>
    </div>

    <div id="sec-pcs" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Zona PC</h2></div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
            
            <div class="pc-option-card" onclick="abrirModalPC('reparacion')">
                <i class="fas fa-tools pc-icon"></i>
                <h3>Reparaci√≥n de PC</h3>
                <p>¬øTu ordenador va lento, no enciende o tiene virus? Solicita un diagn√≥stico y presupuesto.</p>
                <button class="btn-primary">SOLICITAR REPARACI√ìN</button>
            </div>

            <div class="pc-option-card" onclick="abrirModalPC('fabricacion')">
                <i class="fas fa-microchip pc-icon"></i>
                <h3>PC a Medida</h3>
                <p>Gaming, edici√≥n o trabajo. Dinos qu√© necesitas y te dise√±amos el PC perfecto.</p>
                <button class="btn-primary">SOLICITAR MONTAJE</button>
            </div>
        </div>
    </div>

    <div id="sec-patines" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Reparaci√≥n de Patines</h2></div>
        <div class="form-box glass-effect">
            <div style="text-align:center; margin-bottom:20px;">
                <i class="fas fa-scooter" style="font-size:3rem; color:var(--accent);"></i>
                <h3>Presupuesto Express</h3>
            </div>
            <form id="patinForm">
                <input type="text" id="patinNombre" placeholder="Tu Nombre" required>
                <input type="tel" id="patinTel" placeholder="Tu Tel√©fono" required>
                <input type="text" id="patinModelo" placeholder="Modelo de Pat√≠n (Ej: Xiaomi M365)" required>
                <textarea id="patinAveria" placeholder="Describe la aver√≠a (Ej: Rueda pinchada, no enciende...)" rows="4" required></textarea>
                <button type="submit" class="btn-primary">ENVIAR CONSULTA</button>
            </form>
        </div>
    </div>

    <div id="sec-webs" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Plantillas Web</h2></div>
        <p style="text-align:center; margin-bottom:20px;">Elige un dise√±o base y lo adaptamos a tu negocio.</p>
        <div id="webs-container" class="grid-container">
            </div>
        <div style="text-align:center; margin-top:30px;">
             <button class="btn-primary" style="max-width:300px;" onclick="abrirModalWebPersonalizada()">¬øQuieres una web a medida?</button>
        </div>
    </div>

    <div id="sec-reacondicionados" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Reacondicionados</h2></div>
        <div id="reaco-container" class="grid-container">Cargando...</div>
    </div>

    <div id="sec-quiz" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Trivia Tech</h2></div>
        <div id="quiz-wrapper">
            <div id="quiz-start">
                <i class="fas fa-brain" style="font-size: 4rem; color: var(--accent); margin-bottom: 10px;"></i>
                <h3>¬øCu√°nto sabes de tecnolog√≠a?</h3>
                <button class="btn-primary" onclick="startQuiz()">¬°JUGAR!</button>
            </div>
            <div id="quiz-game" class="hidden">
                <div class="question-text" id="questionText">Cargando...</div>
                <div class="options-list" id="optionsList" style="display:grid; gap:10px;"></div>
                <button id="nextBtn" class="btn-primary hidden" onclick="nextQuestion()" style="margin-top: 20px;">Siguiente</button>
            </div>
            <div id="quiz-result" class="hidden">
                <h3>¬°Juego Terminado!</h3>
                <span class="score-display" id="finalScore">0</span>
                <button class="btn-primary" onclick="startQuiz()">Repetir</button>
            </div>
        </div>
    </div>

    <div id="modal-pc-form" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('modal-pc-form')">&times;</span>
            <h3 id="pc-modal-title">Solicitud PC</h3>
            <form id="pcRequestForm">
                <input type="hidden" id="pcTipoServicio">
                <input type="text" id="pcNombre" placeholder="Tu Nombre" required>
                <input type="tel" id="pcTel" placeholder="Tu Tel√©fono" required>
                <textarea id="pcDetalles" placeholder="Describe lo que necesitas..." rows="4" required></textarea>
                <button type="submit" class="btn-primary">ENVIAR SOLICITUD</button>
            </form>
        </div>
    </div>

    <div id="cart-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('cart-modal')">&times;</span>
            <h2>Carrito</h2>
            <ul id="cart-items" style="list-style:none; padding:0; margin:20px 0;"></ul>
            <h3>Total: <span id="total-price">0</span>‚Ç¨</h3>
            <button onclick="realizarPedido()" class="btn-primary">COMPRAR POR WHATSAPP</button>
        </div>
    </div>

    <div id="profile-modal" class="modal hidden">
        <div class="modal-content" style="max-width:600px;">
            <span class="close" onclick="cerrarModal('profile-modal')">&times;</span>
            <h2 id="profile-name">Mi Perfil</h2>
            <div class="profile-tabs">
                <button class="profile-tab active" onclick="verTabPerfil('pedidos')">Mis Pedidos</button>
                <button class="profile-tab" onclick="verTabPerfil('reparaciones')">Reparaciones</button>
            </div>
            <div id="tab-pedidos"><div id="user-orders-list">Cargando...</div></div>
            <div id="tab-reparaciones" class="hidden"><div id="user-repairs-list">Cargando...</div></div>
            <button onclick="auth.signOut(); cerrarModal('profile-modal');" class="btn-delete" style="background:#333; margin-top:20px;">Cerrar Sesi√≥n</button>
        </div>
    </div>

    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('auth-modal')">&times;</span>
            <h2 style="text-align:center">Acceso Clientes</h2>
            <form id="authForm">
                <input type="email" id="authEmail" placeholder="Email" required>
                <input type="password" id="authPass" placeholder="Contrase√±a" required>
                <div style="display:flex; gap:10px;">
                    <button type="button" class="btn-primary" onclick="handleAuth('login')">Entrar</button>
                    <button type="button" class="btn-secondary" onclick="handleAuth('register')">Registrarse</button>
                </div>
                <p id="authError" style="color:red; text-align:center; margin-top:10px;"></p>
            </form>
        </div>
    </div>

    <div id="admin-login-modal" class="modal hidden">
        <div class="modal-content" style="max-width:300px; text-align:center;">
            <span class="close" onclick="cerrarModal('admin-login-modal')">&times;</span>
            <h3>Zona Admin</h3>
            <input type="password" id="adminPassInput" placeholder="Clave">
            <button onclick="verificarAdmin()" class="btn-primary">Entrar</button>
        </div>
    </div>
    
    <div id="toast" class="toast">Guardado</div>

    <footer>
        <a href="https://www.instagram.com/movinetconde/" target="_blank" style="color:var(--accent); font-size:2rem;"><i class="fab fa-instagram"></i></a>
        <p>&copy; 2025 MOVINETCONDE</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        // CONFIGURACION FIREBASE (Tus credenciales)
        const firebaseConfig = {
            apiKey: "AIzaSyAO9sshvU5zUf_S9d12toWwrioeXBonlRc",
            authDomain: "movinet-conde-web.firebaseapp.com",
            projectId: "movinet-conde-web",
            appId: "1:867268264562:web:f28e33585cdcde3d8e78eb"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // VARIABLES GLOBALES
        let carrito = []; let usuarioActual = null; let esAdmin = false;
        let allProducts = []; let filtroMarcaActual = 'all'; let allQuestions = [];
        let editImgProduct="", editImgWeb="";
        const MI_TELEFONO = "34613509309"; 
        const FORMSPREE_URL = "https://formspree.io/f/xwvqgdob";

        // ==========================================
        //  FUNCION MAESTRA DE ENVIO (EMAIL + WHATSAPP)
        // ==========================================
        function enviarDatosUnificados(datos, mensajeWhatsapp) {
            // 1. Enviar Email (Silencioso en segundo plano)
            fetch(FORMSPREE_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json", "Accept": "application/json" },
                body: JSON.stringify(datos)
            }).then(r => console.log("Email enviado")).catch(e => console.error(e));

            // 2. Guardar en Firebase (Base de Datos)
            db.collection('leads_capturados').add({
                ...datos,
                fecha: new Date().toISOString(),
                leido: false
            });

            // 3. Abrir WhatsApp
            const url = `https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(mensajeWhatsapp)}`;
            window.open(url, '_blank');

            mostrarToast("Solicitud enviada correctamente");
        }

        // ==========================================
        //  LOGICA FORMULARIOS (PC, Patines, Taller)
        // ==========================================

        // 1. PC (Se abre modal primero)
        function abrirModalPC(tipo) {
            document.getElementById('pcTipoServicio').value = tipo;
            document.getElementById('pc-modal-title').innerText = tipo === 'reparacion' ? "Presupuesto Reparaci√≥n PC" : "Fabricaci√≥n PC a Medida";
            abrirModal('modal-pc-form');
        }

        document.getElementById('pcRequestForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const tipo = document.getElementById('pcTipoServicio').value;
            const nom = document.getElementById('pcNombre').value;
            const tel = document.getElementById('pcTel').value;
            const desc = document.getElementById('pcDetalles').value;

            const datos = { servicio: "PC " + tipo, nombre: nom, telefono: tel, detalles: desc };
            const msgWA = `Hola, soy ${nom}. Interesado en PC (${tipo}). Detalles: ${desc}`;
            
            enviarDatosUnificados(datos, msgWA);
            cerrarModal('modal-pc-form');
            document.getElementById('pcRequestForm').reset();
        });

        // 2. Patines
        document.getElementById('patinForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const nom = document.getElementById('patinNombre').value;
            const tel = document.getElementById('patinTel').value;
            const mod = document.getElementById('patinModelo').value;
            const av = document.getElementById('patinAveria').value;

            const datos = { servicio: "Reparacion Patin", nombre: nom, telefono: tel, modelo: mod, averia: av };
            const msgWA = `Hola MovinetConde. Tengo un pat√≠n ${mod}. Aver√≠a: ${av}. Soy ${nom}.`;

            enviarDatosUnificados(datos, msgWA);
            document.getElementById('patinForm').reset();
        });

        // 3. Taller M√≥viles
        document.getElementById('tallerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const nom = document.getElementById('tallerNombre').value;
            const tel = document.getElementById('tallerTel').value;
            const disp = document.getElementById('tallerDispositivo').value;
            const av = document.getElementById('tallerAveria').value;

            const datos = { servicio: "Reparacion Movil", nombre: nom, telefono: tel, dispositivo: disp, averia: av };
            const msgWA = `Hola, necesito reparar mi ${disp}. Problema: ${av}. Soy ${nom}.`;

            enviarDatosUnificados(datos, msgWA);
            document.getElementById('tallerForm').reset();
        });

        // 4. Contacto General (Lead Silencioso)
        let temporizadorLead; let leadYaEnviado = false;
        const inputTelLead = document.getElementById('leadTelefono');
        
        inputTelLead.addEventListener('input', function() {
            if(inputTelLead.value.length < 9) leadYaEnviado = false;
            clearTimeout(temporizadorLead);
            temporizadorLead = setTimeout(() => {
                const tel = inputTelLead.value;
                const nom = document.getElementById('leadNombre').value;
                if (tel.length >= 9 && !leadYaEnviado) {
                    enviarDatosUnificados({origen: "Captura Web", nombre: nom, telefono: tel}, `Hola, estaba viendo vuestra web. Soy ${nom}.`);
                    leadYaEnviado = true;
                }
            }, 2000); 
        });

        document.getElementById('silentLeadForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const nom = document.getElementById('leadNombre').value;
            const tel = document.getElementById('leadTelefono').value;
            const interes = document.getElementById('leadInteres').value;
            enviarDatosUnificados({servicio: "Contacto General", nombre: nom, telefono: tel, interes: interes}, `Hola, me interesa: ${interes}. Soy ${nom}.`);
        });

        // ==========================================
        //  NAVEGACI√ìN Y RENDERIZADO
        // ==========================================
        function verSeccion(id) {
            document.querySelectorAll('[id^="sec-"]').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`sec-${id}`).classList.remove('hidden');
            document.getElementById(`btn-${id}`).classList.add('active');
        }

        function cargarProductos() {
            db.collection("productos").orderBy("fecha", "desc").onSnapshot(snap => {
                allProducts = []; snap.forEach(doc => allProducts.push({...doc.data(), id: doc.id}));
                renderizarMarcas(); renderizarProductos();
            });
        }
        function renderizarMarcas() {
            const marcas = ['all', ...new Set(allProducts.map(p => p.marca ? p.marca.trim() : 'Otros'))];
            document.getElementById('brand-filters').innerHTML = marcas.map(m => `<button class="filter-badge ${filtroMarcaActual === m ? 'active' : ''}" onclick="filtrarMarca('${m}')">${m === 'all' ? 'Todo' : m}</button>`).join('');
        }
        function renderizarProductos() {
            const c = document.getElementById('productos-container'); c.innerHTML = "";
            const filtrados = filtroMarcaActual === 'all' ? allProducts : allProducts.filter(p => (p.marca || 'Otros') === filtroMarcaActual);
            filtrados.forEach(p => {
                let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-delete" onclick="borrar('productos','${p.id}')">üóëÔ∏è</button></div>` : '';
                c.innerHTML += `<div class="product-card"><span class="brand-tag">${p.marca}</span><img src="${p.img}" class="product-photo"><h3>${p.nombre}</h3><p class="price">${p.precio}‚Ç¨</p><button class="btn-primary" onclick="addCart('${p.id}','${p.nombre}',${p.precio})">A√ëADIR</button>${adminBtns}</div>`;
            });
        }
        function filtrarMarca(m) { filtroMarcaActual = m; renderizarMarcas(); renderizarProductos(); }

        function cargarWebs() {
            db.collection("webs").onSnapshot(snap => {
                const c = document.getElementById('webs-container'); c.innerHTML="";
                snap.forEach(doc => {
                    const w = doc.data();
                    let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-delete" onclick="borrar('webs','${doc.id}')">üóëÔ∏è</button></div>` : '';
                    // Ahora muestra imagen de plantilla
                    c.innerHTML += `<div class="product-card"><img src="${w.img}" class="product-photo" style="object-fit:contain; height:180px;"><h3>${w.titulo}</h3><button class="btn-primary" onclick="abrirModalWebPersonalizada('${w.titulo}')">ELEGIR DISE√ëO</button>${adminBtns}</div>`;
                });
            });
        }
        
        function abrirModalWebPersonalizada(diseno = "General") {
            const nom = prompt("Dinos tu nombre:");
            if(nom) {
                enviarDatosUnificados({servicio: "Interes Web", dise√±o: diseno, nombre: nom}, `Hola, me interesa el dise√±o web: ${diseno}. Soy ${nom}.`);
            }
        }

        // ==========================================
        //  ADMINISTRACI√ìN
        // ==========================================
        function verificarAdmin() { 
            if(document.getElementById('adminPassInput').value==="4354"){ 
                esAdmin=true; document.getElementById('admin-panel').classList.remove('hidden'); cerrarModal('admin-login-modal'); 
                cargarTodo(); cargarAdminData();
            } else alert("Error"); 
        }
        function cerrarSesionAdmin(){ esAdmin=false; document.getElementById('admin-panel').classList.add('hidden'); cargarTodo(); }
        function verAdminTab(t) {
            document.querySelectorAll('[id^="admin-tab-"]').forEach(x => x.classList.add('hidden'));
            document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`admin-tab-${t}`).classList.remove('hidden');
            event.target.classList.add('active');
        }

        async function guardarItem(col, id, data, fileIn) {
            const f = document.getElementById(fileIn) ? document.getElementById(fileIn).files[0] : null;
            if(f) { const r = new FileReader(); r.readAsDataURL(f); await new Promise(res => r.onload = ()=> { data.img = r.result; res(); }); }
            else if(id) { /* Mantener imagen vieja si es edit */ } 
            
            await db.collection(col).add({...data, fecha: new Date().toISOString()});
            mostrarToast("Guardado");
        }

        document.getElementById('addProductForm').addEventListener('submit', e=>{ e.preventDefault(); 
            guardarItem('productos', null, {
                nombre: document.getElementById('newName').value, marca: document.getElementById('newBrand').value, 
                precio: Number(document.getElementById('newPrice').value)
            }, 'newImg').then(()=>{document.getElementById('addProductForm').reset()}); 
        });

        document.getElementById('addWebForm').addEventListener('submit', e=>{ e.preventDefault();
            guardarItem('webs', null, {
                titulo: document.getElementById('webTitle').value
            }, 'webImg').then(()=>{document.getElementById('addWebForm').reset()});
        });

        function cargarAdminData() {
            db.collection('leads_capturados').orderBy('fecha', 'desc').onSnapshot(snap => {
                const div = document.getElementById('admin-leads-list'); div.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    div.innerHTML += `<div class="review-card" style="text-align:left; border-left:4px solid var(--accent); margin-bottom:5px;"><b>${d.servicio || 'Contacto'}</b><br>üë§ ${d.nombre} - üìû ${d.telefono}<br><small>${d.detalles || d.averia || ''}</small></div>`;
                });
            });
        }
        function borrar(c,i){ if(confirm("¬øBorrar?")) db.collection(c).doc(i).delete(); }

        // ==========================================
        //  AUTH Y PERFIL
        // ==========================================
        auth.onAuthStateChanged(u => { 
            usuarioActual = u; 
            if(u) { cerrarModal('auth-modal'); document.getElementById('profile-name').innerText = "Perfil: " + u.email.split('@')[0]; cargarDatosPerfil(); }
        });
        function handleAuth(type) {
            const em = document.getElementById('authEmail').value, pw = document.getElementById('authPass').value;
            type === 'login' ? auth.signInWithEmailAndPassword(em,pw) : auth.createUserWithEmailAndPassword(em,pw);
        }
        function gestionarPerfil() { usuarioActual ? abrirModal('profile-modal') : abrirModal('auth-modal'); }
        function verTabPerfil(tab) {
            document.querySelectorAll('[id^="tab-"]').forEach(t => t.classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
        }
        function cargarDatosPerfil() {
            if(!usuarioActual) return;
            db.collection('pedidos').where('uid', '==', usuarioActual.uid).orderBy('fecha', 'desc').onSnapshot(snap => {
                const div = document.getElementById('user-orders-list'); div.innerHTML = "";
                snap.forEach(doc => { div.innerHTML += `<div class="order-card confirmado"><p>Total: ${doc.data().total}‚Ç¨</p></div>`; });
            });
        }

        // ==========================================
        //  CARRITO Y EXTRAS
        // ==========================================
        function addCart(id, n, p){ carrito.push({n,p}); document.getElementById('cart-count').innerText=carrito.length; mostrarToast("A√±adido"); }
        function realizarPedido(){
            if(!carrito.length) return;
            let total = 0; let items = "";
            carrito.forEach(i => { total += i.p; items += `${i.n}, `; });
            const msg = `Pedido Web: ${items}. Total: ${total}‚Ç¨.`;
            const datos = { servicio: "Compra", items: items, total: total, uid: usuarioActual ? usuarioActual.uid : 'anon' };
            enviarDatosUnificados(datos, msg);
            carrito = []; document.getElementById('cart-count').innerText = "0"; cerrarModal('cart-modal');
        }

        // QUIZ (B√°sico)
        function startQuiz() {
           // Cargar preguntas mock si no hay en DB o usar DB
           allQuestions = [{pregunta:"¬øCual es el ultimo iPhone?", opciones:["13","14","15","16"], correcta:3}];
           document.getElementById('quiz-start').classList.add('hidden'); document.getElementById('quiz-game').classList.remove('hidden');
           showQuestion();
        }
        let currentQ = 0;
        function showQuestion() { document.getElementById('questionText').innerText = allQuestions[currentQ].pregunta; document.getElementById('optionsList').innerHTML = allQuestions[currentQ].opciones.map(o=>`<button class="quiz-btn">${o}</button>`).join(''); }

        // UTILIDADES MODALES
        window.abrirModal = (id) => { document.getElementById(id).classList.remove('hidden'); if(id==='cart-modal'){ const ul=document.getElementById('cart-items'); ul.innerHTML=""; let t=0; carrito.forEach(i=>{ul.innerHTML+=`<li>${i.n} - ${i.p}‚Ç¨</li>`; t+=i.p;}); document.getElementById('total-price').innerText=t;} };
        window.cerrarModal = (id) => document.getElementById(id).classList.add('hidden');
        function mostrarToast(msg) { const t=document.getElementById('toast'); t.innerText=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2000); }

        function cargarTodo() { cargarProductos(); cargarWebs(); }
        cargarTodo();
    </script>
</body>
</html>
