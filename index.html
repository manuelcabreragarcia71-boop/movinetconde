<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MOVINETCONDE | Tecnolog√≠a & Servicios</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #000000;
            --accent: #ff8c00;
            --white: #ffffff;
            --text: #333333;
            --bg-glass: rgba(255, 255, 255, 0.9); 
            --success: #2ecc71;
            --pending: #f39c12;
            --error: #e74c3c;
        }

        body { 
            margin: 0; font-family: 'Montserrat', sans-serif; color: var(--text); background-color: #000; 
            background-image: url('fondo.JPG');
            background-repeat: no-repeat; background-position: center center; background-attachment: fixed; background-size: cover;       
            touch-action: manipulation;
        }

        /* NAVEGACI√ìN */
        .navbar { background: rgba(255, 255, 255, 0.95); padding: 10px 0; position: sticky; top: 0; z-index: 1000; border-bottom: 3px solid var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 15px; display: flex; flex-direction: column; gap: 10px; }
        .nav-top { display: flex; justify-content: space-between; align-items: center; }
        .logo-container { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--primary); }
        .logo-text { font-size: 1.4rem; font-weight: 800; margin: 0; }
        .logo-text span { color: var(--accent); }
        .nav-icons { display: flex; gap: 15px; }
        .btn-icon { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--primary); }
        
        .nav-menu { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .menu-btn { background: rgba(255,255,255,0.8); border: none; padding: 8px 15px; border-radius: 20px; font-weight: 600; cursor: pointer; white-space: nowrap; font-size: 0.9rem; transition: 0.3s; }
        .menu-btn.active, .menu-btn:hover { background: var(--accent); color: white; }

        /* CONTENEDORES */
        .container { 
            max-width: 1200px; margin: 20px auto; padding: 20px; 
            border-radius: 15px; background: var(--bg-glass);
            backdrop-filter: blur(8px); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        .hidden { display: none !important; }
        .section-title { text-align: center; color: var(--primary); text-transform: uppercase; margin-bottom: 20px; border-bottom: 2px solid var(--accent); display: inline-block; padding-bottom: 5px; font-weight: 800; }
        .center-wrapper { text-align: center; }

        /* CARDS & FILTROS */
        .filter-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; margin-bottom: 20px; }
        .filter-badge { background: rgba(255,255,255,0.8); border: 2px solid rgba(0,0,0,0.1); padding: 8px 15px; border-radius: 15px; cursor: pointer; font-weight: bold; white-space: nowrap; transition: 0.3s; }
        .filter-badge.active { border-color: var(--accent); color: var(--accent); background: #fff; }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card, .repair-card, .review-card { 
            background: rgba(255, 255, 255, 0.85); padding: 15px; border-radius: 10px; text-align: center; border: 1px solid rgba(0,0,0,0.1); position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
        }
        .product-photo { width: 100%; height: 220px; object-fit: cover; border-radius: 5px; }
        .brand-tag, .condition-tag { position: absolute; top: 15px; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; color: white; }
        .brand-tag { left: 15px; background: rgba(0,0,0,0.8); }
        .condition-tag { right: 15px; background: var(--success); }
        
        .repair-img { width: 100px; height: 100px; object-fit: cover; border-radius: 50%; margin: 0 auto 10px; border: 3px solid var(--accent); }
        .specs-list { list-style: none; padding: 0; text-align: left; font-size: 0.85rem; margin: 10px 0; background: rgba(255,255,255,0.5); padding: 10px; border-radius: 5px; }
        .specs-list li { margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }

        .price { font-size: 1.3rem; font-weight: 800; color: var(--accent); margin: 10px 0; }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; }
        .btn-secondary { background: white; color: var(--primary); border: 2px solid var(--primary); padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; }

        /* PEDIDOS Y ESTADOS */
        .order-card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid #ccc; text-align: left; }
        .order-card.pendiente { border-left-color: var(--pending); }
        .order-card.confirmado { border-left-color: var(--success); background: #f0fff4; }
        .status-badge { display: inline-block; padding: 3px 8px; border-radius: 10px; font-size: 0.75rem; color: white; font-weight: bold; margin-bottom: 5px; }
        .bg-pending { background: var(--pending); }
        .bg-success { background: var(--success); }

        /* ADMIN */
        .admin-panel { background: rgba(255, 248, 225, 0.95); border: 2px dashed var(--accent); margin-bottom: 20px; padding: 20px; }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; overflow-x: auto; }
        .admin-tab-btn { background: none; border: none; font-weight: bold; cursor: pointer; opacity: 0.5; font-size: 0.9rem; white-space: nowrap; }
        .admin-tab-btn.active { opacity: 1; color: var(--accent); border-bottom: 2px solid var(--accent); }
        .admin-actions { display: flex; gap: 5px; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.1); }
        .btn-edit { background: #f1c40f; color: black; border: none; padding: 5px; flex: 1; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .btn-delete { background: #e74c3c; color: white; border: none; padding: 5px; flex: 1; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .btn-confirm { background: var(--success); color: white; padding: 8px; border:none; border-radius:5px; cursor:pointer; width:100%; margin-top:5px; font-weight:bold;}

        /* MODALES Y FORMULARIOS */
        .form-box { max-width: 600px; margin: 0 auto; background: rgba(255,255,255,0.9); padding: 30px; border-radius: 10px; }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; background: rgba(255,255,255,0.9); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: rgba(255,255,255,0.98); padding: 30px; width: 90%; max-width: 500px; border-radius: 10px; position: relative; max-height: 90vh; overflow-y: auto; }
        .close { position: absolute; top: 10px; right: 20px; font-size: 1.8rem; cursor: pointer; }
        
        .profile-tabs { display: flex; gap:10px; margin-bottom:15px; border-bottom:1px solid #eee; }
        .profile-tab { flex:1; padding:10px; border:none; background:none; cursor:pointer; font-weight:bold; opacity:0.6; }
        .profile-tab.active { opacity:1; border-bottom:2px solid var(--accent); color: var(--accent); }

        footer { text-align: center; padding: 30px; background: rgba(17,17,17,0.95); color: white; margin-top: 50px; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-top">
                <a href="#" class="logo-container">
                    <h1 class="logo-text">MOVINET<span>CONDE</span></h1>
                </a>
                <div class="nav-icons">
                    <button onclick="abrirModal('cart-modal')" class="btn-icon"><i class="fas fa-shopping-cart"></i> <span id="cart-count">0</span></button>
                    <button onclick="gestionarPerfil()" class="btn-icon"><i class="fas fa-user-circle"></i></button>
                    <button onclick="abrirModal('admin-login-modal')" class="btn-icon"><i class="fas fa-lock"></i></button>
                </div>
            </div>
            <div class="nav-menu">
                <button onclick="verSeccion('catalogo')" class="menu-btn active" id="btn-catalogo">üì± M√≥viles</button>
                <button onclick="verSeccion('pcs')" class="menu-btn" id="btn-pcs">üñ•Ô∏è PC</button>
                <button onclick="verSeccion('reacondicionados')" class="menu-btn" id="btn-reacondicionados">‚ôªÔ∏è Segunda Mano</button>
                <button onclick="verSeccion('reparaciones')" class="menu-btn" id="btn-reparaciones">üîß Taller</button>
                <button onclick="verSeccion('webs')" class="menu-btn" id="btn-webs">üíª Web</button>
                <button onclick="verSeccion('resenas')" class="menu-btn" id="btn-resenas">‚≠ê Rese√±as</button>
                <button onclick="verSeccion('quiz')" class="menu-btn" id="btn-quiz">‚ùì Quiz</button>
            </div>
        </div>
    </nav>

    <div id="admin-panel" class="container admin-panel hidden">
        <h3 style="margin-top:0;">Panel de Administraci√≥n</h3>
        <div class="admin-tabs">
            <button class="admin-tab-btn active" onclick="verAdminTab('pedidos')">üö® PEDIDOS</button>
            <button class="admin-tab-btn" onclick="verAdminTab('citas')">üîß Citas</button>
            <button class="admin-tab-btn" onclick="verAdminTab('productos')">M√≥viles</button>
            <button class="admin-tab-btn" onclick="verAdminTab('pcs')">PC/Gaming</button>
            <button class="admin-tab-btn" onclick="verAdminTab('reacondicionados')">Reacondicionados</button>
            <button class="admin-tab-btn" onclick="verAdminTab('reparaciones')">Servicios</button>
            <button class="admin-tab-btn" onclick="verAdminTab('webs')">Webs</button>
        </div>

        <div id="admin-tab-pedidos">
            <h4 style="color:var(--accent);">√öltimos Pedidos (Tiempo Real)</h4>
            <div id="admin-orders-list" class="grid-container" style="grid-template-columns: 1fr;">Cargando pedidos...</div>
        </div>

        <div id="admin-tab-citas" class="hidden">
            <h4 style="color:var(--accent);">Citas de Taller</h4>
            <div id="admin-citas-list" class="grid-container" style="grid-template-columns: 1fr;">Cargando citas...</div>
        </div>

        <div id="admin-tab-productos" class="hidden">
            <h3>Nuevo M√≥vil</h3>
            <form id="addProductForm">
                <input type="hidden" id="editProductId">
                <input type="file" id="newImg" accept="image/*">
                <input type="text" id="newBrand" placeholder="Marca (Samsung)" required>
                <input type="text" id="newName" placeholder="Modelo" required>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="text" id="newRam" placeholder="RAM">
                    <input type="text" id="newStorage" placeholder="Memoria">
                </div>
                <input type="text" id="newColors" placeholder="Colores">
                <input type="number" id="newPrice" placeholder="Precio (‚Ç¨)" required>
                <button type="submit" class="btn-primary" id="btnSaveProduct">GUARDAR M√ìVIL</button>
                <button type="button" onclick="resetFormProduct()" style="margin-top:5px;width:100%;border:none;background:#ccc;">Cancelar</button>
            </form>
        </div>
        
        <div id="admin-tab-pcs" class="hidden">
            <h3>Nuevo PC / Gaming</h3>
            <form id="addPcForm">
                <input type="hidden" id="editPcId">
                <input type="file" id="pcImg" accept="image/*">
                <input type="text" id="pcTitle" placeholder="T√≠tulo (PC Gamer X)" required>
                <input type="text" id="pcCpu" placeholder="CPU (i5/Ryzen 5)" required>
                <input type="text" id="pcRam" placeholder="RAM" required>
                <input type="text" id="pcGpu" placeholder="Gr√°fica" required>
                <input type="text" id="pcSsd" placeholder="Disco Duro" required>
                <input type="number" id="pcPrice" placeholder="Precio" required>
                <button type="submit" class="btn-primary" id="btnSavePc">GUARDAR PC</button>
                 <button type="button" onclick="resetFormPc()" style="margin-top:5px;width:100%;border:none;background:#ccc;">Cancelar</button>
            </form>
        </div>

        <div id="admin-tab-reacondicionados" class="hidden">
            <h3>Nuevo Reacondicionado</h3>
            <form id="addReacoForm">
                <input type="hidden" id="editReacoId">
                <input type="file" id="reacoImg" accept="image/*">
                <input type="text" id="reacoTitle" placeholder="Producto" required>
                <input type="text" id="reacoCondition" placeholder="Estado (Grado A)" required>
                <textarea id="reacoDesc" placeholder="Descripci√≥n"></textarea>
                <input type="number" id="reacoPrice" placeholder="Precio" required>
                <button type="submit" class="btn-primary" id="btnSaveReaco">GUARDAR</button>
                <button type="button" onclick="resetFormReaco()" style="margin-top:5px;width:100%;border:none;background:#ccc;">Cancelar</button>
            </form>
        </div>

        <div id="admin-tab-reparaciones" class="hidden">
            <h3>Nuevo Servicio Taller</h3>
            <form id="addRepairForm">
                <input type="hidden" id="editRepairId">
                <input type="file" id="repairImg" accept="image/*">
                <input type="text" id="repairService" placeholder="Servicio (Cambio Pantalla)" required>
                <textarea id="repairDesc" placeholder="Descripci√≥n"></textarea>
                <input type="text" id="repairPriceText" placeholder="Texto Precio (Desde 20‚Ç¨)" required>
                <button type="submit" class="btn-primary" id="btnSaveRepair">GUARDAR SERVICIO</button>
                <button type="button" onclick="resetFormRepair()" style="margin-top:5px;width:100%;border:none;background:#ccc;">Cancelar</button>
            </form>
        </div>

        <div id="admin-tab-webs" class="hidden">
            <h3>Dise√±o Web</h3>
            <form id="addWebForm">
                <input type="hidden" id="editWebId">
                <input type="text" id="webIcon" placeholder="Icono (fas fa-desktop)" value="fas fa-desktop">
                <input type="text" id="webTitle" placeholder="T√≠tulo" required>
                <textarea id="webDesc" placeholder="Descripci√≥n"></textarea>
                <button type="submit" class="btn-primary" id="btnSaveWeb">GUARDAR WEB</button>
                <button type="button" onclick="resetFormWeb()" style="margin-top:5px;width:100%;border:none;background:#ccc;">Cancelar</button>
            </form>
        </div>

        <button onclick="cerrarSesionAdmin()" style="margin-top:20px; background:#333; color:white; border:none; padding:10px; width:100%;">Cerrar Sesi√≥n Admin</button>
    </div>

    <div id="sec-catalogo" class="container">
        <div class="center-wrapper"><h2 class="section-title">M√≥viles</h2></div>
        <div id="brand-filters" class="filter-scroll">
            <button class="filter-badge active" onclick="filtrarMarca('all')">Todo</button>
        </div>
        <div id="productos-container" class="grid-container">Cargando...</div>
    </div>

    <div id="sec-pcs" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Ordenadores & Gaming</h2></div>
        <div id="pcs-container" class="grid-container">Cargando...</div>
    </div>

    <div id="sec-reacondicionados" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Reacondicionados</h2></div>
        <div id="reaco-container" class="grid-container">Cargando...</div>
    </div>

    <div id="sec-reparaciones" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Servicios de Taller</h2></div>
        <div id="reparaciones-container" class="grid-container" style="margin-bottom:30px;">Cargando...</div>
        
        <div class="form-box glass-effect">
            <h3>Solicitar Reparaci√≥n</h3>
            <form id="tallerForm">
                <input type="text" id="tallerNombre" placeholder="Tu Nombre" required>
                <input type="text" id="tallerDispositivo" placeholder="Dispositivo y Aver√≠a" required>
                <button type="submit" class="btn-primary">ENVIAR Y ABRIR WHATSAPP</button>
            </form>
        </div>
    </div>

    <div id="sec-webs" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Dise√±o Web</h2></div>
        <div id="webs-container" class="grid-container"></div>
    </div>

    <div id="sec-resenas" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Opiniones</h2></div>
        <div style="text-align:center; margin-bottom:20px;">
            <button onclick="abrirModal('review-modal')" class="btn-primary" style="width:auto;">Escribir Rese√±a</button>
        </div>
        <div id="reviews-container" class="grid-container">Cargando...</div>
    </div>

    <div id="sec-quiz" class="container hidden">
        <div class="center-wrapper"><h2 class="section-title">Trivia Tech</h2></div>
        <div style="text-align:center; background:white; padding:20px; border-radius:10px;">
            <h3>¬°Muy Pronto!</h3>
            <p>Estamos preparando las mejores preguntas para ti.</p>
        </div>
    </div>

    <div id="cart-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('cart-modal')">&times;</span>
            <h2>Carrito</h2>
            <ul id="cart-items" style="list-style:none; padding:0; margin:20px 0;"></ul>
            <h3>Total: <span id="total-price">0</span>‚Ç¨</h3>
            <button onclick="realizarPedido()" class="btn-primary">FINALIZAR COMPRA (WHATSAPP)</button>
        </div>
    </div>

    <div id="profile-modal" class="modal hidden">
        <div class="modal-content" style="max-width:600px;">
            <span class="close" onclick="cerrarModal('profile-modal')">&times;</span>
            <h2 id="profile-name">Mi Perfil</h2>
            <div class="profile-tabs">
                <button class="profile-tab active" onclick="verTabPerfil('pedidos')">Mis Pedidos</button>
                <button class="profile-tab" onclick="verTabPerfil('reparaciones')">Reparaciones</button>
                <button class="profile-tab" onclick="verTabPerfil('favoritos')">Favoritos</button>
            </div>
            <div id="tab-pedidos"><div id="user-orders-list">Cargando...</div></div>
            <div id="tab-reparaciones" class="hidden"><div id="user-repairs-list">Cargando...</div></div>
            <div id="tab-favoritos" class="hidden"><ul id="fav-list" style="list-style:none;"></ul></div>
            <button onclick="auth.signOut(); cerrarModal('profile-modal');" class="btn-delete" style="background:#333; margin-top:20px;">Cerrar Sesi√≥n</button>
        </div>
    </div>

    <div id="review-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('review-modal')">&times;</span>
            <h3>Tu Opini√≥n</h3>
            <form id="addReviewForm">
                <input type="text" id="reviewName" placeholder="Nombre" required>
                <select id="reviewStars" required>
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê</option>
                </select>
                <textarea id="reviewText" placeholder="Comentario..." required></textarea>
                <button type="submit" class="btn-primary">Publicar</button>
            </form>
        </div>
    </div>

    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('auth-modal')">&times;</span>
            <h2 style="text-align:center">Acceso Clientes</h2>
            <form id="authForm">
                <input type="email" id="authEmail" placeholder="Email" required>
                <input type="password" id="authPass" placeholder="Contrase√±a" required>
                <div style="display:flex; gap:10px;">
                    <button type="button" class="btn-primary" onclick="handleAuth('login')">Entrar</button>
                    <button type="button" class="btn-secondary" onclick="handleAuth('register')">Registrarse</button>
                </div>
                <p id="authError" style="color:red; text-align:center; margin-top:10px;"></p>
            </form>
        </div>
    </div>

    <div id="admin-login-modal" class="modal hidden">
        <div class="modal-content" style="max-width:300px; text-align:center;">
            <span class="close" onclick="cerrarModal('admin-login-modal')">&times;</span>
            <h3>Zona Admin</h3>
            <input type="password" id="adminPassInput" placeholder="Clave">
            <button onclick="verificarAdmin()" class="btn-primary">Entrar</button>
        </div>
    </div>

    <footer>
        <a href="https://www.instagram.com/movinetconde/" target="_blank" style="color:var(--accent); font-size:2rem;"><i class="fab fa-instagram"></i></a>
        <p>&copy; 2025 MOVINETCONDE</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAO9sshvU5zUf_S9d12toWwrioeXBonlRc",
            authDomain: "movinet-conde-web.firebaseapp.com",
            projectId: "movinet-conde-web",
            appId: "1:867268264562:web:f28e33585cdcde3d8e78eb"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let carrito = []; let usuarioActual = null; let esAdmin = false; let favoritos = [];
        let allProducts = []; let filtroMarcaActual = 'all';
        let editImgProduct="", editImgPc="", editImgReaco="", editImgRepair="";
        const MI_TELEFONO = "34613509309"; 

        // ------------------ AUTH ------------------
        auth.onAuthStateChanged(u => { 
            usuarioActual = u; 
            if(u) {
                cerrarModal('auth-modal'); 
                document.getElementById('profile-name').innerText = "Perfil: " + u.email.split('@')[0];
                cargarDatosPerfil();
            } else { favoritos = []; }
        });

        function handleAuth(type) {
            const em = document.getElementById('authEmail').value, pw = document.getElementById('authPass').value;
            const err = document.getElementById('authError'); err.innerText="";
            if(!em || !pw) { err.innerText="Rellena todo."; return; }
            const p = type === 'login' ? auth.signInWithEmailAndPassword(em,pw) : auth.createUserWithEmailAndPassword(em,pw);
            p.then(()=>alert("Bienvenido")).catch(e => err.innerText = e.message);
        }

        // ------------------ NAVEGACI√ìN ------------------
        function verSeccion(id) {
            document.querySelectorAll('[id^="sec-"]').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`sec-${id}`).classList.remove('hidden');
            document.getElementById(`btn-${id}`).classList.add('active');
        }
        function verAdminTab(t) {
            document.querySelectorAll('[id^="admin-tab-"]').forEach(x => x.classList.add('hidden'));
            document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`admin-tab-${t}`).classList.remove('hidden');
            event.target.classList.add('active');
        }

        // ------------------ CARGA DE DATOS (M√ìVILES, PC, ETC) ------------------
        function cargarProductos() {
            db.collection("productos").orderBy("fecha", "desc").onSnapshot(snap => {
                allProducts = []; snap.forEach(doc => allProducts.push({...doc.data(), id: doc.id}));
                renderizarMarcas(); renderizarProductos();
            });
        }
        function cargarPCs() {
            db.collection("pcs").orderBy("fecha", "desc").onSnapshot(snap => {
                const c = document.getElementById('pcs-container'); c.innerHTML="";
                snap.forEach(doc => {
                    const p = doc.data();
                    let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-edit" onclick="editarPc('${doc.id}', '${JSON.stringify(p).replace(/"/g, '&quot;')}')">‚úèÔ∏è</button><button class="btn-delete" onclick="borrar('pcs','${doc.id}')">üóëÔ∏è</button></div>` : '';
                    c.innerHTML += `<div class="product-card"><img src="${p.img}" class="product-photo"><h3>${p.titulo}</h3><ul class="specs-list"><li>üíæ ${p.ram}</li><li>‚öôÔ∏è ${p.cpu}</li><li>üéÆ ${p.gpu}</li></ul><p class="price">${p.precio}‚Ç¨</p><button class="btn-primary" onclick="addCart('${doc.id}','${p.titulo}',${p.precio})">A√ëADIR</button>${adminBtns}</div>`;
                });
            });
        }
        function cargarReacos() {
            db.collection("reacondicionados").orderBy("fecha", "desc").onSnapshot(snap => {
                const c = document.getElementById('reaco-container'); c.innerHTML="";
                snap.forEach(doc => {
                    const r = doc.data();
                    let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-edit" onclick="editarReaco('${doc.id}', '${JSON.stringify(r).replace(/"/g, '&quot;')}')">‚úèÔ∏è</button><button class="btn-delete" onclick="borrar('reacondicionados','${doc.id}')">üóëÔ∏è</button></div>` : '';
                    c.innerHTML += `<div class="product-card"><span class="condition-tag">${r.condicion}</span><img src="${r.img}" class="product-photo"><h3>${r.titulo}</h3><p>${r.descripcion}</p><p class="price">${r.precio}‚Ç¨</p><button class="btn-primary" onclick="addCart('${doc.id}','${r.titulo}',${r.precio})">A√ëADIR</button>${adminBtns}</div>`;
                });
            });
        }
        function cargarReparaciones() {
            db.collection("reparaciones").onSnapshot(snap => {
                const c = document.getElementById('reparaciones-container'); c.innerHTML="";
                snap.forEach(doc => {
                    const r = doc.data();
                    let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-edit" onclick="editarRepair('${doc.id}', '${JSON.stringify(r).replace(/"/g, '&quot;')}')">‚úèÔ∏è</button><button class="btn-delete" onclick="borrar('reparaciones','${doc.id}')">üóëÔ∏è</button></div>` : '';
                    const img = r.img ? `<img src="${r.img}" class="repair-img">` : '';
                    c.innerHTML += `<div class="repair-card">${img}<h4>${r.servicio}</h4><p>${r.descripcion}</p><p class="price">${r.precioTexto}</p>${adminBtns}</div>`;
                });
            });
        }
        function cargarWebs() {
            db.collection("webs").onSnapshot(snap => {
                const c = document.getElementById('webs-container'); c.innerHTML="";
                snap.forEach(doc => {
                    const w = doc.data();
                    let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-edit" onclick="editarWeb('${doc.id}', '${JSON.stringify(w).replace(/"/g, '&quot;')}')">‚úèÔ∏è</button><button class="btn-delete" onclick="borrar('webs','${doc.id}')">üóëÔ∏è</button></div>` : '';
                    c.innerHTML += `<div class="product-card"><i class="${w.icono}" style="font-size:3rem; color:var(--accent);"></i><h3>${w.titulo}</h3><p>${w.descripcion}</p>${adminBtns}</div>`;
                });
            });
        }

        // ------------------ RENDERIZADO M√ìVILES ------------------
        function renderizarMarcas() {
            const marcas = ['all', ...new Set(allProducts.map(p => p.marca ? p.marca.trim() : 'Otros'))];
            document.getElementById('brand-filters').innerHTML = marcas.map(m => `<button class="filter-badge ${filtroMarcaActual === m ? 'active' : ''}" onclick="filtrarMarca('${m}')">${m === 'all' ? 'Todo' : m}</button>`).join('');
        }
        function renderizarProductos() {
            const c = document.getElementById('productos-container'); c.innerHTML = "";
            const filtrados = filtroMarcaActual === 'all' ? allProducts : allProducts.filter(p => (p.marca || 'Otros') === filtroMarcaActual);
            filtrados.forEach(p => {
                let adminBtns = esAdmin ? `<div class="admin-actions"><button class="btn-edit" onclick="editarProducto('${p.id}', '${JSON.stringify(p).replace(/"/g, '&quot;')}')">‚úèÔ∏è</button><button class="btn-delete" onclick="borrar('productos','${p.id}')">üóëÔ∏è</button></div>` : '';
                c.innerHTML += `<div class="product-card"><span class="brand-tag">${p.marca}</span><img src="${p.img}" class="product-photo"><h3>${p.nombre}</h3><p style="font-size:0.8rem">${p.ram} | ${p.storage} | ${p.colores}</p><p class="price">${p.precio}‚Ç¨</p><button class="btn-primary" onclick="addCart('${p.id}','${p.nombre}',${p.precio})">A√ëADIR</button>${adminBtns}</div>`;
            });
        }
        function filtrarMarca(m) { filtroMarcaActual = m; renderizarMarcas(); renderizarProductos(); }

        // ------------------ L√ìGICA PEDIDOS Y WHATSAPP ------------------
        
        async function realizarPedido(){
            if(!carrito.length) return;
            if(!usuarioActual) { alert("Inicia sesi√≥n para que podamos guardar tu pedido."); abrirModal('auth-modal'); return; }

            let total = 0; let itemsTexto = "";
            carrito.forEach(i => { total += i.p; itemsTexto += `${i.n} (${i.p}‚Ç¨), `; });

            const pedidoData = {
                uid: usuarioActual.uid,
                email: usuarioActual.email,
                items: carrito,
                total: total,
                fecha: new Date().toISOString(),
                estado: 'pendiente' // Naranja
            };

            try {
                // 1. Guardar en Base de Datos (ADMIN LO VER√Å)
                await db.collection('pedidos').add(pedidoData);
                
                // 2. ABRIR WHATSAPP INMEDIATAMENTE
                let msg = `Hola MovinetConde, soy ${usuarioActual.email}. He pedido: ${itemsTexto}. Total: ${total}‚Ç¨`;
                window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(msg)}`, '_blank');
                
                // 3. Limpiar
                carrito = []; document.getElementById('cart-count').innerText = "0";
                cerrarModal('cart-modal');
                alert("Pedido guardado correctamente. Revisa WhatsApp.");
                cargarDatosPerfil();

            } catch(e) {
                alert("Error de conexi√≥n: " + e.message);
            }
        }

        document.getElementById('tallerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const n = document.getElementById('tallerNombre').value;
            const d = document.getElementById('tallerDispositivo').value;
            
            if(usuarioActual) {
                await db.collection('citas').add({ uid: usuarioActual.uid, email: usuarioActual.email, nombre: n, dispositivo: d, fecha: new Date().toISOString(), estado: 'pendiente' });
            }
            window.open(`https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent(`Hola, soy ${n}. Consulta taller: ${d}`)}`, '_blank');
        });

        // ------------------ ADMIN ------------------
        function verificarAdmin() { 
            if(document.getElementById('adminPassInput').value==="4354"){ 
                esAdmin=true; document.getElementById('admin-panel').classList.remove('hidden'); cerrarModal('admin-login-modal'); 
                cargarTodo(); cargarPedidosAdmin();
            } else alert("Error"); 
        }
        function cerrarSesionAdmin(){ esAdmin=false; document.getElementById('admin-panel').classList.add('hidden'); cargarTodo(); }

        // ESCUCHAR PEDIDOS EN ADMIN
        function cargarPedidosAdmin() {
            db.collection('pedidos').orderBy('fecha', 'desc').onSnapshot(snap => {
                const div = document.getElementById('admin-orders-list'); div.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    const color = d.estado === 'confirmado' ? '#e8f5e9' : '#fff3e0';
                    const btn = d.estado === 'pendiente' 
                        ? `<button class="btn-confirm" onclick="cambiarEstado('pedidos','${doc.id}','confirmado')">‚úÖ CONFIRMAR PEDIDO</button>`
                        : `<span style="color:green; font-weight:bold;">¬°Confirmado!</span>`;
                    
                    div.innerHTML += `<div class="review-card" style="background:${color}; text-align:left;">
                        <small>${d.email} - ${new Date(d.fecha).toLocaleString()}</small>
                        <p><b>Items:</b> ${d.items.map(i=>i.n).join(', ')}</p>
                        <p><b>Total:</b> ${d.total}‚Ç¨</p>
                        ${btn}
                    </div>`;
                });
            });

            db.collection('citas').orderBy('fecha', 'desc').onSnapshot(snap => {
                const div = document.getElementById('admin-citas-list'); div.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    const btn = d.estado === 'pendiente' 
                        ? `<button class="btn-confirm" onclick="cambiarEstado('citas','${doc.id}','confirmado')">‚úÖ CONFIRMAR REPARACI√ìN</button>`
                        : `<span style="color:green; font-weight:bold;">¬°Lista!</span>`;
                    div.innerHTML += `<div class="review-card" style="text-align:left;"><small>${d.email}</small><h3>${d.dispositivo}</h3>${btn}</div>`;
                });
            });
        }
        function cambiarEstado(col, id, est) { db.collection(col).doc(id).update({estado: est}); }

        // ------------------ CRUD ADMIN (Guardar, Editar, Borrar) ------------------
        async function guardarItem(col, id, data, fileIn, oldImg) {
            const f = document.getElementById(fileIn) ? document.getElementById(fileIn).files[0] : null;
            let imgF = oldImg;
            if(f) { const r = new FileReader(); r.readAsDataURL(f); await new Promise(res => r.onload = ()=> { imgF = r.result; res(); }); }
            if(imgF) data.img = imgF;
            if(id) await db.collection(col).doc(id).update(data);
            else await db.collection(col).add({...data, fecha: new Date().toISOString()});
            alert("Guardado");
        }
        
        // Listeners Formularios Admin
        document.getElementById('addProductForm').addEventListener('submit', e=>{ e.preventDefault(); 
            guardarItem('productos', document.getElementById('editProductId').value, {
                nombre: document.getElementById('newName').value, marca: document.getElementById('newBrand').value, 
                ram: document.getElementById('newRam').value, storage: document.getElementById('newStorage').value, 
                colores: document.getElementById('newColors').value, precio: Number(document.getElementById('newPrice').value)
            }, 'newImg', editImgProduct).then(resetFormProduct); 
        });
        document.getElementById('addPcForm').addEventListener('submit', e=>{ e.preventDefault();
            guardarItem('pcs', document.getElementById('editPcId').value, {
                titulo: document.getElementById('pcTitle').value, cpu: document.getElementById('pcCpu').value,
                ram: document.getElementById('pcRam').value, ssd: document.getElementById('pcSsd').value,
                gpu: document.getElementById('pcGpu').value, precio: Number(document.getElementById('pcPrice').value)
            }, 'pcImg', editImgPc).then(resetFormPc);
        });
        document.getElementById('addReacoForm').addEventListener('submit', e=>{ e.preventDefault();
            guardarItem('reacondicionados', document.getElementById('editReacoId').value, {
                titulo: document.getElementById('reacoTitle').value, condition: document.getElementById('reacoCondition').value,
                descripcion: document.getElementById('reacoDesc').value, precio: Number(document.getElementById('reacoPrice').value)
            }, 'reacoImg', editImgReaco).then(resetFormReaco);
        });
        document.getElementById('addRepairForm').addEventListener('submit', e=>{ e.preventDefault();
            guardarItem('reparaciones', document.getElementById('editRepairId').value, {
                servicio: document.getElementById('repairService').value, descripcion: document.getElementById('repairDesc').value,
                precioTexto: document.getElementById('repairPriceText').value
            }, 'repairImg', editImgRepair).then(resetFormRepair);
        });
        document.getElementById('addWebForm').addEventListener('submit', e=>{ e.preventDefault();
            guardarItem('webs', document.getElementById('editWebId').value, {
                icono: document.getElementById('webIcon').value, titulo: document.getElementById('webTitle').value, descripcion: document.getElementById('webDesc').value
            }, null, null).then(resetFormWeb);
        });

        // Funciones Editar
        function editarProducto(id, j) { const p=JSON.parse(j); document.getElementById('editProductId').value=id; document.getElementById('newName').value=p.nombre; document.getElementById('newBrand').value=p.marca; document.getElementById('newPrice').value=p.precio; editImgProduct=p.img; document.getElementById('btnSaveProduct').innerText="ACTUALIZAR"; verAdminTab('productos'); }
        function editarPc(id, j) { const p=JSON.parse(j); document.getElementById('editPcId').value=id; document.getElementById('pcTitle').value=p.titulo; document.getElementById('pcPrice').value=p.precio; editImgPc=p.img; document.getElementById('btnSavePc').innerText="ACTUALIZAR"; verAdminTab('pcs'); }
        function editarReaco(id, j) { const p=JSON.parse(j); document.getElementById('editReacoId').value=id; document.getElementById('reacoTitle').value=p.titulo; document.getElementById('reacoPrice').value=p.precio; editImgReaco=p.img; document.getElementById('btnSaveReaco').innerText="ACTUALIZAR"; verAdminTab('reacondicionados'); }
        function editarRepair(id, j) { const p=JSON.parse(j); document.getElementById('editRepairId').value=id; document.getElementById('repairService').value=p.servicio; document.getElementById('repairPriceText').value=p.precioTexto; editImgRepair=p.img; document.getElementById('btnSaveRepair').innerText="ACTUALIZAR"; verAdminTab('reparaciones'); }
        function editarWeb(id, j) { const p=JSON.parse(j); document.getElementById('editWebId').value=id; document.getElementById('webTitle').value=p.titulo; document.getElementById('btnSaveWeb').innerText="ACTUALIZAR"; verAdminTab('webs'); }
        function borrar(c,i){ if(confirm("¬øBorrar?")) db.collection(c).doc(i).delete(); }

        // Resets
        function resetFormProduct(){ document.getElementById('addProductForm').reset(); document.getElementById('editProductId').value=""; editImgProduct=""; document.getElementById('btnSaveProduct').innerText="GUARDAR"; }
        function resetFormPc(){ document.getElementById('addPcForm').reset(); document.getElementById('editPcId').value=""; editImgPc=""; document.getElementById('btnSavePc').innerText="GUARDAR"; }
        function resetFormReaco(){ document.getElementById('addReacoForm').reset(); document.getElementById('editReacoId').value=""; editImgReaco=""; document.getElementById('btnSaveReaco').innerText="GUARDAR"; }
        function resetFormRepair(){ document.getElementById('addRepairForm').reset(); document.getElementById('editRepairId').value=""; editImgRepair=""; document.getElementById('btnSaveRepair').innerText="GUARDAR"; }
        function resetFormWeb(){ document.getElementById('addWebForm').reset(); document.getElementById('editWebId').value=""; document.getElementById('btnSaveWeb').innerText="GUARDAR"; }

        // ------------------ PERFIL ------------------
        function gestionarPerfil() { usuarioActual ? abrirModal('profile-modal') : abrirModal('auth-modal'); }
        function verTabPerfil(tab) {
            document.querySelectorAll('[id^="tab-"]').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.profile-tab').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
            event.target.classList.add('active');
        }
        function cargarDatosPerfil() {
            if(!usuarioActual) return;
            db.collection('pedidos').where('uid', '==', usuarioActual.uid).orderBy('fecha', 'desc').onSnapshot(snap => {
                const div = document.getElementById('user-orders-list'); div.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    const color = d.estado === 'confirmado' ? 'bg-success' : 'bg-pending';
                    const borde = d.estado === 'confirmado' ? 'confirmado' : 'pendiente';
                    div.innerHTML += `<div class="order-card ${borde}"><div style="display:flex; justify-content:space-between;"><b>${new Date(d.fecha).toLocaleDateString()}</b><span class="status-badge ${color}">${d.estado.toUpperCase()}</span></div><p>Total: ${d.total}‚Ç¨</p></div>`;
                });
            });
            db.collection('citas').where('uid', '==', usuarioActual.uid).orderBy('fecha', 'desc').onSnapshot(snap => {
                const div = document.getElementById('user-repairs-list'); div.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    const color = d.estado === 'confirmado' ? 'bg-success' : 'bg-pending';
                    const borde = d.estado === 'confirmado' ? 'confirmado' : 'pendiente';
                    div.innerHTML += `<div class="order-card ${borde}"><div style="display:flex; justify-content:space-between;"><b>${d.dispositivo}</b><span class="status-badge ${color}">${d.estado.toUpperCase()}</span></div></div>`;
                });
            });
            db.collection('usuarios').doc(usuarioActual.uid).collection('favoritos').get().then(s=>{ 
                const ul = document.getElementById('fav-list'); ul.innerHTML=""; s.forEach(d => ul.innerHTML += `<li>${d.data().n}</li>`);
            }); 
        }

        // ------------------ EXTRAS ------------------
        function addCart(id, n, p){ carrito.push({n,p}); document.getElementById('cart-count').innerText=carrito.length; alert("A√±adido"); }
        window.abrirModal = (id) => { document.getElementById(id).classList.remove('hidden'); if(id==='cart-modal'){ const ul = document.getElementById('cart-items'); ul.innerHTML=""; let t=0; carrito.forEach(i => { ul.innerHTML+=`<li>${i.n} - ${i.p}‚Ç¨</li>`; t+=i.p; }); document.getElementById('total-price').innerText = t; }};
        window.cerrarModal = (id) => document.getElementById(id).classList.add('hidden');
        
        document.getElementById('addReviewForm').addEventListener('submit', async (e) => { e.preventDefault(); await db.collection('resenas').add({ nombre: document.getElementById('reviewName').value, estrellas: document.getElementById('reviewStars').value, texto: document.getElementById('reviewText').value, fecha: new Date().toISOString() }); alert("Enviada"); cerrarModal('review-modal'); });
        
        function cargarResenas() { db.collection('resenas').orderBy('fecha', 'desc').onSnapshot(snap => { const d = document.getElementById('reviews-container'); d.innerHTML=""; snap.forEach(doc => { const r = doc.data(); d.innerHTML += `<div class="review-card"><div style="color:gold;">${"‚≠ê".repeat(r.estrellas)}</div><b>${r.nombre}</b><p>${r.texto}</p></div>`; }); }); }

        function cargarTodo() { cargarProductos(); cargarPCs(); cargarReacos(); cargarReparaciones(); cargarWebs(); cargarResenas(); }
        cargarTodo();

    </script>
</body>
</html>
