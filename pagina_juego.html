<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Catcher - Zona de Juego</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Estilos específicos del juego para que no se salgan del recuadro */
        #game-container {
            position: relative;
            overflow: hidden; /* Importante: mantiene el juego dentro del borde */
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        /* Animaciones UI del juego */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div style="width: 100%; max-width: 800px; margin: 0 auto; text-align: center;" class="bg-white p-6 rounded-2xl shadow-xl">
        
        <h2 class="text-3xl font-bold text-gray-800 mb-4">¡Gana descuentos jugando!</h2>
        
        <div id="game-container" style="width: 100%; height: 600px; border: 4px solid #3b82f6; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.5);">
            
            <canvas id="gameCanvas" class="absolute top-0 left-0 w-full h-full block"></canvas>

            <div id="startScreen" class="absolute z-20 flex flex-col items-center justify-center w-full h-full bg-black/80 transition-opacity duration-300">
                <div class="glass-panel p-6 rounded-2xl text-center max-w-sm w-[90%] mx-auto shadow-2xl border-t-4 border-blue-500">
                    <div class="mb-2 text-5xl text-blue-400 animate-float">
                        <i class="fa-solid fa-mobile-screen-button"></i>
                    </div>
                    <h1 class="text-3xl font-black mb-1 text-white">TECH CATCHER</h1>
                    <p class="text-gray-300 mb-4 text-xs">¡Atrapa tecnología, evita daños!</p>
                    <button onclick="startGame()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-xl transition transform hover:scale-105 shadow-lg">JUGAR AHORA</button>
                    <p class="mt-3 text-xs text-gray-500">Récord: <span id="startHighScore">0</span></p>
                </div>
            </div>

            <div id="gameOverScreen" class="hidden absolute z-20 flex flex-col items-center justify-center w-full h-full bg-black/90">
                <div class="glass-panel p-6 rounded-2xl text-center max-w-sm w-[90%] mx-auto border-t-4 border-red-500">
                    <h2 class="text-2xl font-bold mb-1 text-white">¡PANTALLA ROTA!</h2>
                    <div class="bg-slate-800 rounded-lg p-3 mb-4">
                        <div class="text-xs text-gray-400 uppercase">Puntos</div>
                        <div class="text-4xl font-black text-white" id="finalScore">0</div>
                    </div>
                    <button onclick="startGame()" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded-xl mb-2">REINTENTAR</button>
                </div>
            </div>

            <div id="hud" class="hidden absolute top-0 w-full p-4 flex justify-between items-start z-10 pointer-events-none">
                <div class="flex flex-col text-left">
                    <span class="text-xs text-gray-400 font-bold uppercase">Score</span>
                    <span id="scoreDisplay" class="text-3xl font-black text-white drop-shadow-md">0</span>
                </div>
                <div class="flex gap-1" id="livesDisplay"></div>
            </div>

        </div>
        <p class="mt-4 text-gray-600 text-sm flex items-center justify-center gap-2">
            <i class="fa-solid fa-arrow-pointer"></i> Usa las flechas o toca la pantalla para moverte.
        </p>
    </div>

    <script>
        const container = document.getElementById('game-container');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Variables globales
        let gameLoopId, isPlaying = false, score = 0, lives = 3, difficultyMultiplier = 1;
        let highScore = localStorage.getItem('techShopHighScore') || 0;
        let items = [], particles = [];
        let keys = {}, touchX = null;

        // UI References
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const hud = document.getElementById('hud');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const livesDisplay = document.getElementById('livesDisplay');

        document.getElementById('startHighScore').textContent = highScore;

        // Jugador
        const player = { x: 0, y: 0, width: 60, height: 60, speed: 10, color: '#3b82f6', icon: '\uf07a' };

        // Items
        const itemTypes = {
            GOOD: [{ icon: '\uf3cd', color: '#4ade80', score: 10, type: 'good' }, { icon: '\uf10b', color: '#60a5fa', score: 15, type: 'good' }],
            BAD: [{ icon: '\uf6e3', color: '#ef4444', type: 'bad' }, { icon: '\uf043', color: '#38bdf8', type: 'bad' }]
        };

        // AJUSTE DE TAMAÑO (Clave para que funcione en el div)
        function resizeCanvas() {
            // Usamos el ancho del contenedor, no de la ventana
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            player.y = canvas.height - player.height - 10;
            if(!isPlaying) player.x = canvas.width / 2 - player.width / 2;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Inputs
        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);

        // Touch logic adaptada al contenedor
        canvas.addEventListener('touchmove', e => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            touchX = e.touches[0].clientX - rect.left; // Ajuste relativo al canvas
        }, { passive: false });
        
        canvas.addEventListener('mousemove', e => {
            if(isPlaying) {
                const rect = canvas.getBoundingClientRect();
                touchX = e.clientX - rect.left;
            }
        });
        canvas.addEventListener('touchend', () => touchX = null);

        // --- Lógica del Juego ---
        function startGame() {
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            hud.classList.remove('hidden');
            
            isPlaying = true;
            score = 0;
            lives = 3;
            difficultyMultiplier = 1;
            items = [];
            particles = [];
            
            scoreDisplay.textContent = score;
            updateLivesUI();
            player.x = canvas.width / 2 - player.width / 2;
            
            if (gameLoopId) cancelAnimationFrame(gameLoopId);
            gameLoop();
            setTimeout(spawnItem, 1000);
        }

        function gameOver() {
            isPlaying = false;
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('techShopHighScore', highScore);
            }
            document.getElementById('finalScore').textContent = score;
            document.getElementById('startHighScore').textContent = highScore;
            hud.classList.add('hidden');
            gameOverScreen.classList.remove('hidden');
        }

        function spawnItem() {
            if (!isPlaying) return;
            const isBad = Math.random() > 0.7;
            const pool = isBad ? itemTypes.BAD : itemTypes.GOOD;
            const template = pool[Math.floor(Math.random() * pool.length)];
            
            items.push({
                ...template,
                x: Math.random() * (canvas.width - 40),
                y: -50,
                width: 40, height: 40,
                speed: (Math.random() * 2 + 2) * difficultyMultiplier,
                rotation: 0, rotationSpeed: (Math.random() - 0.5) * 0.2
            });

            difficultyMultiplier += 0.005;
            setTimeout(spawnItem, Math.max(400, 1500 - (difficultyMultiplier * 500)));
        }

        function updateLivesUI() {
            livesDisplay.innerHTML = '';
            for(let i=0; i<3; i++) {
                const heart = document.createElement('i');
                heart.className = `fa-solid fa-heart text-xl ${i < lives ? 'text-red-500' : 'text-gray-600'}`;
                livesDisplay.appendChild(heart);
            }
        }

        function update() {
            // Movimiento
            if (touchX !== null) {
                const targetX = touchX - player.width / 2;
                player.x += (targetX - player.x) * 0.2;
            } else {
                if (keys['ArrowLeft'] || keys['a']) player.x -= player.speed;
                if (keys['ArrowRight'] || keys['d']) player.x += player.speed;
            }
            // Límites
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

            // Items
            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                item.y += item.speed;
                item.rotation += item.rotationSpeed;

                if (item.x < player.x + player.width && item.x + item.width > player.x &&
                    item.y < player.y + player.height && item.y + item.height > player.y) {
                    
                    if (item.type === 'good') score += item.score;
                    else {
                        lives--;
                        updateLivesUI();
                        if (lives <= 0) gameOver();
                    }
                    items.splice(i, 1);
                    scoreDisplay.textContent = score;
                    continue;
                }
                if (item.y > canvas.height) items.splice(i, 1);
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Items
            ctx.font = '900 24px "Font Awesome 6 Free"';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            items.forEach(item => {
                ctx.save();
                ctx.translate(item.x + item.width/2, item.y + item.height/2);
                ctx.rotate(item.rotation);
                ctx.fillStyle = item.color;
                ctx.shadowColor = item.color; ctx.shadowBlur = 10;
                ctx.fillText(item.icon, 0, 0);
                ctx.restore();
            });

            // Player
            ctx.save();
            ctx.translate(player.x + player.width/2, player.y + player.height/2);
            ctx.fillStyle = player.color;
            ctx.shadowColor = 'rgba(59, 130, 246, 0.5)'; ctx.shadowBlur = 15;
            ctx.font = '900 45px "Font Awesome 6 Free"';
            ctx.fillText(player.icon, 0, 0);
            ctx.restore();
        }

        function gameLoop() {
            if (!isPlaying) return;
            update();
            draw();
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // Cargar fuente iconos
        document.fonts.ready.then(() => { resizeCanvas(); draw(); });
    </script>
</body>
</html>